<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Gowder&#39;s Tech Blog (!): The Easy Way to Get Your Data from Heroku Postgres (in Python)</title>
    <link rel="canonical" href="http://paultopia.github.io/posts-output/simple-heroku-connection/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='//fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700' rel='stylesheet'
          type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css">
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Gowder&#39;s Tech Blog (!)</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/">Home</a></li>
                <li
                ><a href="/archives/">Archives</a></li>
                
                <li
                >
                <a href="/pages-output/about/">About</a>
                </li>
                
                <li><a href="/feed.xml">RSS</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                        More <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li class="dropdown-header">Links</li>
                        <li><a href="https://gowder.io">Moi</a></li>
                        <li><a href="https://github.com/paultopia">Github</a></li>
                        <li><a href="https://twitter.com/PaulGowder">Twitter</a></li>
                        <li><a href="http://www.linkedin.com/in/paulgowder">LinkedIn</a></li>
                        

                        
                        <li class="divider"></li>
                        <li class="dropdown-header">Recent Posts</li>
                        
                        <li><a href="/posts-output/simple-heroku-connection/">The Easy Way to Get Your Data from Heroku Postgres (in Python)</a></li>
                        
                        <li><a href="/posts-output/jupyter-experiment-with-image/">Experimental post: jupyter notebook --&gt; cryogen post</a></li>
                        
                        <li><a href="/posts-output/jsoup-is-awesome/">For Clojure Webscraping, Try Jsoup!</a></li>
                        
                        

                        
                        <li class="divider"></li>
                        <li class="dropdown-header">Tags</li>
                        
                        <li><a href="/tags-output/game theory/">game theory</a></li>
                        
                        <li><a href="/tags-output/latex/">latex</a></li>
                        
                        <li><a href="/tags-output/cryogen/">cryogen</a></li>
                        
                        <li><a href="/tags-output/testing/">testing</a></li>
                        
                        <li><a href="/tags-output/clojure/">clojure</a></li>
                        
                        <li><a href="/tags-output/web/">web</a></li>
                        
                        <li><a href="/tags-output/databases/">databases</a></li>
                        
                        <li><a href="/tags-output/machine-learning/">machine-learning</a></li>
                        
                        <li><a href="/tags-output/browsers/">browsers</a></li>
                        
                        <li><a href="/tags-output/postgres/">postgres</a></li>
                        
                        <li><a href="/tags-output/postgresql/">postgresql</a></li>
                        
                        <li><a href="/tags-output/css/">css</a></li>
                        
                        <li><a href="/tags-output/java/">java</a></li>
                        
                        <li><a href="/tags-output/unicode/">unicode</a></li>
                        
                        <li><a href="/tags-output/osx/">osx</a></li>
                        
                        <li><a href="/tags-output/text-mining/">text-mining</a></li>
                        
                        <li><a href="/tags-output/haskell/">haskell</a></li>
                        
                        <li><a href="/tags-output/machinelearning/">machinelearning</a></li>
                        
                        <li><a href="/tags-output/flexbox/">flexbox</a></li>
                        
                        <li><a href="/tags-output/math/">math</a></li>
                        
                        <li><a href="/tags-output/shell/">shell</a></li>
                        
                        <li><a href="/tags-output/heroku/">heroku</a></li>
                        
                        <li><a href="/tags-output/blog/">blog</a></li>
                        
                        <li><a href="/tags-output/latin-1/">latin-1</a></li>
                        
                        <li><a href="/tags-output/reagent/">reagent</a></li>
                        
                        <li><a href="/tags-output/emacs/">emacs</a></li>
                        
                        <li><a href="/tags-output/datascience/">datascience</a></li>
                        
                        <li><a href="/tags-output/package management/">package management</a></li>
                        
                        <li><a href="/tags-output/git/">git</a></li>
                        
                        <li><a href="/tags-output/spacemacs/">spacemacs</a></li>
                        
                        <li><a href="/tags-output/functional programming/">functional programming</a></li>
                        
                        <li><a href="/tags-output/templates/">templates</a></li>
                        
                        <li><a href="/tags-output/r/">r</a></li>
                        
                        <li><a href="/tags-output/utf-8/">utf-8</a></li>
                        
                        <li><a href="/tags-output/object-oriented programming/">object-oriented programming</a></li>
                        
                        <li><a href="/tags-output/debugging/">debugging</a></li>
                        
                        <li><a href="/tags-output/meta/">meta</a></li>
                        
                        <li><a href="/tags-output/flask/">flask</a></li>
                        
                        <li><a href="/tags-output/markdown/">markdown</a></li>
                        
                        <li><a href="/tags-output/homebrew/">homebrew</a></li>
                        
                        <li><a href="/tags-output/devcards/">devcards</a></li>
                        
                        <li><a href="/tags-output/javascript/">javascript</a></li>
                        
                        <li><a href="/tags-output/system/">system</a></li>
                        
                        <li><a href="/tags-output/python/">python</a></li>
                        
                        <li><a href="/tags-output/webscraping/">webscraping</a></li>
                        
                        <li><a href="/tags-output/performance/">performance</a></li>
                        
                        <li><a href="/tags-output/closures/">closures</a></li>
                        
                        <li><a href="/tags-output/react/">react</a></li>
                        
                        <li><a href="/tags-output/data/">data</a></li>
                        
                        <li><a href="/tags-output/machine learning/">machine learning</a></li>
                        
                        <li><a href="/tags-output/algorithms/">algorithms</a></li>
                        
                        <li><a href="/tags-output/numpy/">numpy</a></li>
                        
                        <li><a href="/tags-output/clojurescript/">clojurescript</a></li>
                        
                        <li><a href="/tags-output/mustache/">mustache</a></li>
                        
                        <li><a href="/tags-output/test/">test</a></li>
                        
                        <li><a href="/tags-output/trees/">trees</a></li>
                        
                        
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-12">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">April 25, 2018</div>
        
    </div>
    <h2>The Easy Way to Get Your Data from Heroku Postgres (in Python)</h2>
</div>
<div>
    
     <p>Just a tiny little tidbit here. I do a lot of data collection in one-off Heroku apps, and one annoying thing that I find myself having to deal with is getting data in and out.</p><p>Generally, if you want to upload or download your data in its entirety, you can either use Heroku's <code>pg:push</code> and <code>pg:pull</code> commands <a href='https://devcenter.heroku.com/articles/heroku-postgresql#pg-push-and-pg-pull'>see documentation</a> to transmit data between remote and local Postgres instances. You can also use <a href='https://devcenter.heroku.com/articles/heroku-postgres-import-export'>Postgres backups</a>. To download a CSV, you can <a href='https://jamesbedont.com/2016/08/21/exportpg.html'>connect directly to psql</a> (psql is the postgres shell). And to upload a CSV, again in psql, you can do something like:</p><pre><code>\copy yourtable from 'your/absolute/path/filename.csv' with &#40;format csv&#41;;
select setval&#40;'yourtable&#95;id&#95;seq', max&#40;id&#41;&#41; from yourtable;
</code></pre><p>where the second line (assuming you have a primary key as a serial named "id") resets the primary key to the end of the uploaded CSV, so that you can add more rows without getting key conflicts.</p><p>But suppose you have a lot of data, and you don't want to move around the whole thing.  You can copy the results of a specific query to a CSV (see the link above about downloading a csv). And, of course, you can tinker with the application you have on Heroku already to provide some in-application way to access data. But sometimes that's inconvenient, and you want to just interact directly with the database from local code.</p><p>Fortunately, it turns out that's pretty easy. <a href='https://devcenter.heroku.com/articles/connecting-to-heroku-postgres-databases-from-outside-of-heroku'>Heroku gives you a database url accessible from the internet</a>, and it's pretty trivial to fetch that from local code and run queries right against the database from your local machine.  Here's some example code, using the standard Python Postgres driver, <a href='http://initd.org/psycopg/'>psycopg2</a>.</p><pre><code class="python">
HEROKU&#95;APP&#95;NAME = &quot;your&#95;app&#95;name&#95;in&#95;heroku&quot;
TABLE&#95;NAME = &quot;the&#95;table&#95;you&#95;want&#95;to&#95;query&#95;in&#95;this&#95;example&quot;
import subprocess, psycopg2

conn&#95;info = subprocess.run&#40;&#91;&quot;heroku&quot;, &quot;config:get&quot;, &quot;DATABASE&#95;URL&quot;, &quot;-a&quot;, HEROKU&#95;APP&#95;NAME&#93;, stdout = subprocess.PIPE&#41;
connuri = conn&#95;info.stdout.decode&#40;'utf-8'&#41;.strip&#40;&#41;
conn = psycopg2.connect&#40;connuri&#41;
cursor = conn.cursor&#40;&#41;
cursor.execute&#40;sql.SQL&#40;&quot;SELECT COUNT&#40;&#42;&#41; FROM {};&quot;&#41;.format&#40;sql.Identifier&#40;TABLE&#95;NAME&#41;&#41;&#41;
count = cursor.fetchall&#40;&#41;
print&#40;count&#41;

</code></pre><p>And it's that easy! Note that I composed the SQL string using <a href='http://initd.org/psycopg/docs/sql.html#module-psycopg2.sql'>psycopg2's special tool for that purpose</a>, mainly because you can only pass values, not table names, with the ordinary <a href='http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries'>placeholder/string paramaterization functionality</a> and it squicks me out to use basic formatting strings anywhere near SQL.</p><p>If you want to make it even easier, you can also do a query right from Pandas and have everything land nice and tidy in a DataFrame, though it requires going through SQLAlchemy first. As follows: </p><pre><code class="python">
from sqlalchemy import create&#95;engine
engine = create&#95;engine&#40;connuri&#41;
raw&#95;engine = engine.raw&#95;connection&#40;&#41;
my&#95;df = pd.read&#95;sql&#95;query&#40;&quot;SELECT &#42; FROM your&#95;table;&quot;, raw&#95;engine&#41;

</code></pre><p>and there you go!</p>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags-output/databases/">databases</a>
    
    <a href="/tags-output/postgres/">postgres</a>
    
    <a href="/tags-output/heroku/">heroku</a>
    
    <a href="/tags-output/python/">python</a>
    
</div>


    <div id="prev-next">
        
        
        <a class="right" href="/posts-output/jupyter-experiment-with-image/">Experimental post: jupyter notebook --&gt; cryogen post &raquo;</a>
        
    </div>

    


</div>

            </div>
        </div>
    </div>
    <footer>
        <p>Copyright &copy; 2016-2018 <a href="https://gowder.io">Paul Gowder</a>.</p>

        <p> All original content licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>. </p>

        <p class="rc-scout"></p>
    </footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- HERE ARE A BUNCH OF PAUL CUSTOMIZATIONS -->
<!-- try to get heavy klipse stuff loaded only if post has executable content -->


<!-- ditto mathjax -->



<script async defer src="https://www.recurse-scout.com/loader.js?t=883fcbc53dcca6e2fc6b228efe240125"></script>
</body>
</html>

