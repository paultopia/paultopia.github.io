<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Gowder&#39;s Tech Blog (!): Clojure basics: destructuring</title>
    <link rel="canonical" href="http://paultopia.github.io/posts-output/destructuring/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='//fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700' rel='stylesheet'
          type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css">
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Gowder&#39;s Tech Blog (!)</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/">Home</a></li>
                <li
                ><a href="/archives/">Archives</a></li>
                
                <li
                >
                <a href="/pages-output/about/">About</a>
                </li>
                
                <li><a href="/feed.xml">RSS</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                        More <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li class="dropdown-header">Links</li>
                        <li><a href="https://gowder.io">Moi</a></li>
                        <li><a href="https://github.com/paultopia">Github</a></li>
                        <li><a href="https://twitter.com/PaulGowder">Twitter</a></li>
                        <li><a href="http://www.linkedin.com/in/paulgowder">LinkedIn</a></li>
                        

                        
                        <li class="divider"></li>
                        <li class="dropdown-header">Recent Posts</li>
                        
                        <li><a href="/posts-output/jupyter-experiment-with-image/">Experimental post: jupyter notebook --&gt; cryogen post</a></li>
                        
                        <li><a href="/posts-output/jsoup-is-awesome/">For Clojure Webscraping, Try Jsoup!</a></li>
                        
                        <li><a href="/posts-output/clojure-java/">Understanding Java for Clojurists, side-by-side</a></li>
                        
                        

                        
                        <li class="divider"></li>
                        <li class="dropdown-header">Tags</li>
                        
                        <li><a href="/tags-output/game theory/">game theory</a></li>
                        
                        <li><a href="/tags-output/latex/">latex</a></li>
                        
                        <li><a href="/tags-output/cryogen/">cryogen</a></li>
                        
                        <li><a href="/tags-output/testing/">testing</a></li>
                        
                        <li><a href="/tags-output/clojure/">clojure</a></li>
                        
                        <li><a href="/tags-output/web/">web</a></li>
                        
                        <li><a href="/tags-output/machine-learning/">machine-learning</a></li>
                        
                        <li><a href="/tags-output/browsers/">browsers</a></li>
                        
                        <li><a href="/tags-output/postgresql/">postgresql</a></li>
                        
                        <li><a href="/tags-output/css/">css</a></li>
                        
                        <li><a href="/tags-output/java/">java</a></li>
                        
                        <li><a href="/tags-output/unicode/">unicode</a></li>
                        
                        <li><a href="/tags-output/osx/">osx</a></li>
                        
                        <li><a href="/tags-output/text-mining/">text-mining</a></li>
                        
                        <li><a href="/tags-output/haskell/">haskell</a></li>
                        
                        <li><a href="/tags-output/machinelearning/">machinelearning</a></li>
                        
                        <li><a href="/tags-output/flexbox/">flexbox</a></li>
                        
                        <li><a href="/tags-output/math/">math</a></li>
                        
                        <li><a href="/tags-output/shell/">shell</a></li>
                        
                        <li><a href="/tags-output/heroku/">heroku</a></li>
                        
                        <li><a href="/tags-output/blog/">blog</a></li>
                        
                        <li><a href="/tags-output/latin-1/">latin-1</a></li>
                        
                        <li><a href="/tags-output/reagent/">reagent</a></li>
                        
                        <li><a href="/tags-output/emacs/">emacs</a></li>
                        
                        <li><a href="/tags-output/datascience/">datascience</a></li>
                        
                        <li><a href="/tags-output/package management/">package management</a></li>
                        
                        <li><a href="/tags-output/git/">git</a></li>
                        
                        <li><a href="/tags-output/spacemacs/">spacemacs</a></li>
                        
                        <li><a href="/tags-output/functional programming/">functional programming</a></li>
                        
                        <li><a href="/tags-output/templates/">templates</a></li>
                        
                        <li><a href="/tags-output/r/">r</a></li>
                        
                        <li><a href="/tags-output/utf-8/">utf-8</a></li>
                        
                        <li><a href="/tags-output/object-oriented programming/">object-oriented programming</a></li>
                        
                        <li><a href="/tags-output/debugging/">debugging</a></li>
                        
                        <li><a href="/tags-output/meta/">meta</a></li>
                        
                        <li><a href="/tags-output/flask/">flask</a></li>
                        
                        <li><a href="/tags-output/markdown/">markdown</a></li>
                        
                        <li><a href="/tags-output/homebrew/">homebrew</a></li>
                        
                        <li><a href="/tags-output/devcards/">devcards</a></li>
                        
                        <li><a href="/tags-output/javascript/">javascript</a></li>
                        
                        <li><a href="/tags-output/system/">system</a></li>
                        
                        <li><a href="/tags-output/python/">python</a></li>
                        
                        <li><a href="/tags-output/webscraping/">webscraping</a></li>
                        
                        <li><a href="/tags-output/performance/">performance</a></li>
                        
                        <li><a href="/tags-output/closures/">closures</a></li>
                        
                        <li><a href="/tags-output/react/">react</a></li>
                        
                        <li><a href="/tags-output/data/">data</a></li>
                        
                        <li><a href="/tags-output/machine learning/">machine learning</a></li>
                        
                        <li><a href="/tags-output/algorithms/">algorithms</a></li>
                        
                        <li><a href="/tags-output/numpy/">numpy</a></li>
                        
                        <li><a href="/tags-output/clojurescript/">clojurescript</a></li>
                        
                        <li><a href="/tags-output/mustache/">mustache</a></li>
                        
                        <li><a href="/tags-output/test/">test</a></li>
                        
                        <li><a href="/tags-output/trees/">trees</a></li>
                        
                        
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-12">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">December 17, 2016</div>
        
    </div>
    <h2>Clojure basics: destructuring</h2>
</div>
<div>
    
     <p>I think destructuring is one of the harder things for total beginners to handle in Clojure, because the syntax is just really terse. When you get used to it, it makes the code more readable, but at the beginning, it makes the code lots less readable.   </p><p>There are some good destructuring tutorials out there (listed at the end), but none with live code execution (and the ability for readers to play around and tweak stuff) via the magic of <a href='https://github.com/viebel/klipse'>klipse</a>.  So here goes! </p><h2><a name="the&#95;basic&#95;idea"></a>The Basic Idea</h2><p>Destructuring is a way to concisely create local bindings from complex data structures. Here's an example.  Suppose you have a map, and you want to do something with it. </p><pre><code class="clojure">&#40;def a-triangle {:base 5 :height 10}&#41;
&#40;defn area &#91;triangle&#93;
&#40;let &#91;b &#40;:base triangle&#41; h &#40;:height triangle&#41;&#93;
&#40;&#42; b h 0.5&#41;&#41;&#41;
&#40;area a-triangle&#41;
</code></pre><p>But that's a lot of typing. Destructuring lets us do it smaller:</p><pre><code class="clojure">&#40;defn des1-area &#91;triangle&#93;
&#40;let &#91;{b :base h :height} triangle&#93;
&#40;&#42; b h 0.5&#41;&#41;&#41;
&#40;des1-area a-triangle&#41;
</code></pre><p>The let assignment there is our first example of destructuring. It says "pull the values at <code>:base</code> and <code>:height</code> from the map <code>triangle</code>, then assign them to the local symbols <code>b</code> and <code>h</code>."</p><p>But this is still too much typing.  We don't even need a let binding at all, because we can destructure right in a function definition. </p><pre><code class="clojure">&#40;defn des2-area &#91;{b :base h :height}&#93;
&#40;&#42; b h 0.5&#41;&#41;
&#40;des2-area a-triangle&#41;
</code></pre><p>That's more like it! Note how this second example of destructuring is just like the first, except that you don't need to pass the local name of the map to it, because the function destructures it before it even gets a local binding. </p><p>If you just want to use the same names as in the underlying map, the <code>:keys</code> option allows you to do so:</p><pre><code class="clojure">&#40;defn des3-area &#91;{:keys &#91;base height&#93;}&#93;
&#40;&#42; base height 0.5&#41;&#41;
&#40;des3-area a-triangle&#41;
</code></pre><p>There, the destructuring statement should be read as "take the map that I'm going to pass into this function, and then give me the keys that are listed in the vector, and locally bind their values to the symbol-ized forms of their keys."</p><p>Sadly, the <code>:keys</code> option doesn't appear to work with string keys. </p><pre><code class="clojure">&#40;def string-triangle {&quot;base&quot; 5 &quot;height&quot; 10}&#41;
&#40;des3-area string-triangle&#41;  ; :-&#40;
</code></pre><p>However, slightly more longwinded destructuring does:</p><pre><code class="clojure">&#40;defn des4-area &#91;{b &quot;base&quot; h &quot;height&quot;}&#93;
&#40;&#42; b h 0.5&#41;&#41;
&#40;des4-area string-triangle&#41;
</code></pre><p>And there's a happy surprise: <pre><code class="clojure">&#40;defn des5-area &#91;{:strs &#91;base height&#93;}&#93;
&#40;&#42; base height 0.5&#41;&#41;
&#40;des5-area string-triangle&#41;
 </code></pre></p><p>That's right: <code>:strs</code>:strings::<code>:keys</code>::keywords.</p><h3><a name="vectors&#95;(and&#95;other&#95;sequential&#95;data&#95;structures)&#95;too"></a>Vectors (and other sequential data structures) too</h3><p>Suppose you want to add the first two numbers from a vector of arbitrary size. Here's a simple non-destructurey way. </p><pre><code class="clojure">&#40;defn add-first-2 &#91;v&#93;
&#40;+ &#40;first v&#41; &#40;second v&#41;&#41;&#41;
&#40;add-first-2 &#91;1 2 3 4&#93;&#41;
</code></pre><p>With destructuring, you can just take pluck out variables in order from the vector. So our function becomes:</p><pre><code class="clojure">&#40;defn add-first-2d &#91;&#91;a b&#93;&#93;
&#40;+ a b&#41;&#41;
&#40;add-first-2d &#91;1 2 3 4&#93;&#41;
</code></pre><p>So what that destructuring form says is "take the sequential data structure you're passing into this function, pluck out the first two elements, and locally bind them the to the symbols a and b"</p><p>Suppose you want the first and the third?  Well, the convention is that you throw away an unused value with an underscore, so:</p><pre><code class="clojure">&#40;defn add-first-and-third &#91;&#91;a &#95; b&#93;&#93;
&#40;+ a b&#41;&#41;
&#40;add-first-and-third &#91;1 2 3 4&#93;&#41;
</code></pre><p>By the way, I meant it when I said "any sequence"&mdash;this includes strings, anything that can behave sequentially.</p><pre><code class="clojure">&#40;let &#91;&#91;fst &#95; thrd&#93; &quot;bar&quot;&#93; &#40;str fst thrd&#41;&#41;
</code></pre><p>You can even combine destructuring with the variable arguments <code>&amp;</code> trick to collect an indeterminate number of arguments into a list and then immediately destructure them. Though <a href='https://stuartsierra.com/2015/06/01/clojure-donts-optional-arguments-with-varargs'>Stuart Sierra says this is a bad idea</a>.</p><pre><code class="clojure">&#40;defn add-first-and-third-uncollected &#91;&amp; &#91;a &#95; b&#93;&#93;
&#40;+ a b&#41;&#41;
&#40;add-first-and-third-uncollected 1 2 3 4&#41;
</code></pre><p>Note how this works even though the numbers aren't collected into a vector.  Incidentally, you can also use the fancy ampersand <em>within</em> a destructuring statement to collect the tail of a sequence.</p><pre><code class="clojure">&#40;let &#91;&#91;v1 v2 &amp; the-rest&#93; &#40;range 10&#41;&#93;
&#91;v1 v2 &#40;apply + the-rest&#41;&#93;&#41;
</code></pre><p>While we're at it, let's look at nested data structures. First, we'll use the previous technique to make a vector with sequences in them. And, actually, let's learn a new technique in the process: you can also use <code>:as</code> in any destructuring operation to bind the entire destructured data structure to a name.  So:</p><pre><code class="clojure">&#40;def nested &#40;let &#91;&#91;v1 v2 &amp; the-rest :as everything&#93; &#40;range 10&#41;&#93;
  &#91;v1 v2 the-rest everything&#93;&#41;&#41;
nested
</code></pre><p>Now let's grab... say... the 1 from the first two numbers, nothing from the first sequence and the 2 from the second sequence. </p><pre><code class="clojure">&#40;let &#91;&#91;&#95; theone &#95; &#91;&#95; &#95; thetwo&#93;&#93; nested&#93; &#40;str theone thetwo&#41;&#41;
</code></pre><p>That's a little obscure-looking, here's a clearer one, fetching the items at the same positions: </p><pre><code class="clojure">&#40;def nested2 &#91;:a :b &#91;:c :d&#93; &#91;:e :f :g&#93;&#93;&#41;
&#40;let &#91;&#91;&#95; theone &#95; &#91;&#95; &#95; thetwo&#93;&#93; nested2&#93; &#40;str theone thetwo&#41;&#41;
</code></pre><p>So what you can see is that the inner vector in the let statement essentially said "let's start destructuring!"  And then from the first four values of the vector that we destructured (<code>:a:</code> <code>:b</code> and <code>&#91;:c :d&#93;</code>) we took only the second&mdash;so we threw out the first nested vector as a discard value. Then, continuing through the vector, we got to the second nested vector. Since we wanted to fetch something out of that, we put another inner vector in to say "let's destructure this vector now." And then we grabbed the third item in there.</p><p>You can also go a little crazy with the nesting and get maps inside vectors, and so on and so on.  Here's something a little ridiculous...</p><pre><code class="clojure">&#40;def ridiculous &#91;&quot;foo&quot; {:bar &quot;baz&quot; :bat &#91;1 2 3&#93;}&#93;&#41;
&#40;let &#91;&#91;&#95; {&#91;&#95; mynum &#95;&#93; :bat}&#93; ridiculous&#93; &#40;str mynum&#41;&#41;
</code></pre><p>See what I did there?  I took the second item in the vector, which was a map, grabbed the thing attached to <code>:bat</code>, which was a vector, and then grabbed the second item in it.</p><p>There are more fancy destructuring features, such as the :or keyword to supply default bindings in map destructuring, but this is enough for now. Go read the further reading for all of that. </p><h2><a name="comparison:&#95;python&#95;tuple&#95;unpacking"></a>Comparison: Python Tuple Unpacking</h2><p>For those coming to Clojure from Python, it's interesting to compare destructuring to one of my favorite syntactic features of the latter.<br /></p><p>A classic programming interview-type problem is how to swap the values of two variables without using a third variable. Most solutions involve <a href='http://www.geeksforgeeks.org/swap-two-numbers-without-using-temporary-variable/'>silliness with arithmetic</a>, but in python it's as simple as: </p><pre><code class="python">a = 0
b = 1
a, b = b, a
print&#40;&quot;a = &quot; + str&#40;a&#41;&#41;
print&#40;&quot;b = &quot; + str&#40;b&#41;&#41;
</code></pre><p>The closest equivalent I can come up with to this in Clojure puts the variables in a vector to be destructured, viz: </p><pre><code class="clojure">&#40;def v &#91;0 1&#93;&#41;
&#40;def v &#40;let &#91;&#91;a b&#93; v&#93; &#91;b a&#93;&#41;&#41;
v
</code></pre><p>or as a map, which can do the swapping right in the destructuring statement:</p><pre><code class="clojure">&#40;def ab {:a 0 :b 1}&#41;
&#40;def ab &#40;let &#91;{a :b b :a} ab&#93; {:a a :b b}&#41;&#41;
ab
</code></pre><p>Though I'm not sure if either technically respects the "no temp variables" rule since they do create temporary bindings in the let statements.  But both versions have the same general form of "unpack the first two variables, swap them without storing either one in a third."  And there's probably a more elegant way to do it. (Something to try at home: write a macro to do this to two variables on their own.)</p><p>But anyway, the python idea works the same.  The trick is that the <a href='https://www.tutorialspoint.com/python/python_tuples.htm'>comma creates a tuple</a>, and then the <a href='http://stackoverflow.com/a/14836456/4386239'>assignment unpacks that tuple from left to right</a>. So the left side of the assignment statement reaches in, and assigns a and b to the elements of the tuple on the right side, which you just created with the values in b and a. Though I think some of this stuff got screwed with in Python 3.</p><h2><a name="further&#95;reading"></a>Further reading</h2><ul><li><a href='http://clojure.org/guides/destructuring'>Official Clojure guide</a></li><li><a href='http://clojure.org/reference/special_forms#binding-forms'>A more abbreviated official Clojure explanation</a></li><li><a href='http://blog.jayfields.com/2010/07/clojure-destructuring.html'>Jay Fields tutorial</a></li><li><a href='https://gist.github.com/john2x/e1dca953548bfdfb9844'>John Louis Del Rosario tutorial</a> and <a href='http://www.john2x.com/blog/clojure-destructuring.html'>blog post</a></li><li><a href='http://blog.brunobonacci.com/2014/11/16/clojure-complete-guide-to-destructuring/'>Bruno Bonacci tutorial</a></li><li><a href='https://clojurebridge.github.io/community-docs/docs/clojure/destructuring/'>ClojureBridge destructuring examples</a></li><li><a href='http://www.braveclojure.com/do-things/#Defining_Functions'>Clojure for the Brave and True on defining functions</a> (scroll down a bit for destructuring section)</li><li><a href='https://www.laliluna.de/articles/2013/010/29/clojure-destructuring.html'>Sebastian Hennebrueder on destructuring</a></li></ul>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags-output/clojure/">clojure</a>
    
    <a href="/tags-output/python/">python</a>
    
</div>


    <div id="prev-next">
        
        <a href="/posts-output/anti-homebrew/">&laquo; Starting to distrust Homebrew...</a>
        
        
        <a class="right" href="/posts-output/basic-transducers/">Transducers for total beginners &raquo;</a>
        
    </div>

    


</div>

            </div>
        </div>
    </div>
    <footer>
        <p>Copyright &copy; 2016-2018 <a href="https://gowder.io">Paul Gowder</a>.</p>

        <p> All original content licensed under a <a rel="license" href="http://creativecoa rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a> mmons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>. </p>

        <p class="rc-scout"></p>
    </footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- HERE ARE A BUNCH OF PAUL CUSTOMIZATIONS -->
<!-- try to get heavy klipse stuff loaded only if post has executable content -->

<link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css">
<script>
 window.klipse_settings = {
     selector: '.clojure',
     selector_eval_python_client: '.python',
     selector_eval_js: '.javascript'
 };
</script>
<script src="https://storage.googleapis.com/app.klipse.tech/plugin/js/klipse_plugin.js"></script>


<!-- ditto mathjax -->



<script async defer src="https://www.recurse-scout.com/loader.js?t=883fcbc53dcca6e2fc6b228efe240125"></script>
</body>
</html>

