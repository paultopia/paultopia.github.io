<?xml version='1.0' encoding='UTF-8'?>
<rss version='2.0' xmlns:atom='http://www.w3.org/2005/Atom'>
<channel>
<atom:link href='http://paultopia.github.io' rel='self' type='application/rss+xml'/>
<title>
Experiments in Tech Blogging (!!)
</title>
<link>
http://paultopia.github.io
</link>
<description>
let's see, eh?
</description>
<lastBuildDate>
Wed, 17 Jan 2018 20:44:52 -0600
</lastBuildDate>
<generator>
clj-rss
</generator>
<item>
<guid>
http://paultopia.github.io/posts-output/jupyter-experiment-with-image/
</guid>
<link>
http://paultopia.github.io/posts-output/jupyter-experiment-with-image/
</link>
<title>
Experimental post: jupyter notebook --&gt; cryogen post
</title>
<description>
&lt;p&gt;This is an experiment to see if I can get a jupyter notebook to play nicely with Cryogen.  It looks like it works!  The workflow is to use &lt;a href='https://nbconvert.readthedocs.io/en/latest/usage.html'&gt;nbconvert&lt;/a&gt; to turn the notebook to markdown, and then to inline the images as base64.&lt;/p&gt;&lt;p&gt;The formatting is far from pretty, alas.&lt;/p&gt;&lt;p&gt;Here's the quick one-off script I used to inline the images from the nbconvert-generated markdown.  Everything below that script came from a jupyter notebook!&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;import re

def makeb64img&amp;#40;filename&amp;#41;:
    with open&amp;#40;filename, &amp;quot;rb&amp;quot;&amp;#41; as ju:
        data = ju.read&amp;#40;&amp;#41;
    return data.encode&amp;#40;&amp;quot;base64&amp;quot;&amp;#41;.replace&amp;#40;'\n', ''&amp;#41;

def swapout&amp;#40;match&amp;#41;:
    newstring = &amp;quot;data:image/png;base64,&amp;quot; + makeb64img&amp;#40;match.group&amp;#40;2&amp;#41;&amp;#41;
    return match.group&amp;#40;1&amp;#41; + newstring + match.group&amp;#40;3&amp;#41;

with open&amp;#40;&amp;quot;jupyter-experiment.md&amp;quot;&amp;#41; as je:
    post = je.read&amp;#40;&amp;#41;

regex = r&amp;quot;&amp;#40;!\&amp;#91;png\&amp;#93;\&amp;#40;&amp;#41;&amp;#40;.&amp;#42;png&amp;#41;&amp;#40;\&amp;#41;&amp;#41;&amp;quot;

newpage = re.sub&amp;#40;regex, swapout, post&amp;#41;

with open&amp;#40;&amp;quot;jupyter-experiment-with-image.md&amp;quot;, &amp;quot;w&amp;quot;&amp;#41; as je2:
    je2.write&amp;#40;newpage&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The content of the original notebook follows:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;print&amp;#40;&amp;quot;here's some code!&amp;quot;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;here's some code!&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;# and here's an image, stolen from seaborn examples at https://seaborn.pydata.org/examples/timeseries&amp;#95;from&amp;#95;dataframe.html 
import warnings
warnings.simplefilter&amp;#40;action='ignore', category=UserWarning&amp;#41;
%matplotlib inline
import seaborn as sns
sns.set&amp;#40;style=&amp;quot;darkgrid&amp;quot;&amp;#41;

gammas = sns.load&amp;#95;dataset&amp;#40;&amp;quot;gammas&amp;quot;&amp;#41;

sns.tsplot&amp;#40;data=gammas, time=&amp;quot;timepoint&amp;quot;, unit=&amp;quot;subject&amp;quot;,
           condition=&amp;quot;ROI&amp;quot;, value=&amp;quot;BOLD signal&amp;quot;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;&amp;lt;matplotlib.axes.&amp;#95;subplots.AxesSubplot at 0x111ecae48&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&quot;data:image/png;base64,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BAKBACEGAoFAIAAky7KsQi9CIBAIBIVFRAYCgUAgEGIgEAgEAiEGAoFAIECIgUAgEAgQYiAQCAQChBgIBAKBACEGAoFAIKBIxcA0Tb73ve9x6623ctddd3H48OFCL6lgJJNJ7r33Xu644w5uueUW/vjHPxZ6SQWno6ODyy67jAMHDhR6KQXlkUce4dZbb2XDhg0888wzhV5OwUgmk3zzm9/ktttu44477piw74tt27Zx1113AXD48GFuv/127rjjDr7//e9jmuawzy9KMXj99ddJJBI89dRTfPOb3+RHP/pRoZdUMF544QW8Xi9PPPEE//mf/8kPfvCDQi+poCSTSb73ve9hs9kKvZSCsmnTJj755BN+/etf8/jjj3PixIlCL6lgvP3226RSKZ588knuuece/u3f/q3QSxp3HnvsMf72b/+WeDwOwD/8wz/wjW98gyeeeALLskZ0E1mUYrBlyxbWrl0LwPLly9m5c2eBV1Q4rrnmGr7+9a8DYFkWiqIUeEWF5cc//jG33XYbVVVVhV5KQXn33Xepq6vjnnvu4atf/SqXX355oZdUMGbOnEk6ncY0TUKhEKo68Ua719bW8tBDD/X+u6GhgdWrVwNw6aWX8v777w97jKI8a6FQCJfL1ftvRVFIpVIT8pfsdDqBzDn5q7/6K77xjW8UeEWF47nnnqOsrIy1a9fy6KOPFno5BaWzs5Njx47x8MMP09LSwt13383LL7+MJEmFXtq443A4OHr0KNdeey2dnZ08/PDDhV7SuHP11VfT0tLS+2/LsnrfC06nk2AwOOwxijIycLlchMPh3n+bpjkhhaCH48eP84UvfIEbbriBz3zmM4VeTsF49tlnef/997nrrrvYvXs39913H21tbYVeVkHwer1ccskl6LrOrFmzMAwDn89X6GUVhF/84hdccsklvPLKKzz//PN8+9vf7t0umajI8qlLezgcxuPxDP+csVxQtqxcuZKNGzcCUF9fT11dXYFXVDja29v50z/9U+69915uueWWQi+noPzqV7/if//3f3n88cdZsGABP/7xj6msrCz0sgrCqlWreOedd7Asi9bWVqLRKF6vt9DLKggejwe32w1ASUkJqVSKdDpd4FUVloULF7Jp0yYANm7cyHnnnTfsc4rydnv9+vW899573HbbbViWxYMPPljoJRWMhx9+mEAgwE9/+lN++tOfAplk0URPoE501q1bx+bNm7nllluwLIvvfe97Ezaf9KUvfYnvfve73HHHHSSTSf76r/8ah8NR6GUVlPvuu4/777+ff/mXf2HWrFlcffXVwz5HWFgLBAKBoDi3iQQCgUAwvggxEAgEAoEQA4FAIBAIMRAIBAIBQgwEAoFAgBADwQQgGAzyta99jdbWVr7yla8UZA033HDDkN9vbm7mu9/97jitRiDojxADwTmP3++nsbGR6upqHnvssYKs4fnnnx/y+8eOHaO5uXmcViMQ9Ef0GQjOeb761a/y7rvvctlll7F7927eeOMNvv3tb2O329myZQvBYJDvfve7PP/88zQ2NnLllVfy7W9/m3Q6zT/+4z/y0UcfkU6n2bBhA1/60pfYtGkTDz30EKqqcvz4cZYuXcrf//3fo+s6zz77LD//+c+RJIlFixZx//3343Q6mTdvHnv27OGhhx6itbWVw4cPc/ToUT772c9y991385nPfIaWlhZuvPFGvv/97xf6lAkmIpZAcI7T3NxsrVu3rvdPy7Ks++67z/ra175mWZZlPffcc9aqVaus9vZ2KxgMWitWrLACgYD1xBNPWA8++KBlWZYVj8etO++809q8ebP14YcfWkuWLLEOHDhgmaZp/eVf/qX13//931ZjY6N15ZVXWj6fz7Isy3rggQesH/3oR5ZlWVZdXZ1lWZb17//+79Ytt9xixeNxq7293Vq+fLnl9/utDz/80LrzzjvH+9QIBL0UpR2FQDAeXHrppQDU1NQwd+5cysvLgYwJnN/v54MPPmD37t18+OGHAEQiEfbs2cOcOXM4//zzmTVrFpDJBzz99NNomsa6desoLS0F4NZbb+U73/lOv9dds2YNuq5TXl6O1+sdkaOkQDDWCDEQTFg0Tev9+0CuuOl0mnvvvZerrroKAJ/Ph8PhYNu2bX18gKzuORNnTpOyLItUKtXvuIZh9P5dkiQssVMrKAJEAllwzqOq6oAX5eG44IILePrpp0kmk4TDYe644w62bdsGZAYwtba2Ypomv/3tb7n00ktZvXo1b7zxBl1dXQA8/fTTrFmzZkSv1TOzQyAoFEIMBOc85eXl1NTUDLhlMxS33XYbM2bM4KabbuLmm29mw4YNvRf3qqoqvvWtb3HddddRXV3NZz/7WebPn89f/MVfcNddd3HNNdcQCARGPIxo9uzZBINB7r333lH/fAJBPhDVRALBKNm0aRP/8R//weOPP17opQgEeUNEBgKBQCAQkYFAIBAIRGQgEAgEAoQYCAQCgQAhBgKBQCBAiIFAIBAIEGIgEAgEAuD/BzeHeqzHPmjQAAAAAElFTkSuQmCC&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Wed, 17 Jan 2018 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/jsoup-is-awesome/
</guid>
<link>
http://paultopia.github.io/posts-output/jsoup-is-awesome/
</link>
<title>
For Clojure Webscraping, Try Jsoup!
</title>
<description>
 &lt;p&gt;When people want to do webscraping in Clojure, the standard recommendation/tutorial library is &lt;a href='https://github.com/cgrand/enlive'&gt;Enlive&lt;/a&gt;. (&lt;a href='http://masnun.com/2016/03/20/web-scraping-with-clojure.html'&gt;Example&lt;/a&gt;, &lt;a href='http://ericsomdahl.github.io/posts/2015-03-07-gevents1.html'&gt;and another&lt;/a&gt;, and there are at least two scraping libraries built on top of Enlive, &lt;a href='http://blog.shriphani.com/2016/01/25/pegasus-a-modular-durable-web-crawler-for-clojure/'&gt;Pegasus&lt;/a&gt; and &lt;a href='https://github.com/nathell/skyscraper'&gt;Skyscraper&lt;/a&gt;.) &lt;/p&gt;&lt;p&gt;But Enlive doesn't seem to be really built for scraping. For example, it's very difficult to actually get the text (the rough equivalent of browser api &lt;code&gt;document.innerText&lt;/code&gt;, minus ajax-loaded context) out of a html document, and when you can get text, it comes out badly formatted&amp;mdash;e.g., if you just pull all the text from the body tag, you don't get spaces between things like table rows and columns.  The best I can come up with to get decently formatted text without just walking all the individual DOM nodes myself is the following tangled mess (where &lt;code&gt;html&lt;/code&gt; is the Enlive html namespace and I've brought &lt;code&gt;replace&lt;/code&gt; and &lt;code&gt;trim&lt;/code&gt; in from clojure.string):&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn- space-out-punctuation &amp;#91;text&amp;#93; 
  &amp;#40;replace text #&amp;quot;&amp;#40;&amp;#91;.?!\&amp;quot;,:;“”\&amp;#41;\&amp;#40;\&amp;#91;\&amp;#93;\{\}&amp;#93;&amp;#41;&amp;quot; &amp;quot;$1 &amp;quot;&amp;#41;&amp;#41;

&amp;#40;defn- space-out-caps-diff &amp;#91;text&amp;#93; 
  &amp;#40;replace text #&amp;quot;&amp;#40;&amp;#91;a-z&amp;#93;&amp;#41;&amp;#40;&amp;#91;A-Z&amp;#93;&amp;#41;&amp;quot; &amp;quot;$1 $2&amp;quot;&amp;#41;&amp;#41;

&amp;#40;defn- space-out-letter-digit &amp;#91;text&amp;#93; 
  &amp;#40;replace text #&amp;quot;&amp;#40;\d&amp;#41;&amp;#40;&amp;#91;a-zA-Z&amp;#93;&amp;#41;&amp;quot; &amp;quot;$1 $2&amp;quot;&amp;#41;&amp;#41;

&amp;#40;defn- de-whitespace &amp;#91;text&amp;#93;
  &amp;#40;trim &amp;#40;replace text #&amp;quot;\s+&amp;quot; &amp;quot; &amp;quot;&amp;#41;&amp;#41;&amp;#41;

&amp;#40;defn extract-text &amp;#91;webpage&amp;#93;
  &amp;#40;-&amp;gt; webpage
      &amp;#40;html/select &amp;#91;:body&amp;#93;&amp;#41;
      &amp;#40;html/transform &amp;#91;:img&amp;#93; nil&amp;#41;
      &amp;#40;html/transform &amp;#91;:script&amp;#93; nil&amp;#41;
      &amp;#40;html/transform &amp;#91;:style&amp;#93; nil&amp;#41;
      html/texts
      first
      space-out-punctuation
      space-out-caps-diff
      space-out-letter-digit
      de-whitespace&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;By contrast, if you go to Javaland and use &lt;a href='https://jsoup.org/'&gt;Jsoup&lt;/a&gt;, extracting all the text from a parsed document is a simple method call. And the formatting isn't perfect, but it's better than I can do with all that ugly code with Enlive.&lt;/p&gt;&lt;p&gt;Similarly, suppose you want a list of links from your document.  That's pretty easy to do with Enlive... except if you want to resolve relative links to absolute links, e.g., for crawling, well, that requires pulling in a separate library to sort out the URLs and writing a few more functions.  (Fortunately, Chas Emerick has written a &lt;a href='https://github.com/cemerick/url'&gt;URL library&lt;/a&gt;, and, like all of Chas's libraries, it works beautifully.)&lt;/p&gt;&lt;p&gt;With Jsoup, that's another simple tweak to a single method call.&lt;/p&gt;&lt;p&gt;What this amounts to is that 50 or so lines of code using Enlive turn into 22 lines of code with Jsoup.  Here is all the code you need to fetch a page (admittedly, this needs error handling for failed requests), get out the text, and get a list of links, resolved to absolute URLs, with titles for every link: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;ns myscraper.core
  &amp;#40;:import &amp;#91;org.jsoup Jsoup&amp;#93;&amp;#41;&amp;#41;

&amp;#40;defn get-page-at-address &amp;#91;address&amp;#93;
  &amp;#40;let &amp;#91;conn &amp;#40;Jsoup/connect address&amp;#41;
        soup &amp;#40;.get conn&amp;#41;&amp;#93;
    soup&amp;#41;&amp;#41;

&amp;#40;defn extract-link-data &amp;#91;link&amp;#93;
  &amp;#40;let &amp;#91;linktext &amp;#40;.text link&amp;#41;
        address &amp;#40;.attr link &amp;quot;abs:href&amp;quot;&amp;#41;&amp;#93;
    {:linktext linktext :address address}&amp;#41;&amp;#41;

&amp;#40;defn extract-links &amp;#91;soup&amp;#93;
  &amp;#40;let &amp;#91;links &amp;#40;.select soup &amp;quot;a&amp;quot;&amp;#41;&amp;#93;
    &amp;#40;mapv extract-link-data links&amp;#41;&amp;#41;&amp;#41;

&amp;#40;defn fetch &amp;#91;address&amp;#93;
  &amp;#40;let &amp;#91;soup &amp;#40;get-page-at-address address&amp;#41;
        links &amp;#40;extract-links soup&amp;#41;
        text &amp;#40;.text soup&amp;#41;&amp;#93;
    {:soup soup :links links :text text}&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I'm really happy I finally took the trouble to get a handle on Clojure-Java interop&amp;mdash;there are a lot of really nice Java libraries out there!&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Further reading: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href='https://github.com/mischov/reaver'&gt;Reaver&lt;/a&gt;, a library someone built to leverage Jsoup in Clojure.&lt;/li&gt;&lt;li&gt;&lt;a href='http://josf.info/blog/2014/10/02/practical-zippers-extracting-text-with-enlive/'&gt;A blog post&lt;/a&gt; with an example of the manually-walking-the-DOM strategy to get text with Enlive.&lt;/li&gt;&lt;/ul&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Tue, 17 Oct 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/clojure-java/
</guid>
<link>
http://paultopia.github.io/posts-output/clojure-java/
</link>
<title>
Understanding Java for Clojurists, side-by-side
</title>
<description>
&lt;p&gt;I've been writing a lot of Clojure for almost two years now, but I never actually learned Java until recently, and primarily for the purpose of being able to use Java libraries in Clojure.&lt;/p&gt;&lt;p&gt;Until actually learning Java, I found interop (calling Java from Clojure code) the most difficult part of Clojure, mainly because Java has a lot of mental complexity that you need to take on&amp;mdash;IO, for example, tends to involve all kinds of BufferedThis and StreamingThat and casting across like 5 different types before you can do anything, and most tutorials on Clojure-Java interop assume you know that stuff, and also assume you know, e.g., what a static method is, and that a &quot;class&quot; is the name for both the basic organization of java source code &lt;em&gt;and&lt;/em&gt; the name for the compiled output files. Stuff like that.&lt;/p&gt;&lt;p&gt;Accordingly, the existing tutorials seem to be mostly limited to telling you how to instantiate Java objects and call methods on them, they leave off the more basic how-the-JVM-thinks kind of stuff.  I won't cover much of the stuff the usual tutorials do, but &lt;a href='http://xahlee.info/clojure/clojure_calling_java.html'&gt;here's a brief &amp; helpful example of a tutorial like that&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Instead, here's &lt;strong&gt;a quick example/mini-tutorial of working Clojure-Java interop that tries to assume pretty close to zero knowledge of Java, and only a basic working knowledge of Clojure&lt;/strong&gt;.&lt;/p&gt;&lt;p&gt;The task will be to generate a thumbnail of an image from the command line. At the end, we want to be able to type &quot;java -jar ourBigImage.jpg targetSmallImage.jpg&quot; and get a thumbnail out the other end.&lt;/p&gt;&lt;p&gt;First, we'll do it in Java, and then we'll do it in Clojure. All the code is &lt;a href='https://github.com/paultopia/interop-demo'&gt;housed on github&lt;/a&gt;.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;making&amp;#95;a&amp;#95;thumbnail&amp;#95;in&amp;#95;java&quot;&gt;&lt;/a&gt;Making a Thumbnail in Java&lt;/h3&gt;&lt;p&gt;We'll use the &lt;a href='https://github.com/rkalla/imgscalr'&gt;imgscalr&lt;/a&gt; library, which, although it hasn't been updated in a while, seems to be widely recommended. (&lt;strong&gt;IMPORTANT WARNING: don't click the external links on that github: last I checked the domains seem to have been hijacked by what looks suspiciously like malware sites.&lt;/strong&gt;) We'll also use the &lt;a href='https://gradle.org/'&gt;Gradle&lt;/a&gt; build tool, because Maven uses XML and XML is agony. &lt;/p&gt;&lt;h4&gt;&lt;a name=&quot;the&amp;#95;build&amp;#95;file&quot;&gt;&lt;/a&gt;The Build File&lt;/h4&gt;&lt;p&gt;First, install Gradle from the instructions at the link above.  Then we'll need a build.gradle file to set up the process.  Here's my build.gradle: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;groovy&quot;&gt;plugins {
id 'com.github.johnrengelman.shadow' version '2.0.1'
id 'java'
}

jar {
    manifest {
        attributes 'Main-Class': 'thumbnail.Thumbnail'
    }
}

dependencies {
             compile 'org.imgscalr:imgscalr-lib:4.2'    
}

repositories {
             mavenCentral&amp;#40;&amp;#41;          
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The first line is &lt;a href='http://imperceptiblethoughts.com/shadow/'&gt;a plugin&lt;/a&gt; that allows us to create an &lt;em&gt;uberjar&lt;/em&gt; &amp;mdash; one big jar file (a jar is essentially a tar.gz of compiled java files&amp;mdash;&quot;classes&quot; + resources, with a funny extension) with our code plus library code. Even though this is built into Leiningen for Clojureland, it isn't the default for Javaland. For whatever reason, the default behavior in Javaland is to create a jar without library code, requiring you to provide the libraries some other way.&lt;/p&gt;&lt;p&gt;Because we'll be using a library, and we don't want to mess around with putting that library on an explicit classpath, an uberjar will be much more convenient. Honestly, I haven't quite figured out how to use a library jar that isn't bundled into an uberjar yet.  But with this plugin we can just use &lt;code&gt;gradle shadowjar&lt;/code&gt; to build and everything will &lt;em&gt;just work&lt;/em&gt;.&lt;/p&gt;&lt;p&gt;The second line is the plugin to build Java projects. It turns out that Gradle can be used to compile lots of things, though I think it's mostly used for Java and Groovy (I think that this config file is written in Groovy, though I'm not sure)... and maybe Kotlin?&lt;/p&gt;&lt;p&gt;The jar/manifest block will tell Java where to find our main class, which is the entry point to the application. Java applications are organized into packages composed of classes, so this says &quot;go to the thumbnail package and the Thumbnail class, and you'll find the main method.&quot;&lt;/p&gt;&lt;p&gt;The rest of that file should be pretty self-explanatory.&lt;/p&gt;&lt;h4&gt;&lt;a name=&quot;the&amp;#95;code&quot;&gt;&lt;/a&gt;The Code&lt;/h4&gt;&lt;p&gt;Our only other file is src/main/java/Thumbnail.java, which is as follows: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;java&quot;&gt;package thumbnail;

import java.awt.image.BufferedImage;
import javax.imageio.ImageIO;
import java.io.File;
import java.io.IOException;
import org.imgscalr.Scalr;

public class Thumbnail {

    public static BufferedImage readImageFile&amp;#40;String filename&amp;#41; {
        BufferedImage image = null;
        try {
            image = ImageIO.read&amp;#40;new File&amp;#40;filename&amp;#41;&amp;#41;;
        }
        catch &amp;#40;IOException e&amp;#41; {
            System.err.println&amp;#40;e.getMessage&amp;#40;&amp;#41;&amp;#41;;
        }
        return image;
    }

    public static BufferedImage scale&amp;#40;BufferedImage inImage&amp;#41;{
        BufferedImage outImage = Scalr.resize&amp;#40;inImage, 200&amp;#41;;
        return outImage;
    }

    public static void main&amp;#40;String&amp;#91;&amp;#93; args&amp;#41; {
        String inFile = args&amp;#91;0&amp;#93;;
        String outFile = args&amp;#91;1&amp;#93;;
        try {
            BufferedImage inImage = readImageFile&amp;#40;inFile&amp;#41;;
            BufferedImage outImage = scale&amp;#40;inImage&amp;#41;;
            ImageIO.write&amp;#40;outImage, &amp;quot;jpg&amp;quot;, new File&amp;#40;outFile&amp;#41;&amp;#41;;
        }
        catch &amp;#40;IOException e&amp;#41;{
            System.err.println&amp;#40;e.getMessage&amp;#40;&amp;#41;&amp;#41;;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let's break this down.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;First we have our package declaration, which just helps the compiler organize the code.&lt;/p&gt;&lt;p&gt;Then we have a bunch of imports.  We're importing the built-in types (classes) &lt;code&gt;BufferedImage&lt;/code&gt; and &lt;code&gt;File&lt;/code&gt; which we need to use to read in and write out our data. Java is statically typed, and, like I said, IO tends to involve lots of casts.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;We also have to import the exception that we're going to have to handle, because &lt;a href='https://docs.oracle.com/javase/tutorial/essential/exceptions/catchOrDeclare.html'&gt;Java makes you explicitly throw or handle almost all exceptions&lt;/a&gt;. &lt;/p&gt;&lt;p&gt;Finally, we have to import the library that we're using. It provides one class that we need, &lt;code&gt;Scalr&lt;/code&gt;, and we'll just be using one static method from that class, &lt;code&gt;Scalr.resize&amp;#40;&amp;#41;&lt;/code&gt;.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;FYI, a &lt;em&gt;static method&lt;/em&gt; is a method that you can call like a normal function, that's attached to the name of a class. The alternative is an &lt;em&gt;instance method&lt;/em&gt;, which is a method that is attached to an instance of a class. For example, if we have a &lt;code&gt;String&lt;/code&gt; object named &lt;code&gt;stringeyMcStringFace&lt;/code&gt; then to get the number of characters we'd call the instance method &lt;code&gt;stringeyMcStringFace.length&amp;#40;&amp;#41;&lt;/code&gt;.  We can't call it as a static method like &lt;code&gt;String.length&amp;#40;stringeyMcStringFace&amp;#41;&lt;/code&gt; &amp;mdash; that would fail to compile.&lt;/p&gt;&lt;p&gt;After the imports, we create our class &lt;code&gt;Thumbnail&lt;/code&gt;.  This isn't actually going to do any object-oriented stuff (maybe I'll write a part 2 of this tutorial for that). Instead, we're just going to use the class as, essentially, a namespace.  That means instead of instantiating it (making objects out of our class that combine state and functionality), we're just going to hang a few static methods on it.&lt;/p&gt;&lt;p&gt;The first method, &lt;code&gt;readImageFile&lt;/code&gt; is just a helper method for IO. It declares and instantiates a &lt;code&gt;BufferedImage&lt;/code&gt;, and then it tries to read a file with the filename it's passed. Because this can throw an &lt;code&gt;IOException&lt;/code&gt;, we have to wrap it in a try/catch. Also note how we have to explicitly instantiate a &lt;code&gt;File&lt;/code&gt; object to pass to &lt;code&gt;ImageIO.read&amp;#40;&amp;#41;&lt;/code&gt;, which returns our &lt;code&gt;BufferedImage&lt;/code&gt;.  This is Java, it's gonna be verbose.&lt;/p&gt;&lt;p&gt;The second method just wraps the method we got from imgscalr. It's mostly in there for comparision with the equivalent Clojure code in a bit. The second argument to the &lt;code&gt;resize&lt;/code&gt; method is the maximum size of our output image, which I've hardcoded in for simplicity.&lt;/p&gt;&lt;p&gt;The last method is our main method.  It's the entry point that will be called from the command line, and it always has the same signature and name in every Java program. It's pretty self-explanatory: we read the filenames off the commandline, then we read the filenames from the argument and pass them to the other methods we've defined.  Then we write it back out, again using &lt;code&gt;ImageIO&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;That's it!  If you clone the repository, go to javathumbnail/thumbnail, and compile with &lt;code&gt;gradle shadowjar&lt;/code&gt; this will give you a jar file.  Then if you go to the root directory of the repo (with the the sample image) and run &lt;code&gt;java -jar javathumbnail/thumbnail/build/libs/thumbnail-all.jar bigkitty.jpg smallkitty-java.jpg&lt;/code&gt; we should get a very cute small kitty!&lt;/p&gt;&lt;p&gt;His name is Leonidas.  He's the sweetest. &lt;/p&gt;&lt;p&gt;Let's look at the equivalent in Clojure!&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;making&amp;#95;a&amp;#95;thumbnail&amp;#95;in&amp;#95;clojure&quot;&gt;&lt;/a&gt;Making a Thumbnail in Clojure&lt;/h3&gt;&lt;p&gt;Instead of Gradle now we'll use Leiningen. Here's our project.clj:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defproject thumbnail &amp;quot;0.1.0-SNAPSHOT&amp;quot;
  :dependencies &amp;#91;&amp;#91;org.clojure/clojure &amp;quot;1.8.0&amp;quot;&amp;#93;
                 &amp;#91;org.imgscalr/imgscalr-lib &amp;quot;4.2&amp;quot;&amp;#93;&amp;#93;
  :main &amp;#94;:skip-aot thumbnail.core
  :target-path &amp;quot;target/%s&amp;quot;
  :profiles {:uberjar {:aot :all}}&amp;#41;

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Because I'm assuming some basic Clojure knowledge, I won't go into too much detail here, but note that you can fetch a Java library from Maven Central in exactly the same way as you'd fetch a Clojure library from Clojars. Leiningen makes it seamless.&lt;/p&gt;&lt;p&gt;The only other file we need is our src/thumbnail/core.clj:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;ns thumbnail.core
  &amp;#40;:gen-class&amp;#41;
  &amp;#40;:require &amp;#91;clojure.java.io :as io&amp;#93;&amp;#41;
  &amp;#40;:import &amp;#91;org.imgscalr Scalr&amp;#93;
           &amp;#91;java.awt.image BufferedImageOp&amp;#93;
           &amp;#91;javax.imageio ImageIO&amp;#93;&amp;#41;&amp;#41;

&amp;#40;defn read-image &amp;#91;filename&amp;#93;
  &amp;#40;ImageIO/read &amp;#40;io/file filename&amp;#41;&amp;#41;&amp;#41;

&amp;#40;defn scale &amp;#91;image&amp;#93;
  &amp;#40;Scalr/resize image 200 &amp;#40;into-array BufferedImageOp &amp;#91;&amp;#93;&amp;#41;&amp;#41;&amp;#41;

&amp;#40;defn -main
  &amp;#91;infile outfile&amp;#93;
  &amp;#40;let &amp;#91;image &amp;#40;read-image infile&amp;#41;
        scaled &amp;#40;scale image&amp;#41;&amp;#93;
    &amp;#40;ImageIO/write scaled &amp;quot;jpg&amp;quot; &amp;#40;io/file outfile&amp;#41;&amp;#41;&amp;#41;&amp;#41;

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Again, I'm assuming you already know Clojure, so I'm only going to explain the interop bits.&lt;/p&gt;&lt;p&gt;First, note that in addition to &lt;code&gt;&amp;#40;:require&amp;#41;&lt;/code&gt; in our ns declaration we also have &lt;code&gt;&amp;#40;:import&amp;#41;&lt;/code&gt;. The format of an import is that we give it the Java package identifier and then any classes we want from that package, separated by spaces.  So if we wanted to import multiple classes from &lt;code&gt;java.awt.image&lt;/code&gt; we could do an import like &lt;code&gt;&amp;#91;java.awt.image BufferedImageOp BufferedImage&amp;#93;&lt;/code&gt;. (Incidentally, I'll explain this &lt;code&gt;BufferedImageOp&lt;/code&gt; business in a minute).&lt;/p&gt;&lt;p&gt;We'll also want to require the &lt;code&gt;clojure.java.io&lt;/code&gt; built-in namespace, which wraps some of that Java verbosity. Note, however, that we do not need to import errors&amp;mdash;we're in Clojure now, we don't have to explicitly catch them!&amp;mdash;and we don't need to import the types we're using either, Clojure will just let us use reflection to sort them out. (Reflection is the capacity of the JVM to inspect an object and figure out what type it is. I believe, though I'm not sure, that a lot of the reflection here happens on the compilation end: the Clojure compiler figures out that &lt;code&gt;ImageIO/read&lt;/code&gt; has to return a &lt;code&gt;BufferedImage&lt;/code&gt;, for example, and hence can verify that &lt;code&gt;Scalr/resize&lt;/code&gt; is going to get the right type for the first argument.)&lt;/p&gt;&lt;p&gt;Thus, &lt;code&gt;read-image&lt;/code&gt; is a much less verbose version of &lt;code&gt;readImageFile&lt;/code&gt; from the Java side that does exactly the same thing: &lt;code&gt;io/file&lt;/code&gt; &lt;a href='https://clojure.github.io/clojure/clojure.java.io-api.html#clojure.java.io/file'&gt;returns a Java File&lt;/a&gt; which we can then pass straight to the static &lt;code&gt;read&amp;#40;&amp;#41;&lt;/code&gt; method of the &lt;code&gt;ImageIO&lt;/code&gt; class by calling &lt;code&gt;ImageIO/read&lt;/code&gt; just as if it were a Clojure function. &lt;/p&gt;&lt;p&gt;Likewise, &lt;code&gt;scale&lt;/code&gt; is pretty straightforward: we call the static method from the imported library as before. &lt;/p&gt;&lt;p&gt;There is one little glitch at the end, though. It turns out that if we look at &lt;a href='https://github.com/rkalla/imgscalr/blob/2fac6c4c0d0e857d31daeed1e670c937e2c7ef70/src/main/java/org/imgscalr/Scalr.java#L1124'&gt;the signature for the resize method&lt;/a&gt;, it actually has three parameters. The third is a &lt;a href='https://docs.oracle.com/javase/tutorial/java/javaOO/arguments.html'&gt;varargs&lt;/a&gt; parameter, which means it takes an array of objects of type &lt;code&gt;BufferedImageOp&lt;/code&gt;.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;We don't actually need to give that parameter anything for our simple example, and the Java compiler is kind enough that it will let us leave off a varargs parameter entirely if we don't need it. Unfortunately, the Clojure compiler is not so generous (this might be the only case in the entire history of coding where Clojure is more verbose than Java), and makes us explicitly pass these arguments in.&lt;/p&gt;&lt;p&gt;Accordingly, we have to construct an empty array that would have the Java type &lt;code&gt;BufferedImageOp&amp;#91;&amp;#93;&lt;/code&gt; (that's Java-ese for an array of &lt;code&gt;BufferedImageOp&lt;/code&gt;s, where a &lt;code&gt;BufferedImageOp&lt;/code&gt; is just... I'm not sure, but it's the thing that the signature of &lt;code&gt;resize&lt;/code&gt; demands, so it's what we have to give it) and pass that into &lt;code&gt;resize&lt;/code&gt; as the third argument.  The &lt;a href='http://clojuredocs.org/clojure.core/into-array'&gt;into-array&lt;/a&gt; function in clojure.core provides that capacity. Arrays are super primitive, and the JVM needs a type even for a zero-length array. &lt;/p&gt;&lt;p&gt;The main function is self-explanatory after all that&amp;mdash;it's just a direct translation of method calls to Clojure function calls.&lt;/p&gt;&lt;p&gt;And we're done!  &lt;code&gt;lein uberjar&lt;/code&gt; from the clojure project root, plus &lt;code&gt;java -jar clojurethumbnail/thumbnail/target/uberjar/thumbnail-0.1.0-SNAPSHOT-standalone.jar bigkitty.jpg smallkitty-clojure.jpg&lt;/code&gt; from the  will give us the same cute kitty as before!&lt;/p&gt;&lt;p&gt;Resources: &lt;/p&gt;&lt;p&gt;&lt;a href='http://www.flyingmachinestudios.com/programming/refactoring-to-datamappers-in-clojure/'&gt;A real-world example of using imgscalr from Clojure&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href='https://gist.github.com/jkk/3959731'&gt;Another more complicated example of using imgscalr from Clojure&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href='https://stackoverflow.com/a/18501367/4386239'&gt;StackOverflow answer explaining the varargs quirk&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href='https://dev.clojure.org/jira/browse/CLJ-440'&gt;JIRA issue on Clojure for fixing the varargs quirk, has been open for over 7 years (!!!)&lt;/a&gt;&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Fri, 06 Oct 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/text-encoding-browser/
</guid>
<link>
http://paultopia.github.io/posts-output/text-encoding-browser/
</link>
<title>
I think I've figured out how to change text encodings in the browser. I'm not sure, because it's text encodings, but maybe?
</title>
<description>
 &lt;p&gt;So I'm working on a slightly irrational project, namely, extracting citations from MS-Word formatted law review articles and generating bibtex download + on-screen display, in pure client-side Javascript.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;This has a lot of steps to it, but the browser is a surprisingly good platform for doing it (and an unbeatable platform for delivery).&lt;/p&gt;&lt;p&gt;Basically, a docx file is a zip file with a different extension, and each of the files inside is an XML file encoded in Latin-1 (or the &lt;a href='https://stackoverflow.com/a/19111140/4386239'&gt;slightly different windows-1252&lt;/a&gt;, but either way, not nice sensible UTF-8, which is why you get a bunch of &lt;a href='https://en.wikipedia.org/wiki/Mojibake'&gt;mojibake&lt;/a&gt; whenever you copy text from Word into anything else).  So this means there are three steps to making it into something useful:&lt;/p&gt;&lt;p&gt;Step 1: Get the contents unzipped out of the docx format.  &lt;a href='https://gildas-lormeau.github.io/zip.js/'&gt;Zipjs&lt;/a&gt; is a very good zip library that handles this task with no problem, it's as simple as hanging a listener on a file upload form that converts to a blob and then passes to &lt;code&gt;zip.BlobReader&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Step 2: Parse the XML.  It might be surprising, but it shouldn't be, to learn that the browser is a really good platform for XML parsing. Since, after all, parsing XML is &lt;a href='https://softwareengineering.stackexchange.com/questions/93296/relation-and-differences-between-sgml-xml-html-and-xhtml'&gt;basically the same task&lt;/a&gt; as parsing HTML. It's as straightforward as:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;javascript&quot;&gt;function parseXML&amp;#40;xmlstring&amp;#41;{
    var parser = new DOMParser&amp;#40;&amp;#41;;
    return parser.parseFromString&amp;#40;xmlstring, &amp;quot;text/xml&amp;quot;&amp;#41;;}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;and then you can use normal DOM methods and attributes to navigate and get things from the XML, just as if it were a HTML page.&lt;/p&gt;&lt;p&gt;Step 3. Display some intermediate results on a web page. You've got strings, display them.&lt;/p&gt;&lt;p&gt;Step 4. Convert the crazy windows encoding to something more rational. This is the fun part. &lt;/p&gt;&lt;p&gt;Ideally, we'd do this before step 2, but we can't have everything. As it turns out, the browser is perfectly capable of identifying cray Microsoft encodings when they come from a docx file and parsing the XML/displaying them properly on screen without conversion. I'm not sure whether this is Zipjs or something in Chrome performing this magic (or being told to do so by something in the docx/underlying XML), but it works, so I'm not going to look a gift horse in the mouth.&lt;/p&gt;&lt;p&gt;(Incidentally, if you open up the Javascript console and look at &lt;code&gt;document.characterSet&lt;/code&gt;, you'll see the character encoding Chrome thinks it's using; for text parsed from at least the docx on my machine it sees windows-1252, and manages to display special characters correctly, including the usually problematic ones like en-dashes.)&lt;/p&gt;&lt;p&gt;However, like I said, I want to ultimately give the user a bibtex file to download. Maybe other downloads too. And I simply will &lt;em&gt;not&lt;/em&gt; have those things be in windows-1252 or latin-1 or any other such ridiculousness. UTF-8 or bust. &lt;/p&gt;&lt;p&gt;It turns out that there's no good information on how to do this in the browser. There are a couple of &lt;a href='https://stackoverflow.com/a/5396742/4386239'&gt;obsolete Stack Overflow answers&lt;/a&gt; that essentially tell you to use &lt;code&gt;decodeURIComponent&amp;#40;escape&amp;#40;string&amp;#41;&amp;#41;;&lt;/code&gt; or maybe &lt;code&gt;unescape&amp;#40;encodeURIComponent&amp;#40;originalstring&amp;#41;&amp;#41;;&lt;/code&gt;, but neither actually works. &lt;/p&gt;&lt;p&gt;Fortunately, it looks like you can coerce a string encoding change in the browser Blob constructor. (At least, this works on my machine, in the latest version of Chrome). &lt;/p&gt;&lt;p&gt;So here's my solution. This &lt;em&gt;appears&lt;/em&gt; to work to take an in-memory string in windows-1252 and produce a link to a downloadable text file in UTF-8, as desired: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;javascript&quot;&gt;function experimentalUTF8Download&amp;#40;latin1string&amp;#41;{
    var b = new Blob&amp;#40;&amp;#91;latin1string&amp;#93;, {type: &amp;quot;text/plain;charset=UTF-8&amp;quot;}&amp;#41;;
    var linkurl = URL.createObjectURL&amp;#40;b&amp;#41;;
    var a = document.createElement&amp;#40;'a'&amp;#41;;
    var linkText = document.createTextNode&amp;#40;&amp;quot;foo&amp;quot;&amp;#41;;
    a.appendChild&amp;#40;linkText&amp;#41;;
    a.href = linkurl;
    document.body.appendChild&amp;#40;a&amp;#41;;
    }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The key is in line 2: you coerce the character set of the Blob you're creating to be UTF-8.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;evidence&amp;#95;that&amp;#95;this&amp;#95;works?&quot;&gt;&lt;/a&gt;Evidence that this works?&lt;/h3&gt;&lt;p&gt;Like I said, this &lt;em&gt;appears&lt;/em&gt; to work. Because there isn't exactly a direct way of telling, I used a couple of different methods to get what I consider to be circumstantial evidence that this is the correct encoding: &lt;/p&gt;&lt;p&gt;&lt;strong&gt;First:&lt;/strong&gt;  When I open the resulting file in the browser, it comes out garbled (with mojibake in the appropriate places, like those en-dashes I mentioned before), and &lt;code&gt;document.characterSet&lt;/code&gt; is still &quot;windows-1252&quot;. I infer from this that Chrome doesn't know to change the characterset from the previous html file, but it can't parse the new file&amp;mdash;because it isn't windows-1252 any more!&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Second:&lt;/strong&gt;  Reading the file in Python3 with no arguments to the &lt;code&gt;open&amp;#40;&amp;#41;&lt;/code&gt; constructor &lt;a href='https://docs.python.org/3/library/functions.html#open'&gt;defaults to your platform's default characterset&lt;/a&gt; (the output of &lt;code&gt;locale.getpreferredencoding&amp;#40;&amp;#41;&lt;/code&gt;), which in my case is utf-8. &lt;/p&gt;&lt;p&gt;I can read the file in Python3 without passing any arguments, i.e., &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;with open&amp;#40;&amp;quot;foo.txt&amp;quot;&amp;#41; as f:
    foo = f.read&amp;#40;&amp;#41;
foo
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;and the en-dashes come out looking right in the REPL. &lt;/p&gt;&lt;p&gt;&lt;strong&gt;Third:&lt;/strong&gt; When I try to open the file as windows-1252, Python3 throws a &lt;code&gt;UnicodeDecodeError&lt;/code&gt; error, and when I try to open it as latin-1 (the other obvious suspect) it doesn't throw, but it does mojibake at me. &lt;/p&gt;&lt;p&gt;These three pieces of evidence seem to very strongly suggest that I've successfully coerced the encodings in the Blob for download.  So: YAY!! Take that, obsolete Microsoft encodings!&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Tue, 05 Sep 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/flask-heroku-postgres/
</guid>
<link>
http://paultopia.github.io/posts-output/flask-heroku-postgres/
</link>
<title>
The Easiest Possible Way to Throw a Webapp Online (Flask + Heroku + Postgres)
</title>
<description>
&lt;p&gt;Here's a situation that comes up a lot.  I want to throw together a quick CRUD app, or, for my uses, more of a C app (i.e., &quot;hey research assistants, dump all this stuff into a database&quot;).  I could use a google form or something, but that always leads to weird output, like bizarre formatting, out in google sheets.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;So I'm getting into Flask on Heroku for this kind of thing, for several reasons: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;No wrangling around with database connections and such. You don't even need to give your code the environment variable to connect to postgres if you use the flask-heroku library.&lt;/li&gt;&lt;li&gt;Making changes is seriously just pushing to a git remote.&lt;/li&gt;&lt;li&gt;You can use interact with a real database shell via &lt;code&gt;heroku pg:psql&lt;/code&gt;, &lt;em&gt;or&lt;/em&gt; you can write canned queries and look at them online, or you can even sync them to google sheets (though that last one seems a bit shaky).&lt;/li&gt;&lt;li&gt;Logs are just as simple as &lt;code&gt;heroku logs&lt;/code&gt; and logging something from the application is just &lt;code&gt;print&amp;#40;&amp;#41;&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;No mess with ngnix and other server config stuff.&lt;/li&gt;&lt;li&gt;HTTPS is handled for you too, at least on applications served from herokuapp.com. Which is real nice, obviously.&lt;/li&gt;&lt;li&gt;By the way, you get a falls-asleep-a-lot-but-good-enough-for-tiny-projects + 10k postgres rows for free.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;So let's walk through the simplest possible setup.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;step&amp;#95;1:&amp;#95;setup&amp;#95;and&amp;#95;install&amp;#95;all&amp;#95;the&amp;#95;things.&quot;&gt;&lt;/a&gt;Step 1: setup and install all the things.&lt;/h2&gt;&lt;p&gt;(Installation details will depend on your platform, so I'll leave that for you to google.)&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Get a Heroku account and &lt;a href='https://devcenter.heroku.com/articles/heroku-cli'&gt;install the heroku cli&lt;/a&gt;.&lt;/li&gt;&lt;li&gt;Make sure all your code is in a git repo, as we'll be using git to push to Heroku.&lt;/li&gt;&lt;li&gt;Install postgres locally, so you can use Heroku psql, pull down from Heroku to a local database, etc.&lt;/li&gt;&lt;li&gt;Set up a python virtual environment. This is usually a good idea anyway, but particularly important here because you'll be using &lt;code&gt;pip freeze&lt;/code&gt; to get the requirements for Heroku, so you want to make sure you have a self-contained and reproducible environment.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;I'm a big anaconda fan, so I just use &lt;a href='https://conda.io/docs/user-guide/tasks/manage-environments.html'&gt;conda&lt;/a&gt; to handle this for me, but other virtual environment managers should work fine too.&lt;/p&gt;&lt;p&gt;Incidentally, the following code assumes the latest version of Python 3. It'll probably work fine on Python 2 as well, but who really knows?&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Pip-install the following libraries.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;strong&gt;Flask&lt;/strong&gt; &amp;mdash; of course, this is a Flask-based tutorial. It's about the easiest possible way to get basic web stuff happening in Python.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Flask-Heroku&lt;/strong&gt; &amp;mdash; this is just a very simple library that takes care of getting the heroku environment variables and passing them to your flask application in the right way. Not strictly necessary, but why make life harder for yourself?&lt;/p&gt;&lt;p&gt;&lt;strong&gt;SQLAlchemy&lt;/strong&gt; &amp;mdash; the standard library for connecting to a relational database in Python. It's really complicated, but it seems to work fine for me while only brushing the absolute surface, and with the help of the next library. &lt;/p&gt;&lt;p&gt;It's worth noting that SQLAlchemy, contrary to the Zen of Python, seems to have a million different ways to do everything, so different tutorials and documentation might have slightly different approaches to the table creation syntax and such.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Flask-SQLAlchemy&lt;/strong&gt; &amp;mdash; simplifies the SQLAlchemy API for Flask purposes.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Psycopg2&lt;/strong&gt; &amp;mdash; Postgres database driver.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Gunicorn&lt;/strong&gt; &amp;mdash; just a communication layer between the server and your code, probably not strictly mandatory in quick-and-dirty hack-together apps with only a couple of users, but never hurts and can help manage lots of requests at once should they happen. For more, see &lt;a href='https://www.fullstackpython.com/wsgi-servers.html'&gt;this explanation of WSGI&lt;/a&gt;, and &lt;a href='https://ironboundsoftware.com/blog/2016/06/27/faster-flask-need-gunicorn/'&gt;this real-life account&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;step&amp;#95;2:&amp;#95;write&amp;#95;some&amp;#95;code&quot;&gt;&lt;/a&gt;Step 2: Write some code&lt;/h2&gt;&lt;p&gt;Let's do a basic app, shall we?  For the purposes of our minimal example, let's stick all of this in a file called app.py.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;a.&amp;#95;the&amp;#95;basics:&quot;&gt;&lt;/a&gt;A. the basics:&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;from flask import Flask, render&amp;#95;template, url&amp;#95;for
from flask&amp;#95;sqlalchemy import SQLAlchemy
import sys
import json
from flask&amp;#95;heroku import Heroku
app = Flask&amp;#40;&amp;#95;&amp;#95;name&amp;#95;&amp;#95;&amp;#41;
app.config&amp;#91;'SQLALCHEMY&amp;#95;TRACK&amp;#95;MODIFICATIONS'&amp;#93; = False
heroku = Heroku&amp;#40;app&amp;#41;
db = SQLAlchemy&amp;#40;app&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Most of the work here is just creating objects in the global namespace that will hold your app and database.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;The &lt;code&gt;Heroku&amp;#40;app&amp;#41;&lt;/code&gt; line just &lt;a href='https://github.com/kennethreitz/flask-heroku'&gt;puts your environment variables where they need to be&lt;/a&gt;. &lt;/p&gt;&lt;p&gt;The &lt;code&gt;app.config&amp;#91;'SQLALCHEMY&amp;#95;TRACK&amp;#95;MODIFICATIONS'&amp;#93; = False&lt;/code&gt; line is to &lt;a href='https://stackoverflow.com/questions/33738467/how-do-i-know-if-i-can-disable-sqlalchemy-track-modifications/33790196#33790196'&gt;fix performance hits from a bad default config (and silence an annoying warning)&lt;/a&gt;. &lt;/p&gt;&lt;p&gt;The rest should be pretty clear.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;b.&amp;#95;set&amp;#95;up&amp;#95;a&amp;#95;database&quot;&gt;&lt;/a&gt;B. Set up a database&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;class Dataentry&amp;#40;db.Model&amp;#41;:
    &amp;#95;&amp;#95;tablename&amp;#95;&amp;#95; = &amp;quot;dataentry&amp;quot;
    id = db.Column&amp;#40;db.Integer, primary&amp;#95;key=True&amp;#41;
    mydata = db.Column&amp;#40;db.Text&amp;#40;&amp;#41;&amp;#41;

    def &amp;#95;&amp;#95;init&amp;#95;&amp;#95;&amp;#40;self, mydata&amp;#41;:
        self.mydata = mydata
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Pretty straightforward. You create a class that inherits from the model class that your db object brought in, and then you put the table schema into the fields of that class. &lt;/p&gt;&lt;p&gt;SQLAlchemy will &lt;a href='http://docs.sqlalchemy.org/en/rel_1_1/core/metadata.html#sqlalchemy.schema.Column.params.autoincrement'&gt;happily auto-increment an integer primary key for you&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Whatever columns you want, you can declare and pass their type.  SQLAlchemy has &lt;a href='http://docs.sqlalchemy.org/en/latest/core/types.html'&gt;a bunch of types available&lt;/a&gt;, including all the basics, but also database-vendor-specific types, different flavors of datetimes, etc.&lt;/p&gt;&lt;p&gt;Then the constructor (&lt;a href='http://spyhce.com/blog/understanding-new-and-init'&gt;ok, really the initializer&lt;/a&gt;) for an object just sets the properties based on data received from users. &lt;/p&gt;&lt;p&gt;Hey, maybe we should get some data?&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;c.&amp;#95;set&amp;#95;up&amp;#95;a&amp;#95;route&amp;#95;to&amp;#95;receive&amp;#95;data&quot;&gt;&lt;/a&gt;C. Set up a route to receive data&lt;/h3&gt;&lt;p&gt;I'm assuming here that we're just using a standard HTML form that generates a post request, so let's set up a route to receive that. &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;@app.route&amp;#40;&amp;quot;/submit&amp;quot;, methods=&amp;#91;&amp;quot;POST&amp;quot;&amp;#93;&amp;#41;
def post&amp;#95;to&amp;#95;db&amp;#40;&amp;#41;:
    indata = Dataentry&amp;#40;request.form&amp;#91;'mydata'&amp;#93;&amp;#41;
    data = copy&amp;#40;indata.&amp;#95;&amp;#95;dict&amp;#95;&amp;#95;&amp;#41;
    del data&amp;#91;&amp;quot;&amp;#95;sa&amp;#95;instance&amp;#95;state&amp;quot;&amp;#93;
    try:
        db.session.add&amp;#40;indata&amp;#41;
        db.session.commit&amp;#40;&amp;#41;
    except Exception as e:
        print&amp;#40;&amp;quot;\n FAILED entry: {}\n&amp;quot;.format&amp;#40;json.dumps&amp;#40;data&amp;#41;&amp;#41;&amp;#41;
        print&amp;#40;e&amp;#41;
        sys.stdout.flush&amp;#40;&amp;#41;
    return 'Success! To enter more data, &amp;lt;a href=&amp;quot;{}&amp;quot;&amp;gt;click here!&amp;lt;/a&amp;gt;'.format&amp;#40;url&amp;#95;for&amp;#40;&amp;quot;enter&amp;#95;data&amp;quot;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ok, this one is a little more complicated. &lt;/p&gt;&lt;p&gt;The first line is just a decorator that tells Flask that the function below services a route, gives it the route to service (see the Flask docs for all the interesting stuff you can do with routes), and tells it what methods to accept.&lt;/p&gt;&lt;p&gt;The function initializes that object we created above, and passes it the data we received on our form. &lt;/p&gt;&lt;p&gt;Note that this is as fields on a &lt;code&gt;request&lt;/code&gt; object, which is actually a global. This is a Flask thing, and I think it's a real WTF design decision&amp;mdash;Flask should make you pass it into the function as a parameter, but the Flask people made the choice to make it a global, so a global it is. &lt;/p&gt;&lt;p&gt;Then I have some real seat-of-the-pants error handling in here. Heroku doesn't let you save data to a filesystem&amp;mdash;your choices are database or nothing. But it does have built-in logging (though it only keeps something like 1500 lines of logs unless you pay for a service from someone to hold onto more), and it makes it real easy to get it: anything your application saves to stdout goes into a log.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Since database writes can be finicky, I'm just catching all errors and logging them, along with all the data that it attempted to write. (And since users don't need to know that the database write failed, I'm telling them to keep going.)&lt;/p&gt;&lt;p&gt;Some of the slightly more obscure mechanics: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;indata.&amp;#95;&amp;#95;dict&amp;#95;&amp;#95;&lt;/code&gt; is a dictionary containing all the properties of the object. It will include stuff that SQLAlchemy added in too, some of which isn't serializable as JSON, so I just delete it for purposes of logging.&lt;/li&gt;&lt;li&gt;&lt;code&gt;sys.stdout.flush&amp;#40;&amp;#41;&lt;/code&gt; is advisable &lt;a href='https://stackoverflow.com/questions/10019456/usage-of-sys-stdout-flush-method'&gt;just to make sure everything will land in stdout when you think it will&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The return sends some html to display to the user. Here, I just use a raw string in order to give some feedback to confirm to the user that, yes, they actually managed to submit the form, and then prompt them to submit some more data if they want. &lt;/p&gt;&lt;p&gt;Note that the Flask &lt;code&gt;url&amp;#95;for&lt;/code&gt; function can take a function corresponding to another route, and then intelligently insert the url there.  So this will insert the url for the route corresponding to the enter_data function, which we should probably write... &lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;c.&amp;#95;set&amp;#95;up&amp;#95;a&amp;#95;route&amp;#95;for&amp;#95;users&amp;#95;to&amp;#95;enter&amp;#95;data&quot;&gt;&lt;/a&gt;C. Set up a route for users to enter data&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;@app.route&amp;#40;&amp;quot;/&amp;quot;&amp;#41;
def enter&amp;#95;data&amp;#40;&amp;#41;: 
    return render&amp;#95;template&amp;#40;&amp;quot;dataentry.html&amp;quot;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That was pretty easy, wasn't it?  This will render a &lt;a href='http://jinja.pocoo.org/docs/2.9/'&gt;Jinja2&lt;/a&gt; template to the user. Which should, obviously, provide them with a form to add the data. Here's an example of a minimal template:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;html&quot;&gt;&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;title&amp;gt;data entry&amp;lt;/title&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;
        &amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;{{ url&amp;#95;for&amp;#40;'post&amp;#95;to&amp;#95;db'&amp;#41; }}&amp;quot;&amp;gt;
            &amp;lt;label for=&amp;quot;mydata&amp;quot;&amp;gt;Gimme your data, fool!&amp;lt;/label&amp;gt;
            &amp;lt;input type=&amp;quot;text&amp;quot; id=&amp;quot;mydata&amp;quot; name=&amp;quot;mydata&amp;quot;&amp;gt;
            &amp;lt;button type=&amp;quot;submit&amp;quot;&amp;gt;IT FEEDS IT THE DATA&amp;lt;/button&amp;gt;
        &amp;lt;/form&amp;gt;
    &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Nothing should be surprising there, with one exception: note that Flask is kind enough to inject the &lt;code&gt;url&amp;#95;for&lt;/code&gt; function into the template, so you can decouple your view from whatever you do with routes and whatever server you happen to be running on and so forth.&lt;br /&gt;&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;d.&amp;#95;finish&amp;#95;it&amp;#95;off&quot;&gt;&lt;/a&gt;D. Finish it off&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;if &amp;#95;&amp;#95;name&amp;#95;&amp;#95; == '&amp;#95;&amp;#95;main&amp;#95;&amp;#95;':
    #app.debug = True
    app.run&amp;#40;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;When it's called from the commandline run the app. &lt;/p&gt;&lt;p&gt;I stuck the commented-out line in there to reveal one of the other really sweet things about Flask: it has an &lt;em&gt;amazing&lt;/em&gt; debugger; if you run it in debug mode then when something blows up you'll be able to inspect the state right from the web page it generates. Obviously don't use this in production, unless you &lt;em&gt;want&lt;/em&gt; to make life easy for malicious actors.&lt;/p&gt;&lt;p&gt;That's it, that's all the code we need for a minimal app!&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;step&amp;#95;3:&amp;#95;setup&amp;#95;for&amp;#95;heroku&quot;&gt;&lt;/a&gt;Step 3: Setup for heroku&lt;/h2&gt;&lt;p&gt;You'll need a requirements.txt file to tell Heroku what libraries you need.&lt;/p&gt;&lt;p&gt;&lt;code&gt;pip freeze &amp;gt; requirements.txt&lt;/code&gt; &lt;/p&gt;&lt;p&gt;That was easy.  You'll also need a Procfile to tell Heroku what to run:&lt;/p&gt;&lt;p&gt;&lt;code&gt;echo &amp;quot;web: gunicorn app:app&amp;quot; &amp;gt; Procfile&lt;/code&gt;&lt;/p&gt;&lt;p&gt;It's nice to have a .gitignore, especially if you're also going to put it on github. Here's my minimal Mac users .gitignore: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;#42;.bak
&amp;#42;.pyc
.DS&amp;#95;Store
&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;a name=&quot;step&amp;#95;4:&amp;#95;deploy!&quot;&gt;&lt;/a&gt;Step 4: Deploy!&lt;/h2&gt;&lt;p&gt;Now you need to commit all this stuff, and then once it's all committed, just &lt;code&gt;heroku create CHOOSEYOURNAME&lt;/code&gt;.  That will create an application with whatever name you give it in that last argument.  Then &lt;code&gt;git push heroku master&lt;/code&gt; will get it on Heroku. &lt;/p&gt;&lt;p&gt;It really is that easy!  The output of the heroku create command, incidentally, should give the url of your app, which will probably be something like chooseyourname.herokuapp.com.&lt;/p&gt;&lt;p&gt;There's one more step, however, and that's to setup the database. Two substeps: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;Create the database in Heroku. The free flavor is the hobby-dev one (that's where you have a 10,000 row limit). Everything else is actually quite expensive.  That's as simple as &lt;code&gt;heroku addons:create heroku-postgresql:hobby-dev&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;(If you have more than one database, you'll have to &lt;a href='https://devcenter.heroku.com/articles/heroku-postgresql#establish-primary-db'&gt;do a little bit more work&lt;/a&gt; to connect it, but for a simple thing, you shouldn't have to bother.)&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Create the tables in your new database. The easiest way to do this is to just fire up a Python REPL right on the heroku server and &lt;a href='http://flask-sqlalchemy.pocoo.org/2.1/api/#flask.ext.sqlalchemy.SQLAlchemy.create_all'&gt;create the tables from within the app&lt;/a&gt;: &lt;code&gt;heroku run python&lt;/code&gt; from your command line, and then, in the repl, &lt;code&gt;from app import db&lt;/code&gt; and &lt;code&gt;db.create&amp;#95;all&amp;#40;&amp;#41;&lt;/code&gt;.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;That's it!  You're done!&lt;/strong&gt; If everything went well, the app should be live and functioning.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;what&amp;#95;now?&quot;&gt;&lt;/a&gt;What Now?&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;If you want to update the (non-databasey) code in the application, it's as simple as pushing new changes to the Heroku remote.&lt;/li&gt;&lt;li&gt;To see the logs, go to the repo and do &lt;code&gt;heroku logs&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;To get a database shell, do &lt;code&gt;heroku pg:psql&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;To see the data online, probably the easiest approach is to use &lt;a href='https://devcenter.heroku.com/articles/dataclips'&gt;dataclips&lt;/a&gt; to see saved queries.&lt;/li&gt;&lt;li&gt;To actually get the data locally, you can use &lt;code&gt;heroku pg:pull&lt;/code&gt; to pull down data locally. See the Heroku Postgres docs linked below for more details on what to give to that command.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;a name=&quot;wait&amp;#95;a&amp;#95;minute,&amp;#95;what&amp;#95;about&amp;#95;local&amp;#95;dev,&amp;#95;testing,&amp;#95;etc.?&quot;&gt;&lt;/a&gt;Wait a minute, what about local dev, testing, etc.?&lt;/h2&gt;&lt;p&gt;I'm not going to cover all that stuff, because this post is too long as is, but it's probably a good idea to set up local Postgres with an actual connection so you can test before deploying. For more information, see the references below. &lt;/p&gt;&lt;p&gt;Some people create separate git branches for the local version of the application and the Heroku version. &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;useful&amp;#95;references&quot;&gt;&lt;/a&gt;Useful References&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href='https://devcenter.heroku.com/articles/getting-started-with-python#introduction'&gt;Heroku Python guide&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://devcenter.heroku.com/articles/heroku-postgresql#provisioning-the-add-on'&gt;Heroku Postgres guide&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://blog.sahildiwan.com/posts/flask-and-postgresql-app-deployed-on-heroku/'&gt;A really nice tutorial, but slightly obsolete on Heroku stuff&lt;/a&gt; &amp;mdash; also starts off with using a local postgres installation for testing, which you might want to do.&lt;/li&gt;&lt;li&gt;&lt;a href='http://exploreflask.com/en/latest/deployment.html'&gt;Explore Flask&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://www.theodo.fr/blog/2017/03/developping-a-flask-web-app-with-a-postresql-database-making-all-the-possible-errors/'&gt;A nice Flask + Postgres tutorial with lots of SQLAlchemy troubleshooting info&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://realpython.com/blog/python/flask-by-example-part-2-postgres-sqlalchemy-and-alembic/'&gt;A detailed but obsolete Heroku/Flask/Postgres tutorial, with migrations!&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://killtheyak.com/use-postgresql-with-django-flask/'&gt;A short and easy to read explanation of getting Postgres working with python web frameworks&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world'&gt;The Flask Mega-Tutorial&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://flask.pocoo.org/docs/0.12/tutorial/'&gt;Official Flask tutorial&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Fri, 25 Aug 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/java-first-impressions/
</guid>
<link>
http://paultopia.github.io/posts-output/java-first-impressions/
</link>
<title>
Java: First Impressions
</title>
<description>
 &lt;p&gt; I'm learning Java, for two reasons. &lt;/p&gt;&lt;p&gt;First, I really like Clojure, but I constantly run into barriers where the only way to do something is to &lt;a href='https://groups.google.com/forum/m/#!topic/clojure/gBd6-kY13vA'&gt;drop down to Java code that I don't understand&lt;/a&gt;.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Second, I feel like I should know at least one strongly typed language, and I honestly find Haskell annoying (it's no fun to fight the compiler all the time or to &lt;a href='https://github.com/hvr/cassava'&gt;have to use four libraries, two language extensions, and two monads to read a damn csv&lt;/a&gt;). That kind of limits my options to some super-low-level systems programming language like C/C++/etc., something like Haskell but slightly different (some other ML-family language), Swift, or Java. Since I don't want to manage memory by hand, and don't really feel like I have a good use for Swift right now, Java it is. &lt;/p&gt;&lt;p&gt;So I think I actually... like Java?  &lt;a href='https://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html'&gt;They might take away my functional programmer card for this&lt;/a&gt;, but I do.  I'm trying to do the &lt;a href='http://cryptopals.com'&gt;Matasano Crypto Challenges&lt;/a&gt; with it, by way of learning, and so far (only a few challenges in) it's actually going ok. Here are my first impressions..&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;java&amp;#95;doesn't&amp;#95;have&amp;#95;a&amp;#95;lot&amp;#95;of&amp;#95;magic&quot;&gt;&lt;/a&gt;Java doesn't have a lot of magic&lt;/h2&gt;&lt;p&gt;I find that getting Python to do low-ish-level stuff is surprisingly hard. For example, if you want to actually see a string represented as a list of bytes, it involves digging around into libraries that nobody really uses, and you run into issues between Python 2 and Python 3, and, in all honestly, I still don't know how it all works. Like, Python 2 represents all strings internally as bytes by default, but supposedly Python 3 represents strings as unicode internally by default, but &lt;em&gt;since unicode is also just a bunch of bytes, what does that even mean?&lt;/em&gt;  What it seems to mean in practice is that it's really hard to get to see the bytes.  If, for instance, you follow &lt;a href='https://stackoverflow.com/questions/7585435/best-way-to-convert-string-to-bytes-in-python-3'&gt;this SO&lt;/a&gt; and do &lt;code&gt;'foo'.encode&amp;#40;&amp;#41;&lt;/code&gt;, what you get back, at least as it's representated at the repl, is &lt;code&gt;b'foo'&lt;/code&gt;.  Which is pretty useless.  (What you really need to do is something like &lt;code&gt; &amp;#91;int&amp;#40;x&amp;#41; for x in 'foo'.encode&amp;#40;&amp;#41;&amp;#93;&lt;/code&gt;.)&lt;/p&gt;&lt;p&gt;By contrast, Java doesn't try to hide the fact that strings are just arrays of characters, which are just numbers, from you.  So it's seamless to convert back and forth between different representations of strings.  In Java, you get a byte array from a string by &lt;code&gt;byte&amp;#91;&amp;#93; mybytes = &amp;quot;foo&amp;quot;.getBytes&amp;#40;&amp;#41;;&lt;/code&gt;, and you can see it by calling a simple array method, rather than using a weird int coercion like python: &lt;code&gt;import Java.util.Arrays; Arrays.toString&amp;#40;mybytes&amp;#41;;&lt;/code&gt;, which seems much clearer and more straightforward to me.  And then getting a string back out of it is as simple as &lt;code&gt;new String&amp;#40;mybytes&amp;#41;;&lt;/code&gt; &lt;/p&gt;&lt;p&gt;That straightforwardness makes it nice and easy to do things like implement &lt;a href='https://github.com/paultopia/nounnounnoun/blob/b763d62e09ced4c6f83b4a43055ad859214d3b5c/cryptopals/Stringform.java'&gt;a utility class&lt;/a&gt; that works directly with the byte representation internally bit-twiddling crypto operations, but then spits out the string representation in any form one might want, without having to root through a bunch of stuff that the language usually wants to hide.  For Python, the best that I can come up with is &lt;code&gt;''.join&amp;#40;&amp;#91;chr&amp;#40;x&amp;#41; for x in mybytes&amp;#93;&lt;/code&gt;, and, again, that seems less honest to me&amp;mdash;a string just is an array/list/whatever of bytes/ints, so why can't I turn the whole thing into a string at once, other than because Python doesn't want me to think about strings that way?  (Apparently &lt;a href='https://www.python.org/doc/essays/list2str/'&gt;there is a way to do this using the array library&lt;/a&gt;, which I hadn't even heard of until now, because, again, Python doesn't exactly advertise its existence.)&lt;/p&gt;&lt;p&gt;So three cheers for less magic!  (And this is making me wonder if I should really be writing C...)&lt;/p&gt;&lt;p&gt;Addendum: a wiser person on a private forum (R, let me know if you want to be credited!) has kindly explained to me that, in essence, this only seems more straightforward to me because I'm on a system where &lt;code&gt;.getBytes&amp;#40;&amp;#41;&lt;/code&gt;, which uses the default character set, is doing things that I expect&amp;mdash;where what I expect is UTF-8, because that's the one that treats the ASCII characters that I'm working with like they fit into a single byte. The wise person further contrasted Java and Python to Rust and Go, where the latter force you into UTF-8, while the former make you be more explicit about the encoding.  Thanks, wise person!&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Relatedly, &lt;a href='http://kunststube.net/encoding/'&gt;this&lt;/a&gt; is an amazing explanation of how encoding things work.&lt;br /&gt;&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;this&amp;#95;thing&amp;#95;is&amp;#95;fast!&quot;&gt;&lt;/a&gt;This thing is fast!&lt;/h2&gt;&lt;p&gt;To be fair, I haven't asked it to do anything actually difficult yet. But the &lt;a href='http://cryptopals.com/sets/1/challenges/4'&gt;4th crypto challenge&lt;/a&gt; is at least a &lt;em&gt;little bit&lt;/em&gt; of computational effort&amp;mdash;it does i/o and also has a healthy number of loops to go through; I would have expected like a quarter second hiccup, but Java spits out the answer instantly.  I can't wait to see how it works on more computationally intensive stuff.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;java&amp;#95;has&amp;#95;a&amp;#95;lot&amp;#95;of&amp;#95;types.&quot;&gt;&lt;/a&gt;Java has a lot of types.&lt;/h2&gt;&lt;p&gt;The primitive types like int, char, all that good stuff, all have &lt;a href='https://docs.oracle.com/javase/tutorial/java/data/autoboxing.html'&gt;&quot;boxed&quot; versions that serve as objects&lt;/a&gt;.  I assume this is for perf reasons, but it's a little odd.  Thankfully, for the most part, things seem to be pretty seamless here.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Here, Java does seem to do a little unwelcome magic sometimes.  For example, here's a simplified version of my code to xor two byte arrays, assuming this method belongs to an object that has a byte array stored in &lt;code&gt;byte&amp;#95;array&lt;/code&gt;: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;java&quot;&gt;public byte&amp;#91;&amp;#93; xor&amp;#40;byte&amp;#91;&amp;#93; other&amp;#41;{
    int size = byte&amp;#95;array.length;
    byte&amp;#91;&amp;#93; result = new byte&amp;#91;size&amp;#93;;
    for &amp;#40;int i = 0; i &amp;lt; size; i++&amp;#41;{
      result&amp;#91;i&amp;#93; = &amp;#40;byte&amp;#41;&amp;#40;byte&amp;#95;array&amp;#91;i&amp;#93; &amp;#94; other&amp;#91;i&amp;#93;&amp;#41;;
      }
    return result;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The cast in line 5 is necessary because Java will happily xor two bytes, but will silently up-cast the outcome to an int, and then will throw if you try to stick it in a byte array.  Which seems like a bit of a WTF to me, but ok.&lt;/p&gt;&lt;p&gt;The other thing is that Java has a &lt;em&gt;lot&lt;/em&gt; of collection types.  For example, there's both a HashMap and a TreeMap&amp;mdash;&lt;a href='https://stackoverflow.com/questions/2889777/difference-between-hashmap-linkedhashmap-and-treemap'&gt;actually, there are others too&lt;/a&gt;&amp;mdash;with different constraints and performance characteristics. And you have to choose between them, you can't (I don't think) just ask for a map and let the compiler choose. &lt;/p&gt;&lt;p&gt;Sometimes this feels like another primitive/object distinction. For example, there's an Array, which has a literal, and then you can have an ArrayList with the same contents, and not only are these different in terms of implementation (&lt;a href='http://www.geeksforgeeks.org/array-vs-arraylist-in-java/'&gt;fixed-length vs variable length&lt;/a&gt;, etc), but they also have totally different methods available, and sometimes you have to cast between them in order to get at the desired behavior.  Again, this is something that the languages I'm more familiar with (Python, Clojure) have available buried away, but don't really stick in your face&amp;mdash;both of my main languages really expect you to use a small handful of data structures almost all the time (Python: list, dict; Clojure: vector, map, very occasionally list or queue).&lt;/p&gt;&lt;p&gt;But I don't actually mind this too much.  Partly because I rather suspect that it has a lot to do with the previous point about performance...&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;java&amp;#95;is&amp;#95;weirdly&amp;#95;picky&amp;#95;about&amp;#95;filenames&amp;#95;and&amp;#95;directories&quot;&gt;&lt;/a&gt;Java is weirdly picky about filenames and directories&lt;/h2&gt;&lt;p&gt;This is something that just straight-up annoys me.  Java has this concept of a &quot;classpath&quot; that is nowhere really clearly explained. As far as I can from trial and error and reading SO answers, I'm developing a (doubtlessly highly inaccurate) mental model of the classpath as essentially a brittle virtual filesystem where things start blowing up if everything isn't exactly where it's expected, named what it's expected to be.  (And I can't find anywhere where all the naming and putting things in directories rules are written down.) &lt;/p&gt;&lt;p&gt;For example, I had a two-hour battle today with the following task: I had the entry point of my code outside the &quot;package&quot; folder where all of the classes doing the work were, and I wanted to move it inside that folder.  Turns out that meant adding package declarations, and removing import declarations, and adding a class to the name of the file I was running... it's crazy.&lt;/p&gt;&lt;p&gt;Incidentally, weird thing I learned in the process of that&amp;mdash;the &lt;code&gt;java&lt;/code&gt; command line tool doesn't actually take the filename of the class you're tying to invoke as an argument.  It takes the classpath representation based on aforementioned brittle virtual filesystem.  So, for a &lt;a href='https://stackoverflow.com/questions/45823179/java-newbie-class-with-main-class-in-same-folder-as-subclasses-doesnt-compile?noredirect=1#comment78607107_45823179'&gt;toy problem&lt;/a&gt; I was working with to sort this problem out, I ended up compiling to a file where the entrypoint was &lt;code&gt;DoTheThing.class&lt;/code&gt;, and the command to invoke it wasn't &lt;code&gt;java DoTheThing&lt;/code&gt; or &lt;code&gt;java DoTheThing.class&lt;/code&gt; but &lt;code&gt;java mypackage.DoTheThing&lt;/code&gt;&amp;mdash;because I'd put the entry point class inside a package declaration&amp;mdash;and then java used this classpath thingey in order to find the main method in there.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Here, I'm not at all happy with Java.  I don't mind the Kingdom of Nouns stuff, but this classpath stuff is bloody terrible and I hate it.  Absolutely my least favorite thing about Java, and why the next thing I'm going to do is go learn Gradle so as to offload all this ugliness to a build tool.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;java&amp;#95;people&amp;#95;are&amp;#95;really&amp;#95;unfriendly&amp;#95;on&amp;#95;stack&amp;#95;overflow&quot;&gt;&lt;/a&gt;Java People are really unfriendly on Stack Overflow&lt;/h2&gt;&lt;p&gt;When I &lt;a href='https://stackoverflow.com/questions/45823179/java-newbie-class-with-main-class-in-same-folder-as-subclasses-doesnt-compile'&gt;asked&lt;/a&gt; about how to make the file moving thing work on SO, within about 2 minutes I had 3 downvotes and 2 hostile comments.  Now, I'm not a SO super-user, but I've been using it for a while, I know how to ask a decent question, and while I don't have a ton of reputation, I at least have 700-some, which is more than total beginner.  So I don't think I asked a total boner of a question.  I think that Java people on SO are just much, much more unfriendly than Python/Clojure/Javascript/R people (my usual SO crowd). &lt;/p&gt;&lt;p&gt;The snotty functional programming person in me wonders if maybe this is because PG is right, and Java is full of &lt;a href='http://www.paulgraham.com/avg.html'&gt;blub programmers&lt;/a&gt; who have successfully alienated the SO crowd over the years with terrible questions. But that's a jerky thing to think, and it's also pretty unlikely to be right.&lt;/p&gt;&lt;p&gt;Anyway, I ultimately rewrote the question and got enough hints to sort the problem out, but it was a shocking blast of cold water in the face to get there, and felt quite weird, to be honest. &lt;/p&gt;&lt;p&gt;There's undoubtedly an explanation somewhere in the middle, i.e., neither &quot;I somehow forgot how to ask SO questions&quot; nor &quot;Java people are just bitter jerks.&quot;  But I'm not sure what that explanation is.  Maybe &quot;Java people tend to be using the language at work, as opposed to for fun, so they tend to be more busy and impatient?&quot;  That seems like a pretty plausible guess.&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Tue, 22 Aug 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/cljbackground/
</guid>
<link>
http://paultopia.github.io/posts-output/cljbackground/
</link>
<title>
How to spin up up a long-running background process in Clojure
</title>
<description>
&lt;p&gt;Here's a task that doesn't seem to be terribly well documented in one place.  What happens if you want to spin up some long-running background shell process in clojure?  For example, suppose you're trying to communicate with a python script (&lt;a href='https://github.com/paultopia/snakepit'&gt;example of how to do that&lt;/a&gt;), and you'd like to spin both the rabbitmq server and the continuously-running python script up from your main clj application? You can't just use clojure.java.shell, because that will hang the application until the other process returns (i.e., it's blocking).&lt;/p&gt;&lt;p&gt;The easiest method to do this that I can discern is to just wrap it in a future.  For example:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;ns spinup.core
  &amp;#40;:require &amp;#91;clojure.java.shell :refer &amp;#91;sh&amp;#93;&amp;#41;&amp;#41;

&amp;#40;def rabbit &amp;#40;future &amp;#40;sh &amp;quot;/usr/local/sbin/rabbitmq-server&amp;quot;&amp;#41;&amp;#41;&amp;#41;
&amp;#40;def python &amp;#40;future &amp;#40;sh &amp;quot;python&amp;quot; &amp;quot;talktoclojure.py&amp;quot;&amp;#41;&amp;#41;&amp;#41;
&amp;#40;do-the-stuff-with-a-running-server&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;then, when you want to tear down the foreign process, you can kill it using &lt;code&gt;future-cancel&lt;/code&gt;.  So to take down the python process, &lt;code&gt;&amp;#40;future-cancel python&amp;#41;&lt;/code&gt; will be quite sufficient.  (Rabbitmq is a bit tougher, see the repo linked above for deets.)&lt;/p&gt;&lt;p&gt;WARNING: this doesn't seem to be totally reliable.  For example, sometimes (like in my rabbitmq tests), I can get it to spin up and shut down processes, but I can't seem to be able to send messages to the background processes.  Other times, I can get it to spin up a process that will write to disk, but won't shut down on using &lt;code&gt;future-cancel&lt;/code&gt;.&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Wed, 26 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/naivebayes/
</guid>
<link>
http://paultopia.github.io/posts-output/naivebayes/
</link>
<title>
Naive Bayes Speed Test, OR: Everything is a Dot Product
</title>
<description>
 &lt;p&gt;(With help from &lt;a href='http://carlosd.ghost.io/'&gt;Carlos De La Guardia&lt;/a&gt;, who was like &quot;dude, vectorize this stuff&quot; after seeing the incredibly slow implementation the first time, and then was kind enough to talk through the problem and &lt;a href='https://github.com/paultopia/haskeml/blob/master/naive-bayes-speed-test.ipynb'&gt;the notebook&lt;/a&gt; on which this post is based. All infelicities are mine (and I didn't even implement his wise suggestions for cleaning up the notebook).)&lt;/p&gt;&lt;p&gt;Naive Bayes is the simplest possible machine learning algorithm. In its Bernoulli form, calculation is just a matter of applying probability 101 techniques to calculate the (estimated) conditional probabilities of your predictors given the labels and estimated probability of the labels, then applying Bayes Rule directly to generate a posterior on a label given the data. Trivial. &lt;/p&gt;&lt;p&gt;&quot;Training&quot; the model, then, is just arithmetic. Supposing we have everything in a pandas dataframe in which the first column is our label, and in which all features and the label are encoded as 1s and 0s. Then is all the code it takes:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;prob&amp;#95;y = df&amp;#91;&amp;quot;LABEL&amp;quot;&amp;#93;.sum&amp;#40;&amp;#41; / len&amp;#40;df&amp;#41;
spams = df&amp;#91;df&amp;#91;&amp;quot;LABEL&amp;quot;&amp;#93; == 1&amp;#93;
notspams = df&amp;#91;df&amp;#91;&amp;quot;LABEL&amp;quot;&amp;#93; == 0&amp;#93;
features = list&amp;#40;df&amp;#41;&amp;#91;1:&amp;#93;

def conditional&amp;#95;probability&amp;#95;dict&amp;#40;column&amp;#95;label, condition&amp;#95;df&amp;#41;:
    numerator = condition&amp;#95;df&amp;#91;column&amp;#95;label&amp;#93;.sum&amp;#40;&amp;#41; + 1 
    denominator = len&amp;#40;condition&amp;#95;df&amp;#41; + 2
    return {column&amp;#95;label: numerator / denominator}

x&amp;#95;probs&amp;#95;conditional&amp;#95;on&amp;#95;spam=&amp;#91;conditional&amp;#95;probability&amp;#95;dict&amp;#40;x, spams&amp;#41; for x in list&amp;#40;spams&amp;#41;&amp;#91;1:&amp;#93;&amp;#93;
x&amp;#95;spam&amp;#95;lookup = toolz.merge&amp;#40;x&amp;#95;probs&amp;#95;conditional&amp;#95;on&amp;#95;spam&amp;#41;

x&amp;#95;probs&amp;#95;conditional&amp;#95;on&amp;#95;notspam=&amp;#91;conditional&amp;#95;probability&amp;#95;dict&amp;#40;x, notspams&amp;#41; for x in list&amp;#40;notspams&amp;#41;&amp;#91;1:&amp;#93;&amp;#93;
x&amp;#95;notspam&amp;#95;lookup = toolz.merge&amp;#40;x&amp;#95;probs&amp;#95;conditional&amp;#95;on&amp;#95;notspam&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;What this produces is a dict of priors on each x for each state of y, plus a prior on y. Note that we use &lt;a href='https://stats.stackexchange.com/a/171210/69606'&gt;Laplace smoothing&lt;/a&gt; to calculate our x priors, otherwise if a feature isn't seen for one of our labels, we end up just predicting zero for it. &lt;/p&gt;&lt;p&gt;Then a &quot;prediction&quot; is simply an application of Bayes Rule to estimate the probability of y=1 and the probability of y=0 for each observation. Recall that Bayes Rule is: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$p&amp;#40;y=\phi | x1, x2... xn&amp;#41; = \frac{p&amp;#40;x1|y&amp;#41;p&amp;#40;x2|y&amp;#41;...p&amp;#40;xn|y&amp;#41;p&amp;#40;y&amp;#41;}{p&amp;#40;x1&amp;#41;p&amp;#40;x2&amp;#41;...p&amp;#40;xn&amp;#41;}$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note that the denominator is going to be the same for the y=1 and y=0 calculations for each observation, so we can drop it, since we're just comparing those on an observation-by-observation basis. What we end up with is:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$p&amp;#40;y=\phi | x&amp;#95;{1..n}&amp;#41; = p&amp;#40;y=\phi&amp;#41;\prod&amp;#95;{i=1}&amp;#94;{n}p&amp;#40;x&amp;#95;i | y=\phi&amp;#41;$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;So here's the bad and slow way to actually generate predictions on this model. &lt;/p&gt;&lt;pre&gt;&lt;code&gt;def slow&amp;#95;predict&amp;#40;row&amp;#41;:
    prob&amp;#95;spam = log&amp;#40;prob&amp;#95;y&amp;#41;
    prob&amp;#95;notspam = log&amp;#40;1 - prob&amp;#95;y&amp;#41;
    for feat in features:
        if row&amp;#91;feat&amp;#93; == 1:
            prob&amp;#95;spam = prob&amp;#95;spam + log&amp;#40;x&amp;#95;spam&amp;#95;lookup&amp;#91;feat&amp;#93;&amp;#41;
            prob&amp;#95;notspam = prob&amp;#95;notspam + log&amp;#40;x&amp;#95;notspam&amp;#95;lookup&amp;#91;feat&amp;#93;&amp;#41;
    if prob&amp;#95;spam &amp;gt;= prob&amp;#95;notspam:
        return 1
    else:
        return 0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A few notes about this implementation.  First, it leverages the fact that &lt;code&gt;$log&amp;#40;xy&amp;#41;=log&amp;#40;x&amp;#41;+log&amp;#40;y&amp;#41;$&lt;/code&gt; to sum the logarithms of the priors rather than multiply them. This is important, because otherwise you get into &lt;em&gt;really really&lt;/em&gt; small floating point values when you multiply a bunch of already tiny probabilities together; that's a recipe for terrible floating point errors. &lt;/p&gt;&lt;p&gt;Second, what this is doing is iterating over every cell in every row of the dataset. For each cell, it looks up the value in the dataframe to make sure it's a 1, and if it is, then it goes and looks up the prior for that feature in the dict (hash, for non-Pythonistas), and then adds it to a running total. (For extra special bonus inefficiency, it also calculates the logs over and over and over again, which was dumb.)&lt;/p&gt;&lt;p&gt;For dataset of 9,663 features and 5,574 observations (a cleaned-up and binarized version of the &lt;a href='https://archive.ics.uci.edu/ml/datasets/sms+spam+collection'&gt;UCI SMS spam dataset&lt;/a&gt;), that took about fifteen minutes to generate predictions on the original data. &lt;/p&gt;&lt;p&gt;Needless to say, this is totally outrageous. A little profiling indicated that basically all the time was spent looking up values, i.e., with all that iteration. (Calculating all those unnecessary logs didn't seem to register.)&lt;/p&gt;&lt;p&gt;After some time chatting with Carlos and a whiteboard, the solution came to me: after switching from multiplying probabilities to adding log probabilities, &lt;em&gt;calculating the posterior is just a dot product of a vector of the priors for x and the binarized features&lt;/em&gt; (plus adding the log probability of y).  That means no explicit iteration is necessary, no repeated lookups, no check to see of the feature is 1 or 0 for a given observation&amp;mdash;all that stuff is unnecessary. &lt;/p&gt;&lt;p&gt;So let's implement that. For ease of prediction, we start by reshaping the data. We'll get our labels out of the dataset for ease of multiplication, and add a column of all ones at the start to facilitate including &lt;code&gt;$log&amp;#40;p&amp;#40;y=\phi&amp;#41;&amp;#41;$&lt;/code&gt; in the dot product rather than adding it later. (Let's just call this a &quot;pseudo-intercept.&quot;) We'll also change our feature priors from a lookup dict to a vector so that we can multiply it out without a bunch of lookups. For purposes of consistency and guaranteed playing-nice-with-numpy, we'll keep everything in Pandas datastructures.&lt;/p&gt;&lt;pre&gt;&lt;code&gt;clean&amp;#95;spamdf = df.iloc&amp;#91;:,1:&amp;#93;
clean&amp;#95;spamdf.insert&amp;#40;0, &amp;quot;pseudo&amp;#95;intercept&amp;quot;, 1&amp;#41; 

true&amp;#95;vector =&amp;#91;log&amp;#40;x&amp;#95;spam&amp;#95;lookup&amp;#91;x&amp;#93;&amp;#41; for x in features&amp;#93;
true&amp;#95;vector.insert&amp;#40;0, log&amp;#40;prob&amp;#95;y&amp;#41;&amp;#41;
true&amp;#95;vector = pd.Series&amp;#40;true&amp;#95;vector&amp;#41; 

false&amp;#95;vector =&amp;#91;log&amp;#40;x&amp;#95;notspam&amp;#95;lookup&amp;#91;x&amp;#93;&amp;#41; for x in features&amp;#93;
false&amp;#95;vector.insert&amp;#40;0, log&amp;#40;1-prob&amp;#95;y&amp;#41;&amp;#41;
false&amp;#95;vector = pd.Series&amp;#40;false&amp;#95;vector&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then we'll bust out our matrix math, with the terrifying speed of numpy:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;def fast&amp;#95;predict&amp;#40;df, true&amp;#95;priors, false&amp;#95;priors&amp;#41;:
    true&amp;#95;posterior = np.dot&amp;#40;df, true&amp;#95;priors&amp;#41;
    false&amp;#95;posterior = np.dot&amp;#40;df, false&amp;#95;priors&amp;#41;
    combined = np.column&amp;#95;stack&amp;#40;&amp;#40;false&amp;#95;posterior, true&amp;#95;posterior&amp;#41;&amp;#41;
    return np.argmax&amp;#40;combined, axis=1&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The last two lines might be a little opaque. Column_stack does what it says on the label, i.e., sets up a numpy 2d array in which the posterior on y=0 is the first column and the posterior on y=1 is the second; then argmax returns the row index that has the maximum value&amp;mdash;thus, conveniently, returns 0 when &lt;code&gt;$p&amp;#40;y=0&amp;#41; &amp;gt; p&amp;#40;y=1&amp;#41;$&lt;/code&gt; and so forth. &lt;/p&gt;&lt;p&gt;Running this took, I'm not even making this up, under 2 seconds.  Compare that to about 15 minutes for the slow version.&lt;/p&gt;&lt;p&gt;So when people say you should vectorize stuff, this is why...&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Tue, 25 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/ng67/
</guid>
<link>
http://paultopia.github.io/posts-output/ng67/
</link>
<title>
Lectures 6-7 (part) of Andrew Ng's mathier ML course
</title>
<description>
&lt;h2&gt;&lt;a name=&quot;ng&amp;#95;lecture&amp;#95;6&amp;#95;and&amp;#95;7:&amp;#95;multinomial&amp;#95;models,&amp;#95;transition&amp;#95;to&amp;#95;svm.&quot;&gt;&lt;/a&gt;Ng lecture 6 and 7: multinomial models, transition to SVM.&lt;/h2&gt;&lt;h2&gt;&lt;a name=&quot;lecture&amp;#95;6&quot;&gt;&lt;/a&gt;Lecture 6&lt;/h2&gt;&lt;h3&gt;&lt;a name=&quot;generalizing&amp;#95;naive&amp;#95;bayes&amp;#95;to&amp;#95;multinomial&amp;#95;models&quot;&gt;&lt;/a&gt;Generalizing Naive Bayes to multinomial models&lt;/h3&gt;&lt;p&gt;What if it isn't just &quot;spam/not-spam?&quot; What if it's &quot;spam/not-spam-and-from-a-friend/not-spam-andfrom-by-boss?&quot;  The model comes out the same way: the probability of x given y is just a multinomial rather than a bernoilli. You can also discretize continuous features into buckets and then use multinomial naive bayes.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;multinomial&amp;#95;event&amp;#95;model&amp;#95;for&amp;#95;naive&amp;#95;bayes&quot;&gt;&lt;/a&gt;Multinomial Event model for naive bayes&lt;/h3&gt;&lt;p&gt;(warning, his notation changes here.)&lt;/p&gt;&lt;p&gt;another variation on naive bayes especially for other text documents or other sequences.  Takes into account the number of times different words appears.  If some word appears a lot of times (&quot;buy&quot;), it's more likely to be spam than if it appears once, but the version of naive bayes he did before just has binaries.&lt;/p&gt;&lt;p&gt;Represents each document as a feature vector &lt;code&gt;$&amp;#40;x&amp;#94;{&amp;#40;i&amp;#41;}&amp;#95;1, x&amp;#94;{&amp;#40;i&amp;#41;}&amp;#95;2... x&amp;#94;{&amp;#40;i&amp;#41;}&amp;#95;n&amp;#41;$&lt;/code&gt; where n is the number of words in that document, and maps to the dictionary.  So if the dictionary has 1000 words, then the components of the feature vector for each document is an index into our dictionary for the word that appears in that picture. &lt;/p&gt;&lt;p&gt;So then we're calculating p(x|y) as the product of the probability of seeing the word we see in each position of the document.  See page 13 of &lt;a href='https://see.stanford.edu/materials/aimlcs229/cs229-notes2.pdf'&gt;notes 2&lt;/a&gt;. &lt;/p&gt;&lt;p&gt;Skipping the gnarly sums, the maximum likelihood estimator for a given word p(xi|y=1) is another simple proportion, namely: the numerator is &quot;count the total number of appearances of word k in documents with classlabel 1.  The denominator is &quot;sum the lengths of all the e-mails in classlabel 1&quot;.  This is a translation of the maximum likelihood estimates on pg. 14 of the notes.  In those estimates, remember that j...n indexes positions in a document and m indexes documents.&lt;/p&gt;&lt;p&gt;So essentially instead of fitting naive bayes over &lt;em&gt;documents&lt;/em&gt;, we're fitting naive bayes over &lt;em&gt;positions in documents&lt;/em&gt;.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;And for laplace smoothing, we add 1 to the numerator and k to the denominator, where k is the number of unique words. (also in the notes as |V|).&lt;br /&gt;&lt;/p&gt;&lt;p&gt;(Interlude: Ng actually stopped in the middle to lay out maximum likelihood estimation in response to a student question (at minute 20 of the video).  The short version id that the likelihood function is a function of the parameters, and is the product of the probability of each x and y, paramaterized by the aforementioned parameters; then maximize the log.)&lt;/p&gt;&lt;p&gt;Multinomial event model almost always does better than the first version of naive bayes for text classification. &lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;nonlinear&amp;#95;classifiers&quot;&gt;&lt;/a&gt;Nonlinear classifiers&lt;/h3&gt;&lt;p&gt;Let's think of taking a simple algorithm like logistic regression and go out to more complex classifiers. &lt;/p&gt;&lt;p&gt;How would we get a nonlinear decision boundary out of our logistic regression. Suppose we have a function with a bunch of parameters and weights on them, then applies a sigmoid function to generate a hypothesis.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;To get a nonlinear decision boundary, one thing we could do would be to create intermediate results&amp;mdash;create multiple hypotheses from the combinations of our features and weights, and then has a second (etc.) set of weights on those hypotheses, which get combined by another sigmoid function.  Then you've turned your logistic regression into a neutral net.&lt;/p&gt;&lt;p&gt;As before, we do gradient descent to minimize the squared error, our labels - hypothesis.  And backpropogation is the name of the algorithm that carries out that gradient descent.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;support&amp;#95;vector&amp;#95;machines&quot;&gt;&lt;/a&gt;Support vector machines&lt;/h3&gt;&lt;p&gt;We're actually going to start off with a linear version before going to the nonlinear bit. &lt;/p&gt;&lt;p&gt;&quot;Two intuitions about classification&quot;:&lt;/p&gt;&lt;p&gt;First intuition.  Logistic regression is an algorithm that computes &lt;code&gt;$\theta&amp;#94;Tx$&lt;/code&gt; and predicts 1 if that product greater than zero, or - if it's less than zero.  If the distance away from zero is large, that's a very confident prediction, you're on the tails of the sigmoid function. &lt;/p&gt;&lt;p&gt;&quot;Wouldn't it be nice,&quot; he says, if for our training set, if y=1 we'd have high confidence in it, i.e., we'd have &lt;code&gt;$\theta&amp;#94;Tx$&lt;/code&gt; much higher than zero, and vice versa.  So that's the first intuition, and it leads to the idea of &quot;functional margins,&quot; discussed below.&lt;/p&gt;&lt;p&gt;Second intuition: assuming the training set is linearly separable (there's a straight line separating the training set... this is an assumption that will go away later).  A better line is one that is further away from the training data (more centralized in the boundary).  Formalizations here will use the term &quot;geometric margins.&quot;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;warning: another notation change here as we get into SVM&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;labels (y), instead of being 0 or 1, they'll be -1 or +1.  And the hypothesis will output values that are either +1 or -1. Also, for our hypothesis, we're dropping our convention that &lt;code&gt;$x&amp;#95;0 = 1$&lt;/code&gt; (adding the intercept).  Instead, we'll just separate out an intercept term b.  Also our parameters become w rather than theta.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Definition: functional margin&lt;/strong&gt;: the functional margin of a hyperplane with respect to a specific training example &lt;code&gt;$&amp;#40;x&amp;#94;{&amp;#40;i&amp;#41;}, y&amp;#94;{&amp;#40;i&amp;#41;}&amp;#41;$&lt;/code&gt; is &lt;code&gt;$\hat{\gamma}&amp;#94;{&amp;#40;i&amp;#41;}=y&amp;#94;{&amp;#40;i&amp;#41;}&amp;#40;w&amp;#94;Tx&amp;#94;{&amp;#40;i&amp;#41;}+b&amp;#41;$&lt;/code&gt;  What that means is that if &lt;code&gt;$y&amp;#94;{&amp;#40;i&amp;#41;} = 1$&lt;/code&gt; then you want the functional margin to be large which means you make the hypothesis (that term with w and b) to be big, and small if it's -1. Also, if &lt;code&gt;$\hat{\gamma}&amp;#94;{&amp;#40;i&amp;#41;} &amp;gt; 0$&lt;/code&gt; then we've classified correctly.&lt;/p&gt;&lt;p&gt;So if the functional margin is high, we've both classified correctly and confidently.  Module one problem, namely that we could make the funcional margin large just by multiplying our parameters by constants. So that's bad. We need to add a normalization constraint later. (e.g. that the l2 norm ||w|| of w is 1.) &lt;/p&gt;&lt;p&gt;&lt;strong&gt;Definition: geometric margin&lt;/strong&gt;: the geometric distance at a given training example is between a training example and the separating hyperplane. &lt;/p&gt;&lt;p&gt;Note that all points on the decision boundary satisfy &lt;code&gt;$w&amp;#94;Tx+b=0$&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;There's a bunch of linear algebra/geometry that I let slide here.  But what it amounts to is that the geometric margin is just equal to the functional margin divided by the (l2?) norm of w. So it doesn't have the problem that the functional margin has of being subject to scaling by a constant.  Intuitively, what we're doing is finding a vector orthogonal to the plane at the training example.  (More intuitively still, a perpendicular line from the plane to the data.)&lt;/p&gt;&lt;p&gt;The geometric margin of a whole training set is just the minimum of the margins of all the examples. &lt;/p&gt;&lt;p&gt;Maximum margin classifier is a precursor to SVMs. See &lt;a href='https://see.stanford.edu/materials/aimlcs229/cs229-notes3.pdf'&gt;notes 3, pg. 5-6&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Maximum margin idea: maximize the minimum of the margins of all the examples.&lt;/p&gt;&lt;p&gt;Unfortunately, maximizing the geometric margin directly us pretty uggo: it's not convex. &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;lecture&amp;#95;7&quot;&gt;&lt;/a&gt;Lecture 7&lt;/h2&gt;&lt;p&gt;So there's a trick to solve that optimization problem. Since the geometric margin is invariant to scaling, you can find some constants to scale w such that the functional margin &lt;code&gt;$min&amp;#40;y&amp;#94;{&amp;#40;i&amp;#41;}&amp;#41;&amp;#40;w&amp;#94;Tx&amp;#94;{&amp;#40;i&amp;#41;}+b&amp;#41; = 1$&lt;/code&gt;. Plugged into the optimization problem we had before, we get a convex function that can be optimized. &lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;kernels&quot;&gt;&lt;/a&gt;Kernels&lt;/h3&gt;&lt;p&gt;Essentially, the idea of a kernel is: &quot;sometimes you want to have a really ugly transformation on your feature vector.  And sometimes, you can find some other function and other matrix, such that dot-producting the two matrices together with the function is equivalent, but it's much easier to calculate.&quot;&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Mon, 24 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/mathjax/
</guid>
<link>
http://paultopia.github.io/posts-output/mathjax/
</link>
<title>
Getting Mathjax to Play Nicely with Markdown and Highlight.js
</title>
<description>
&lt;p&gt;Mathjax and markdown tend to fight with one another a bit.  When I started blogging math notes on here, the combination of Mathjax and Cryogen's markdown parser and Highlight.js fought with one another a lot.  So here's a quick tutorial on fixing it.&lt;/p&gt;&lt;p&gt;The assumption here is that you want to write in normal markdown, i.e., the kind of thing that you could convert to a PDF with pandoc.  And you want to write latex math.  But you observe that doing so blows up when you convert to html and use mathjax.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;My fix definitely works for me, using &lt;a href='http://cryogenweb.org/'&gt;Cryogen&lt;/a&gt;, but YMMV if you use some other markdown parser/static site generator. &lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;step&amp;#95;1:&amp;#95;basic&amp;#95;setup&quot;&gt;&lt;/a&gt;Step 1: Basic Setup&lt;/h3&gt;&lt;p&gt;Mathjax isn't set up out of the box to recognize the delimiters typically used in Markdown for latex blocks.  So you need to tweak the Mathjax config. &lt;a href='https://github.com/paultopia/experimental-cryogen/blob/master/resources/templates/themes/nucleus/html/base.html#L105'&gt;Here's how I did it&lt;/a&gt;:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;javascript&quot;&gt;&amp;lt;script type=&amp;quot;text/x-mathjax-config&amp;quot;&amp;gt;
 MathJax.Hub.Config&amp;#40;{tex2jax: {inlineMath: &amp;#91;&amp;#91;'$','$'&amp;#93;&amp;#93;,
                               displayMath: &amp;#91;&amp;#91;'$$','$$'&amp;#93;&amp;#93;,
                               processEscapes: true,
                               skipTags: &amp;#91;&amp;quot;script&amp;quot;,&amp;quot;noscript&amp;quot;,&amp;quot;style&amp;quot;,&amp;quot;textarea&amp;quot;&amp;#93;
 }}&amp;#41;;
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Important parts: pass it the $ delimiters for both inline and display (block) math.  Also, change the skipTags setting, because the &lt;a href='http://docs.mathjax.org/en/latest/options/tex2jax.html'&gt;default&lt;/a&gt; skips pre and code blocks, which you don't want &amp;mdash; the next step will have you putting latex in a code block, and if you don't change this setting, then Mathjax will decline to process those blocks.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;first&amp;#95;problem:&amp;#95;superscript&amp;#95;and&amp;#95;such.&amp;#95;&amp;#95;stick&amp;#95;it&amp;#95;in&amp;#95;a&amp;#95;code&amp;#95;block.&quot;&gt;&lt;/a&gt;First Problem: Superscript and Such.  Stick it in a code block.&lt;/h3&gt;&lt;p&gt;A number of the characters used in LaTeX (look, I gave it the silly capitalization! No more.) have their own meaning in Markdown; I have particular problems with superscript and subscript. One possible solution is to just escape them all, but that gets really ugly really quick.  An easier fix is just to stick everything in a code block. &lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;second&amp;#95;problem:&amp;#95;syntax&amp;#95;highlighting.&quot;&gt;&lt;/a&gt;Second problem: syntax highlighting.&lt;/h3&gt;&lt;p&gt;So if you also use Highlight.js, then it turns out that putting latex in codeblocks means that it'll try to identify the language (incorrectly) and add a bunch of highlighter classes for the css.  Which, naturally, again blows up mathjax rendering.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;The solution there is to slap a nohighlight class on the block-level code blocks (blessedly, highlight.js doesn't seem to tamper with inline code blocks). &lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;third&amp;#95;problem:&amp;#95;what&amp;#95;if&amp;#95;you&amp;#95;want&amp;#95;to&amp;#95;mangle&amp;#95;your&amp;#95;markdown&amp;#95;by&amp;#95;hand?&quot;&gt;&lt;/a&gt;Third problem: what if you want to mangle your markdown by hand?&lt;/h3&gt;&lt;p&gt;All this stuff seems like extra typing.  I don't like extra typing.  So ultimately, what I did was write &lt;a href='https://github.com/paultopia/experimental-cryogen/blob/master/preprocess-math.cljs'&gt;a preprocessor&lt;/a&gt; that takes a normal markdown file (plus the cryogen header information). It's really quite simple, it just loads the file, looks for a &quot;mathy&quot; header, and, if it finds one, sticks all the latex into appropriate code blocks.&lt;/p&gt;&lt;p&gt;Here are the guts:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn fix-inline-math &amp;#91;post&amp;#93;
  {:text &amp;#40;replace &amp;#40;:text post&amp;#41; #&amp;quot;&amp;#91;&amp;#94;$&amp;#93;&amp;#40;\$&amp;#91;&amp;#94;$&amp;#93;+?\$&amp;#41;&amp;#91;&amp;#94;$&amp;#93;&amp;quot; &amp;quot; `$1` &amp;quot;&amp;#41; :filename &amp;#40;:filename post&amp;#41;}&amp;#41;

&amp;#40;defn fix-block-math &amp;#91;post&amp;#93;
  {:text 
   &amp;#40;replace &amp;#40;:text post&amp;#41; #&amp;quot;&amp;#91;&amp;#94;$&amp;#93;&amp;#40;\$\$&amp;#91;&amp;#94;$&amp;#93;+?\$\$&amp;#41;&amp;#91;&amp;#94;$&amp;#93;&amp;quot; &amp;quot;\n\n```nohighlight \n $1 \n```\n\n&amp;quot;&amp;#41;
   :filename &amp;#40;:filename post&amp;#41;}&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Easy.&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Mon, 24 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/unidiomaticpython/
</guid>
<link>
http://paultopia.github.io/posts-output/unidiomaticpython/
</link>
<title>
Avoiding Inheritance Through Really Unidiomatic Python
</title>
<description>
 &lt;p&gt;So, confession: my brain works in a functional way, and really doesn't work in an object-oriented way. This can be a bit of an issue when you're using an object-oriented language and trying to avoid excessive code duplication.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;So here's some really unnatural stuff I just did. The problem: I'm writing a Python library to wrap a bunch of legal and political APIs with a simpler interface. (&lt;a href='https://github.com/paultopia/lawpy'&gt;Extreme work in progress.&lt;/a&gt;)  I had a bunch of code that looked very similar. For example, this was what two of my session objects (interfaces to different APIs) looked like, in relevant part:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;class courtlistener&amp;#40;object&amp;#41;:
    def &amp;#95;&amp;#95;init&amp;#95;&amp;#95;&amp;#40;self, api&amp;#95;key=&amp;quot;ENV&amp;quot;&amp;#41;:
        if api&amp;#95;key == &amp;quot;ENV&amp;quot;:
            try:
                self.api&amp;#95;key = os.environ&amp;#91;'COURTLISTENER'&amp;#93;
            except KeyError as e:
                raise Exception&amp;#40;&amp;quot;API key is missing. Please set the COURTLISTENER environment variable or pass the key to the session constructor.&amp;quot;&amp;#41; from e
        else:
            self.api&amp;#95;key = api&amp;#95;key
        self.auth&amp;#95;header = {'Authorization': 'Token ' + self.api&amp;#95;key}
        self.total&amp;#95;requests&amp;#95;this&amp;#95;session = 0

    def request&amp;#40;self, endpoint=&amp;quot;&amp;quot;, headers={}, parameters=None&amp;#41;:
        if endpoint.startswith&amp;#40;&amp;quot;https://&amp;quot;&amp;#41;:
            ep = endpoint
        else:
            ep = &amp;quot;https://www.courtlistener.com/api/rest/v3/&amp;quot; + endpoint
        h = {}
        h = safe&amp;#95;merge&amp;#40;h, headers&amp;#41;
        h = safe&amp;#95;merge&amp;#40;h, self.auth&amp;#95;header&amp;#41;
        result = requests.get&amp;#40;ep, headers=h, params=parameters&amp;#41;
        self.total&amp;#95;requests&amp;#95;this&amp;#95;session += 1
        result.raise&amp;#95;for&amp;#95;status&amp;#40;&amp;#41;
        return result.json&amp;#40;&amp;#41;

class propublica&amp;#40;object&amp;#41;:
    def &amp;#95;&amp;#95;init&amp;#95;&amp;#95;&amp;#40;self, api&amp;#95;key=&amp;quot;ENV&amp;quot;&amp;#41;:
        if api&amp;#95;key == &amp;quot;ENV&amp;quot;:
            try:
                self.api&amp;#95;key = os.environ&amp;#91;'PROPUBLICA'&amp;#93;
            except KeyError as e:
                raise Exception&amp;#40;&amp;quot;API key is missing. Please set the COURTLISTENER environment variable or pass the key to the session constructor. You can get an API key directly from courtlistner.com by registering on their website.&amp;quot;&amp;#41; from e
        else:
            self.api&amp;#95;key = api&amp;#95;key
        self.auth&amp;#95;header = {'X-API-Key': self.api&amp;#95;key}
        self.total&amp;#95;requests&amp;#95;this&amp;#95;session = 0

    def request&amp;#40;self, endpoint=&amp;quot;&amp;quot;, headers={}, parameters=None&amp;#41;:
        if endpoint.startswith&amp;#40;&amp;quot;https://&amp;quot;&amp;#41;:
            ep = endpoint
        else:
            ep = &amp;quot;https://api.propublica.org/congress/v1/&amp;quot; + endpoint
        h = {}
        h = safe&amp;#95;merge&amp;#40;h, headers&amp;#41;
        h = safe&amp;#95;merge&amp;#40;h, self.auth&amp;#95;header&amp;#41;
        result = requests.get&amp;#40;ep, headers=h, params=parameters&amp;#41;
        self.total&amp;#95;requests&amp;#95;this&amp;#95;session += 1
        result.raise&amp;#95;for&amp;#95;status&amp;#40;&amp;#41;
        return result.json&amp;#40;&amp;#41;

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ugh, horrible, right?  The only difference between those two chunks of code is a URL and the name of an environment variable. Each class, of course, has other stuff too&amp;mdash;methods specific to the API that the class wraps, natch&amp;mdash;but that stuff is just pure fat that needs to be trimmed.  (FYI, for those who are checking, &lt;code&gt;safe&amp;#95;merge&lt;/code&gt; is just a utility function I have in there to merge two dicts without overwriting data with empty stuff, mutating the originals, etc.)&lt;/p&gt;&lt;p&gt;So how do we fix this?  I imagine that the standard OOP solution would involve either creating some kind of higher-level class, maybe call it baserequest or something, and give that most of the architecture, and subclass it for courtlistener and propublica. Or, I guess, use some kind of explicit object composition. &lt;/p&gt;&lt;p&gt;But I'm really only using classes here at all because I want other people to use this library, and I think people kinda expect the surface area of a library like this to be &quot;initialize an object then call methods on it to get and manipulate your data.&quot; But for the internal implementation details, I'm a lot more comfortable with functional idioms, even if they're unidiomatic in python. So here's the solution I came up with: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;def session&amp;#95;builder&amp;#40;selfvar, keyenv&amp;#41;:
    def class&amp;#95;init&amp;#40;selfvar, api&amp;#95;key=&amp;quot;ENV&amp;quot;&amp;#41;:
        if api&amp;#95;key == &amp;quot;ENV&amp;quot;:
            try:
                selfvar.api&amp;#95;key = os.environ&amp;#91;keyenv&amp;#93;
            except KeyError as e:
                raise Exception&amp;#40;&amp;quot;API token is missing. Please set the {} environment variable or pass the token to the session constructor.&amp;quot;.format&amp;#40;keyenv&amp;#41;&amp;#41; from e
        else:
            selfvar.api&amp;#95;key = api&amp;#95;key
        selfvar.auth&amp;#95;header = {'X-API-Key': selfvar.api&amp;#95;key}
        selfvar.total&amp;#95;requests&amp;#95;this&amp;#95;session = 0
    return class&amp;#95;init

def request&amp;#95;builder&amp;#40;selfvar, baseurl&amp;#41;:
    def request&amp;#40;selfvar, endpoint=&amp;quot;&amp;quot;, headers={}, parameters=None&amp;#41;:
        if endpoint.startswith&amp;#40;&amp;quot;https://&amp;quot;&amp;#41;:
            ep = endpoint
        else:
            ep = baseurl + endpoint
        h = {}
        h = safe&amp;#95;merge&amp;#40;h, headers&amp;#41;
        h = safe&amp;#95;merge&amp;#40;h, selfvar.auth&amp;#95;header&amp;#41;
        result = requests.get&amp;#40;ep, headers=h, params=parameters&amp;#41;
        selfvar.total&amp;#95;requests&amp;#95;this&amp;#95;session += 1
        result.raise&amp;#95;for&amp;#95;status&amp;#40;&amp;#41;
        return result.json&amp;#40;&amp;#41;
    return request

class propublica&amp;#40;object&amp;#41;:

    def &amp;#95;&amp;#95;init&amp;#95;&amp;#95;&amp;#40;self&amp;#41;:
        session&amp;#95;builder&amp;#40;self, &amp;quot;PROPUBLICA&amp;quot;&amp;#41;&amp;#40;self&amp;#41;

    def request&amp;#40;self, endpoint=&amp;quot;&amp;quot;, headers={}, parameters=None&amp;#41;:
        return request&amp;#95;builder&amp;#40;self, &amp;quot;https://api.propublica.org/congress/v1/&amp;quot;&amp;#41;&amp;#40;self, endpoint, headers, parameters&amp;#41;

class courtlistener&amp;#40;object&amp;#41;:
    def &amp;#95;&amp;#95;init&amp;#95;&amp;#95;&amp;#40;self&amp;#41;:
        session&amp;#95;builder&amp;#40;self, &amp;quot;COURTLISTENER&amp;quot;&amp;#41;&amp;#40;self&amp;#41;

    def request&amp;#40;self, endpoint=&amp;quot;&amp;quot;, headers={}, parameters=None&amp;#41;:
        return request&amp;#95;builder&amp;#40;self, &amp;quot;https://www.courtlistener.com/api/rest/v3/&amp;quot;&amp;#41;&amp;#40;self, endpoint, headers, parameters&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(Please ignore the bug for now in that I forgot that the details of the auth header also change across APIs, that gets fixed below and isn't germane to the key point.)&lt;/p&gt;&lt;p&gt;Can we have a hearty &lt;em&gt;BWAHAHAHAHAAHAHA!!!!!&lt;/em&gt;?  Look at all that code I get to delete, and I get to leave off lots more code as I add more APIs! &lt;/p&gt;&lt;p&gt;So what this is doing is that for each of these methods, it's taking an externally defined function and closing over the class-specific data (the URLs, environment variables for API keys, etc.), then immediately invoking them (javascript-style, I suppose). &lt;/p&gt;&lt;p&gt;However, this solution isn't perfect either.  First of all, it's adding some overhead, since it actually creates a new function every time the request method is called, and immediately invokes it. Apparently there's a version that &lt;a href='https://stackoverflow.com/a/38549072/4386239'&gt;leverages more of Python's internals&lt;/a&gt;, but that seems, to me, less readable?  (Probably more readable to more pythonic people.)&lt;/p&gt;&lt;p&gt;This is more difficult because python does some kind of magic with passing the instance in with self.  I tried to go around the problem by defining request within the constructor, i.e.: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;def session&amp;#95;builder&amp;#40;selfvar, keyenv, baseurl&amp;#41;:
    def class&amp;#95;init&amp;#40;selfvar, api&amp;#95;key=&amp;quot;ENV&amp;quot;&amp;#41;:
        if api&amp;#95;key == &amp;quot;ENV&amp;quot;:
            try:
                selfvar.api&amp;#95;key = os.environ&amp;#91;keyenv&amp;#93;
            except KeyError as e:
                raise Exception&amp;#40;&amp;quot;API token is missing. Please set the {} environment variable or pass the token to the session constructor.&amp;quot;.format&amp;#40;keyenv&amp;#41;&amp;#41; from e
        else:
            selfvar.api&amp;#95;key = api&amp;#95;key
        selfvar.auth&amp;#95;header = {'X-API-Key': selfvar.api&amp;#95;key}
        selfvar.total&amp;#95;requests&amp;#95;this&amp;#95;session = 0
        selfvar.request = request&amp;#95;builder&amp;#40;selfvar, baseurl&amp;#41;
    return class&amp;#95;init
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;but apparently the python magic didn't go far enough to pass the self variable to a method defined that way: &lt;code&gt;TypeError: request&amp;#40;&amp;#41; missing 1 required positional argument: 'selfvar'&lt;/code&gt;.  Alas.&lt;/p&gt;&lt;p&gt;However, it occurred to me that I don't &lt;em&gt;really&lt;/em&gt; need the request method to mess with any internal state in the object it belongs to. I was tracking request counts only in order to squash a bug several iterations of the method ago, and that's the only thing that really requires getting at any state. So, why not rewrite to be completely free of internal state, and just close over the authentication information as well?&lt;/p&gt;&lt;p&gt;Thus, the final code! &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;def request&amp;#95;builder&amp;#40;auth&amp;#95;header, baseurl&amp;#41;:
    def request&amp;#40;endpoint=&amp;quot;&amp;quot;, headers={}, parameters=None&amp;#41;:
        if endpoint.startswith&amp;#40;&amp;quot;https://&amp;quot;&amp;#41;:
            ep = endpoint
        else:
            ep = baseurl + endpoint
        h = {}
        h = safe&amp;#95;merge&amp;#40;h, headers&amp;#41;
        h = safe&amp;#95;merge&amp;#40;h, auth&amp;#95;header&amp;#41;
        result = requests.get&amp;#40;ep, headers=h, params=parameters&amp;#41;
        result.raise&amp;#95;for&amp;#95;status&amp;#40;&amp;#41;
        return result.json&amp;#40;&amp;#41;
    return request

def session&amp;#95;builder&amp;#40;selfvar, keyenv, baseurl, keyheader, key&amp;#95;prefix=&amp;quot;&amp;quot;&amp;#41;:
    def class&amp;#95;init&amp;#40;selfvar, api&amp;#95;key=&amp;quot;ENV&amp;quot;&amp;#41;:
        if api&amp;#95;key == &amp;quot;ENV&amp;quot;:
            try:
                selfvar.api&amp;#95;key = os.environ&amp;#91;keyenv&amp;#93;
            except KeyError as e:
                raise Exception&amp;#40;&amp;quot;API token is missing. Please set the {} environment variable or pass the token to the session constructor.&amp;quot;.format&amp;#40;keyenv&amp;#41;&amp;#41; from e
        else:
            selfvar.api&amp;#95;key = api&amp;#95;key
        auth&amp;#95;header = {keyheader: key&amp;#95;prefix + selfvar.api&amp;#95;key}
        selfvar.request = request&amp;#95;builder&amp;#40;auth&amp;#95;header, baseurl&amp;#41;
    return class&amp;#95;init
    
class courtlistener&amp;#40;object&amp;#41;:

    def &amp;#95;&amp;#95;init&amp;#95;&amp;#95;&amp;#40;self&amp;#41;:
        session&amp;#95;builder&amp;#40;self, &amp;quot;COURTLISTENER&amp;quot;, &amp;quot;https://www.courtlistener.com/api/rest/v3/&amp;quot;, 'Authorization', 'Token '&amp;#41;&amp;#40;self&amp;#41;

class propublica&amp;#40;object&amp;#41;:

    def &amp;#95;&amp;#95;init&amp;#95;&amp;#95;&amp;#40;self&amp;#41;:
        session&amp;#95;builder&amp;#40;self, &amp;quot;PROPUBLICA&amp;quot;, &amp;quot;https://api.propublica.org/congress/v1/&amp;quot;, 'X-API-Key'&amp;#41;&amp;#40;self&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now it's even more stateless and functional, has even fewer lines of code, and allows the effortless creation of wrappers for authentication and basic requests for the other APIs I want to wrap. Plus if I want to add more error handling or whatnot to the requests, I can do it all in one place.  With no subclassing. &lt;/p&gt;&lt;p&gt;Unidiomatic functional programming in Python! &lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Mon, 17 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/ng5/
</guid>
<link>
http://paultopia.github.io/posts-output/ng5/
</link>
<title>
Mathy Ng Lecture 5: generative learning algorithms, naive bayes
</title>
<description>
&lt;h2&gt;&lt;a name=&quot;ng&amp;#95;lecture&amp;#95;5:&amp;#95;generative&amp;#95;learning&amp;#95;algorithms&quot;&gt;&lt;/a&gt;Ng lecture 5: generative learning algorithms&lt;/h2&gt;&lt;h3&gt;&lt;a name=&quot;the&amp;#95;idea&amp;#95;of&amp;#95;generative&amp;#95;algorithms&quot;&gt;&lt;/a&gt;The idea of generative algorithms&lt;/h3&gt;&lt;p&gt;Algorithms like logistic regression are like &quot;try to find a straight line that separate the classes best.&quot; Those are discriminative learning algorithms.&lt;/p&gt;&lt;p&gt;By contrast, imagine an algorithm that finds all the examples of class x and builds a model of what those look, then finds all the examples of class y and builds a model of what those look like; classification then becomes &quot;let's see what our new observation looks like.&quot;&lt;/p&gt;&lt;p&gt;So that's a generative learning algorithm.&lt;/p&gt;&lt;p&gt;More formally: &lt;/p&gt;&lt;p&gt;Discriminative algorithm learns p(y|x) directly by learning a hypothesis function &lt;code&gt;$h&amp;#40;\theta&amp;#41;$&lt;/code&gt; that outputs a label in the range of 0 to 1. &lt;/p&gt;&lt;p&gt;By contrast, a generative algorithm models p(x|y) and p(y).  It builds a model of what the features look like conditioned on the class label.&lt;/p&gt;&lt;p&gt;Then Bayes rule steps in, because of course it does. &lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;gaussian&amp;#95;discriminant&amp;#95;analysis:&quot;&gt;&lt;/a&gt;Gaussian discriminant analysis:&lt;/h3&gt;&lt;p&gt;Assumes input features are continuous-values random variables and p(x|y) is multivariate gaussian. &lt;/p&gt;&lt;p&gt;Models the response as a bernoulli. &lt;/p&gt;&lt;p&gt;Features are modeled as a separate distribution for each value of y, i.e., p(x|y=0) is one distribution with mean &lt;code&gt;$\mu&amp;#95;0$&lt;/code&gt;  p(x|y=1) is another distribution with mean &lt;code&gt;$\mu&amp;#95;1$&lt;/code&gt;  Leaving off the likelihood derivations.  The practical implication is that GDA is like logistic regression, but has the stronger assumptions, and if those assumptions are satisfied, is likely to produce better performance.&lt;/p&gt;&lt;p&gt;This is something that's true of generative models in general: you have to make modeling assumptions about your features, and if those are right, then you've got a better fitting model. See pg. 7-8 of &lt;a href='https://see.stanford.edu/materials/aimlcs229/cs229-notes2.pdf'&gt;notes 2&lt;/a&gt;.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;It turns out that if p(x|y) = 1  and p(x|y) = 0 are both in an exponential family distribution (the same one?), p(y|x) is logistic.&lt;/p&gt;&lt;p&gt;Notation note: the squiggle brackets around the y=1 i the maximum likelihood estimates are indicator notation, they indicate that it's essentially a counter, that increments once for each time that the variable is 1.  In other words, the value within the summation of the squiggly thing is 1 if the appropriate y is 1 for y=1, and so forth.  So it's really just a bunch of averages.&lt;/p&gt;&lt;p&gt;Prediction it's in the lecture at 23:00ish.  You predict the value of y (argmax with respect to y) that maximizes P(y|x), which, by bayes rule and some algebra, turns into argmax y p(x|y)p(y). &lt;/p&gt;&lt;p&gt;Essentially, you're building a model of p(x|y=1), a model of p(x|y=0), and fit a bernoilli to p(y) basically just by taking the average of y's incidences in the observation. &lt;/p&gt;&lt;p&gt;Much more simple and straightforward version: what he gives us is just a closed-form solution, like the matrix multiplication in regression.  We have the maximum likelihood function (page 6 of &lt;a href='https://see.stanford.edu/materials/aimlcs229/cs229-notes2.pdf'&gt;notes 2&lt;/a&gt;) and we seriously just plug our data into it.  Then we have [an estimate of] the probability distribution of y, and ditto for x|y=0 and x|y=1. Given that information, and some x, we can plug in an observed value for x into the distributions we got from our training, and hence have point estimates on all those distributions. Then from those point estimates, we apply bayes rule.  (Or at least I think this is how it goes.)&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;naive&amp;#95;bayes&quot;&gt;&lt;/a&gt;Naive bayes&lt;/h3&gt;&lt;p&gt;The conditional independence across the x's assumption is, well, false, like always. (That's the naive part.)  But it works surprisingly well for, e.g., classifying text documents.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;The idea of this kind of text classification is a bag of words might have, like, 50,000 distinct words, far too many features to fit to a multinomial or something in your spam classifier. &lt;/p&gt;&lt;p&gt;But with the conditional independence assumption you can just assume the probability of all your x's given y is just the product of each individual conditional probability of xi|y.&lt;/p&gt;&lt;p&gt;Unsurprisingly, the maximum likelihood estimate for the word j conditional on being spam is just the proportion of e-mails that had that word and were spam within the e-mails that were spam... this is just basic probability. &lt;/p&gt;&lt;p&gt;And, again, the probability of y is just the proportion of spam e-mails in the dataset.&lt;/p&gt;&lt;p&gt;and then you compute p(y|x) with bayes rule &lt;/p&gt;&lt;p&gt;So I'm guessing that to actually predict, you compute the product of the p(x|y) for all x, and that's the joint probability of p(y|x) thanks to the conditional independence assumption, then bayes rule gives you your prediction right away.  This is almost comically easy.&lt;/p&gt;&lt;p&gt;Also, here's &lt;a href='https://www.youtube.com/watch?v=TpjPzKODuXo&amp;list=PL6397E4B26D00A269&amp;index=26'&gt;another explanation&lt;/a&gt; of how Naive Bayes works by more Stanford profs Dan Jurafsky &amp; Chris Manning (and &lt;a href='https://www.youtube.com/watch?v=0hxaqDbdIeE&amp;index=27&amp;list=PL6397E4B26D00A269'&gt;second part&lt;/a&gt;).&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;laplace&amp;#95;smoothing&quot;&gt;&lt;/a&gt;Laplace smoothing&lt;/h3&gt;&lt;p&gt;What happens when you try to classify something with a word that wasn't in your training set?  Oh boy, you're dividing by zero when you apply bayes rule. That's bad.  (The numerator is 0 too thanks to some products.  Bad.)&lt;/p&gt;&lt;p&gt;So what we just do is, instead of calculating the probability p(xi|y=1) with the raw proportion, we add 1 to the numerator and k, where k is the number of possible values for xi (i.e., 2, with all these dichotomous variables we're working with). (or is it possible values for y? should investigate.)  And we do that with our other maximum likelihood estimators too. Essentially we just add 1 to every count, including the counts in the denominator.  That keeps the probabilities of unseen events from being 0, which is nice, but keeps the good statistical properties.&lt;/p&gt;&lt;p&gt;(question: why don't we just drop words that don't appear in the training data from our predictions?  Answer, after chatting with a fellow Recurser: because it's not just that unseen features in the training set will generate zero posterior probabilities, but also that if a feature hasn't been seen in &lt;em&gt;just one&lt;/em&gt; of the classes, that will make the probability for that class go to zero.  So you'd have to drop more than just words that never appeared, you'd have to throw out all words that appeared only in one class, which would toss out a ton of useful information.)&lt;/p&gt;&lt;p&gt;So I take naive bayes to be, from start to finish:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;load documents and labels&lt;/li&gt;&lt;li&gt;create set of all words in documents&lt;/li&gt;&lt;li&gt;for each word, create feature as appears/does not appear number of times that word appears in the given document.  (In the Dan Jurafsky &amp; Chris Manning version, it's a bit more complex because they use counts rather than indicators.)&lt;/li&gt;&lt;li&gt;then for each word, &quot;train&quot; by creating vector of conditional probabilities for each class, i.e., probability of word x given class 1, probability of word x given class 2, etc.  This is calculated by simple proportion, i.e., number of documents in the class in which the word appears, divided by count of documents in the class. See page 10 of &lt;a href='https://see.stanford.edu/materials/aimlcs229/cs229-notes2.pdf'&gt;notes 2&lt;/a&gt; for the formal version.  This can probably be stored in some kind of hash. (The Dan Jurafsky &amp; Chris Manning version has slightly different calculations because they're using counts rather than binary features, but I think I like the Ng version better.)&lt;/li&gt;&lt;li&gt;Remember to do previous step with laplace smoothing. (add 1 to each numerator, and 2 to each denominator for binary feature)&lt;/li&gt;&lt;li&gt;then for a prediction, just take every word, then, for each class multiply out the conditional probabilities for each word given that class and the class, and divide by the overall probability of that data, as shown on the last formula on page 10 of the notes. Then predict the class where that product is highest. If an unknown word appears, it just gets the conditional probability 1/2 or whatever other laplace denominator you use for every class, thanks to smoothing.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Possible correction: should step 2 (dictionary creation) be based on all words in existing training set, or based on a preexisting dictionary s.t. we assign uninformative priors via laplace smoothing to words that don't appear in training set right from start?  This might just be a matter of choice/convenience for improving the model over time? &lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Mon, 17 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/haskell-debug-bgd/
</guid>
<link>
http://paultopia.github.io/posts-output/haskell-debug-bgd/
</link>
<title>
A Debugging Trek, and: (naive) Batch Gradient Descent in Haskell
</title>
<description>
&lt;p&gt;So I implemented &lt;a href='https://paultopia.github.io/posts-output/ng1/'&gt;batch gradient descent&lt;/a&gt; in Haskell, to simultaneously solidify my understanding of the algorithm and work on learning Haskell. &lt;/p&gt;&lt;p&gt;It got a bit bumpy. I've preserved my &lt;a href='https://github.com/paultopia/haskeml/blob/master/notes.md'&gt;realtime notes&lt;/a&gt; of the mess. But the short version is that after a certain number of iterations that was an increasing function the learning rate, the model would just terminate in weights of Infinity for all features. &lt;/p&gt;&lt;p&gt;So!  Debugging.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Step 1: get some more eyeballs. A kindly recurser pointed out that the argument orders to one of my functions was switched. This is the kind of thing that Haskell is supposed to avoid, but when everything is of type [Double] I guess one can hardly rely on the type checker to catch that it's the wrong one, can one?&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Alas, that wasn't the bug. I was just multiplying two lists together elementwise, and since multiplication is commutative, well.&lt;/p&gt;&lt;p&gt;Step 2: implement in an easier language first.  With math-y code that produces wildly incorrect results, there are really two possibilities: either the code is buggy or the code is fine but my understanding of the math is wrong.  (Or both, I suppose.)  The second possibility seemed easier to eliminate first&amp;mdash;with correct math, one can get evidence supporting the proposition that the code is correct from getting correct results, but it doesn't really work the other way around unless there's some way of proving code correctness other than testing. So. &lt;/p&gt;&lt;p&gt;So I &lt;a href='https://github.com/paultopia/haskeml/blob/master/python-reference-bgd-implementation.ipynb'&gt;re-implemented the algorithm in python&lt;/a&gt;, complete with lots of slow and careful idiot-checking print statements. Somewhere in the middle, I realized that I hadn't scaled the features in the Haskell version (alas, that didn't turn out to be the bug either, but it did kindly turn my lists of &lt;code&gt;Infinity&lt;/code&gt; into lists of &lt;code&gt;NaN&lt;/code&gt;). The Python version produced reasonable results. So that's great, my math is good. Back to the Haskell.&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Then I dug into the Haskell.  Not knowing how to insert the equivalent of &lt;code&gt;printf&lt;/code&gt; statements into this language&amp;mdash;do you need an IO type or something??&amp;ndash; I was at a loss for a while.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;It turns out that ghci &lt;a href='https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/ghci-debugger.html'&gt;has a debugger&lt;/a&gt;, which I played around with for a while, but it wasn't terribly enlightening&amp;mdash;it's a bit involved, and could use more study. &lt;/p&gt;&lt;p&gt;Then I discovered that there is a printf equivalent.  Because of course there is.  It's in the magic &lt;a href='https://hackage.haskell.org/package/base-4.9.1.0/docs/Debug-Trace.html'&gt;Debug.Trace&lt;/a&gt; library. And it's extra magical: you can just stick a call to &lt;code&gt;traceShow&lt;/code&gt; in front of whatever code you want to look at, and you'll get to see whatever values you pass it.&lt;/p&gt;&lt;p&gt;With that, it didn't take me long to find my bug.  I successively logged 20 iterations of all the interesting parameters to my gradient descent function, and soon discovered that on each iteration of the gradient, the error was monotonically increasing, rather than decreasing. Which obviously isn't right.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;The obvious hypothesis there is that a sign got flipped somewhere.  And, lo and behold, after looking at the relevant part of the code, inside the gradient descent summation where I meant to be subtracting the label from the hypothesis, I actually was subtracting the hypothesis from the label. &lt;/p&gt;&lt;p&gt;Subtraction, alas, is not commutative. &lt;/p&gt;&lt;p&gt;Anyway, here's the fixed code!&lt;br /&gt;&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;haskell&quot;&gt;module Olsgradient where
import Data.List
default &amp;#40;Double&amp;#41;

addIntercept :: &amp;#91;&amp;#91;Double&amp;#93;&amp;#93; -&amp;gt; &amp;#91;&amp;#91;Double&amp;#93;&amp;#93;
addIntercept = map &amp;#40;\x -&amp;gt; 1.0:x&amp;#41;

predict :: &amp;#91;&amp;#91;Double&amp;#93;&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93;
predict observations weights =
  let mult = map &amp;#40;\x -&amp;gt; zipWith &amp;#40;&amp;#42;&amp;#41; x weights&amp;#41; observations
  in map sum mult

subtractMaker :: Double -&amp;gt;  &amp;#91;Double&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; Double
subtractMaker learnRate costs featureList =
  let costFeatureMult = zipWith &amp;#40;&amp;#42;&amp;#41; costs featureList
  in learnRate &amp;#42; sum costFeatureMult

gradientStep :: Double -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; &amp;#91;&amp;#91;Double&amp;#93;&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93;
gradientStep learnRate labels weights observations =
  let preds = predict observations weights
      costs = zipWith &amp;#40;-&amp;#41; preds labels
      featureMatrix = transpose observations
      subtractors = map &amp;#40;subtractMaker learnRate costs&amp;#41; featureMatrix
  in zipWith &amp;#40;-&amp;#41; weights subtractors

innerTrainOLS :: &amp;#91;&amp;#91;Double&amp;#93;&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; Double -&amp;gt; Double -&amp;gt; Double -&amp;gt; Double -&amp;gt; &amp;#91;Double&amp;#93;
innerTrainOLS observations labels weights learnRate threshold maxIter numIter 
  | numIter &amp;gt; maxIter = weights
  | sse &amp;lt; threshold = weights
  | otherwise = innerTrainOLS observations labels newWeights learnRate threshold maxIter &amp;#40;numIter + 1&amp;#41;
  where
    preds = predict observations weights
    sse = sum $ map &amp;#40;&amp;#42;&amp;#42;2.0&amp;#41; &amp;#40;zipWith &amp;#40;-&amp;#41; labels preds&amp;#41;
    newWeights = gradientStep learnRate labels weights observations

trainOLS :: &amp;#91;&amp;#91;Double&amp;#93;&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; Double -&amp;gt; Double -&amp;gt; Double -&amp;gt; &amp;#91;Double&amp;#93;
trainOLS observations labels learnRate threshold maxIter =
  let obvs = addIntercept observations
      numFeats = length $ head obvs
      initweights = replicate numFeats 1
  in innerTrainOLS obvs labels initweights learnRate threshold maxIter 0

mean :: &amp;#91;Double&amp;#93; -&amp;gt; Double
mean lst = sum lst / fromIntegral &amp;#40;length lst&amp;#41;

standardDeviation :: &amp;#91;Double&amp;#93; -&amp;gt; Double
standardDeviation lst =
  let m = mean lst
      n = length lst
      squaredErrors = map &amp;#40;\x -&amp;gt; &amp;#40;x - m&amp;#41; &amp;#42;&amp;#42; 2.0&amp;#41; lst
  in sqrt &amp;#40;sum squaredErrors / fromIntegral n&amp;#41;

scale :: &amp;#91;Double&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93;
scale lst =
  let m = mean lst
      stdev = standardDeviation lst
  in map &amp;#40;\x -&amp;gt; &amp;#40;x - m&amp;#41; / stdev&amp;#41; lst
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note how smelly it is.  For example, &lt;code&gt;innerTrainOLS :: &amp;#91;&amp;#91;Double&amp;#93;&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; &amp;#91;Double&amp;#93; -&amp;gt; Double -&amp;gt; Double -&amp;gt; Double -&amp;gt; Double -&amp;gt; &amp;#91;Double&amp;#93;&lt;/code&gt; is like legit stink.  But it does the job for now, and cleanup can come later. :-) &lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Mon, 17 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/ng1/
</guid>
<link>
http://paultopia.github.io/posts-output/ng1/
</link>
<title>
Lecture 2 of Andrew Ng's mathier ML course
</title>
<description>
 &lt;p&gt;One of the things I'm doing at &lt;a href='https://www.recurse.com/'&gt;RC&lt;/a&gt; is working through &lt;a href='https://see.stanford.edu/Course/CS229/54'&gt;the mathier version&lt;/a&gt; of Andrew Ng's famous machine learning course. Here are my notes from the first substantive lecture (lecture 2). &lt;/p&gt;&lt;p&gt;n.b. the math is all in code blocks because the markdown processor screws with underscores and carets otherwise, and mathjax can't handle that.  This is making me insane and I might actually write some kind of post-processor to jerk around the generated html files to fix this, but it'll have to do for now.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;lecture&amp;#95;2&quot;&gt;&lt;/a&gt;Lecture 2&lt;/h2&gt;&lt;p&gt;Linear regression, mostly stuff I've already seen a bunch of times, but with the derivations using weirder linear algebra than usual, and with more gradient descent and less closed-form solutions.&lt;/p&gt;&lt;p&gt;His notation: &lt;/p&gt;&lt;p&gt;m = number of training examples&lt;/p&gt;&lt;p&gt;x = features&lt;/p&gt;&lt;p&gt;y = output (labels/target)&lt;/p&gt;&lt;p&gt;(x, y) = training example&lt;/p&gt;&lt;p&gt;superscript i for indexing over examples.&lt;/p&gt;&lt;p&gt;h for model hypothesis &amp;mdash; it's the function mapping x-&gt;y &lt;/p&gt;&lt;p&gt;representing weights as $\theta$&lt;/p&gt;&lt;p&gt;n is the number of features&lt;/p&gt;&lt;p&gt;(Aaah, why not use n for the number of observations like scientists do?  Why can we not have consistent naming and notation in this world? Also, at some point when I was in grad school, we made a Stanford polisci t-shirt that had the slogan &quot;it's not the size of your n, it's how you use it.&quot; Where did that go? I miss that shirt.)&lt;/p&gt;&lt;p&gt;&lt;code&gt;$J&amp;#40;\theta&amp;#41;$&lt;/code&gt; is the sum of squared errors / 2.  (Apparently, from discussion afterward with mathier people, these get divided by 2 in order to make differentiation cleaner.)&lt;/p&gt;&lt;p&gt;Gradient descent algorithm:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$\theta&amp;#95;i := \theta&amp;#95;i - \partial \frac{\partial}{\partial \theta} J&amp;#40;\theta&amp;#41;$$
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;that is, update the ith weight by subtracting the partial derivative of the cost (J(θ)) with respect to the ith weight (30:29 in video 2).&lt;/p&gt;&lt;p&gt;Calculus reminder: that &lt;a href='https://www.khanacademy.org/math/multivariable-calculus/multivariable-derivatives/partial-derivative-and-gradient-articles/a/introduction-to-partial-derivatives'&gt;partial derivative&lt;/a&gt; is essentially the magnitude of the change in the cost given an epsilon change in the weight at the given value of θ. &lt;/p&gt;&lt;p&gt;This &lt;a href='https://www.youtube.com/watch?v=i94OvYb6noo'&gt;lecture&lt;/a&gt; (suggested by a batch-mate) is also good on the gradients:&lt;/p&gt;&lt;p&gt;(Ng uses &lt;code&gt;:=&lt;/code&gt; to mean &quot;update the variable on the left by the algorithm on the right&quot;)&lt;/p&gt;&lt;p&gt;Ultimately, it's just taking a step in the direction of the (local) minimum error.&lt;/p&gt;&lt;p&gt;After doing the calculus, that turns into: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt;$$\theta&amp;#95;i : = \theta&amp;#95;i - \alpha &amp;#40;h&amp;#95;{\theta}&amp;#40;x&amp;#41; - y&amp;#41; \cdot x&amp;#95;i$$
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;where alpha is the learning rate (a model parameter). This is for one training example.&lt;/p&gt;&lt;p&gt;which is super convenient, since &lt;code&gt;$&amp;#40;h&amp;#95;{\theta}&amp;#40;x&amp;#41; - y&amp;#41;$&lt;/code&gt; is just the straightforward error at a given step.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;batch&amp;#95;gradient&amp;#95;descent&quot;&gt;&lt;/a&gt;Batch gradient descent&lt;/h3&gt;&lt;p&gt;For m training examples, the algorithm just sums the error over the training examples, i.e.,&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt;$$\theta&amp;#95;i : = \theta&amp;#95;i - \alpha \sum&amp;#95;{j=1}&amp;#94;{m} &amp;#40;h&amp;#95;{\theta}&amp;#40;x&amp;#94;{&amp;#40;j&amp;#41;}&amp;#41; - y&amp;#94;{&amp;#40;j&amp;#41;}&amp;#41; \cdot x&amp;#95;i&amp;#94;{&amp;#40;j&amp;#41;}$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;and then repeat until convergence&lt;/p&gt;&lt;p&gt;For OLS, there's only one global minimum, it's just a quadratic function that (therefore?) is &quot;bow-shaped&quot; (I've never understood these visual analogies on functions, but I take it that this is a good thing, and maybe means the same thing as convex??  Convexity is the property we discussed in our little group afterwards, so probably.  Note to self, really need to understand convexity and what it entails lots better.), and so no nasty local minima.&lt;/p&gt;&lt;p&gt;(Terminology reminder: gradient = derivative. &lt;a href='https://math.stackexchange.com/questions/1519367/difference-between-gradient-and-jacobian'&gt;Essentially&lt;/a&gt;.)&lt;/p&gt;&lt;p&gt;It turns out that this computation is the direction of steepest descent, for reasons that Ng doesn't feel like proving. &lt;/p&gt;&lt;p&gt;This is called &quot;batch gradient descent&quot; because at every step of gradient descent you look at the whole dataset, perform a sum over m training examples.&lt;/p&gt;&lt;p&gt;That's problematic if you have a ton of training examples.  So there's an alternative:&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Stochastic Gradient Descent&lt;/strong&gt; (a.k.a. &quot;incremental descent&quot;)&lt;/p&gt;&lt;p&gt;repeat until convergence: &lt;pre&gt;&lt;code&gt;for j = 1 to m: 
    perform an update using just the jth training example &amp;#40;for each i&amp;#41; 
 &lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;&lt;p&gt;that update is just&lt;br /&gt;&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$\theta&amp;#95;i : = \theta&amp;#95;i - \alpha &amp;#40;h&amp;#95;{\theta}&amp;#40;x&amp;#94;{&amp;#40;j&amp;#41;}&amp;#41; - y&amp;#94;{&amp;#40;j&amp;#41;}&amp;#41; \cdot x&amp;#95;i&amp;#94;{&amp;#40;j&amp;#41;}$$
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;in practice, this tends to go rather faster for large datasets. It doesn't actually converge exactly to the global minimum, but they tend to wander close to it. &lt;/p&gt;&lt;p&gt;Question I had: what's stochastic about this? It's not like it's actually randomly sampling the data or anything. In discussion afterward, someone said that it's called stochastic because it's based on the idea that the expectation of the update on a single observation is the same as the expectation on the update on the whole thing, which makes sense well enough to me.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;closed&amp;#95;form&amp;#95;solution&amp;#95;of&amp;#95;theta&quot;&gt;&lt;/a&gt;Closed form solution of theta&lt;/h3&gt;&lt;p&gt;More new notation, for matrix derivatives. I mostly let this go by, because I feel like I've learned this derivation once already, courtesy of grad school, and I don't feel the need to do it again with different linear algebra. But reference: &lt;a href='https://see.stanford.edu/materials/aimlcs229/cs229-notes1.pdf'&gt;part 1 of his lecture notes&lt;/a&gt; on pg. 8.&lt;/p&gt;&lt;p&gt;A few points of interest: explanation of the stuff in the notes:&lt;/p&gt;&lt;p&gt;delta J, J is a function of vector parameters theta, recall. The derivative of J with respect to theta is itself a vector of partial derivatives, a n+1 dimensional vector. So then we can rewrite the batch gradient example as theta (not subscripted&amp;mdash;it's the whole thing, update the whole paramerer) minus that big gradient, i.e., &lt;code&gt;$\theta := \alpha \nabla&amp;#95;\theta J$&lt;/code&gt; &amp;ndash;and all of those quantities are N+1dimensional vectors. (except alpha, obvs)&lt;/p&gt;&lt;p&gt;Definition that feel like a bit of linear algebra I skipped: if A is a square matrix, the &lt;em&gt;trace&lt;/em&gt; of A is the sum of A's diagonal elements. &lt;code&gt;$tr A = \sum&amp;#95;{i=1}&amp;#94;n A&amp;#95;{ii}$&lt;/code&gt; Which sounds like skipped-over linear algebra to me.&lt;/p&gt;&lt;p&gt;Ultimately this leads to the classic closed form solution to OLS, which shows up on pg. 11 of part 1 of lecture notes. &lt;/p&gt;&lt;p&gt;Also might be worth noting (from video at 1:00) that the &quot;design matrix&quot; is a matrix that has the training examples input values on the rows.  In notes and on chalkboards, there's a very confusing notation with dashes and an unexplained superscript with a  T in it... but I take it that the first row is the vector of features for first training example, second row is for second draining example (from video at 1:01).&lt;/p&gt;&lt;p&gt;Then design matrix multiplied by theta vector is just the hypotheses for a given set of weights.  And the error is going to be elementwise subtracting the elements of the y vector (label vector, which gets an arrow over it in the notes like &lt;code&gt;$\overrightarrow{y}$&lt;/code&gt;).&lt;/p&gt;&lt;p&gt;Anyway, classic closed form: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$\theta = &amp;#40;X&amp;#94;TX&amp;#41;&amp;#94;{-1}X&amp;#94;T\overrightarrow{y}$$
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is our old friend OLS. Hello OLS. You're also &lt;a href='https://github.com/paultopia/browser-stats/blob/master/statspop/src/statspop/math/regression.cljs#L15'&gt;enjoyably easy to implement in clojurescript&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Note at the end of the lecture in response to a student question: usually, if &lt;code&gt;$X&amp;#94;TX$&lt;/code&gt; isn't invertible, it's because you've got dependent features in there, like repeating the same feature twice or something. (or linear combination, I take it? Standard OLS blow-up...)&lt;/p&gt;&lt;p&gt;that's it!&lt;/p&gt;&lt;p&gt;(note to self for future: to get mathml and highlight.js and this markdown parser to play nicely together, math has to be in code blocks, but those code blocks have to be either inline or they have to get the &lt;code&gt;nohighlight&lt;/code&gt; class; in the latter case there apparently needs to be whitespace after the class declaration on the code block or for some mysterious reason it'll get a bunch of other classes instead, god only knows why.)&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Fri, 07 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/ng3/
</guid>
<link>
http://paultopia.github.io/posts-output/ng3/
</link>
<title>
Mathy Ng Lecture 4: Newton's Method, Exponential Family Distributions, GLMs
</title>
<description>
&lt;h2&gt;&lt;a name=&quot;ng&amp;#95;lecture&amp;#95;4:&amp;#95;newton's&amp;#95;method,&amp;#95;exponential&amp;#95;family&amp;#95;distributions,&amp;#95;glms.&quot;&gt;&lt;/a&gt;Ng Lecture 4: Newton's Method, Exponential Family Distributions, GLMs.&lt;/h2&gt;&lt;h3&gt;&lt;a name=&quot;newton's&amp;#95;method&quot;&gt;&lt;/a&gt;Newton's Method&lt;/h3&gt;&lt;p&gt;Motivation for Newton's method: suppose you have a nonlinear function of &lt;code&gt;$\theta$&lt;/code&gt; and you want to figure out at what value of &lt;code&gt;$\theta$&lt;/code&gt; it == 0.&lt;/p&gt;&lt;p&gt;One strategy is just to pick an arbitrary &lt;code&gt;$\theta&amp;#94;{&amp;#40;0&amp;#41;}$&lt;/code&gt;  calculate &lt;code&gt;$f&amp;#40;\theta&amp;#94;{&amp;#40;o&amp;#41;}&amp;#41;$&lt;/code&gt;  and then compute a derivative there in order to get a linear approximation to f, i.e., get a tangent line at that point.  Then extend the tangent line until it extends to the horizontal axis and call that &lt;code&gt;$\theta&amp;#94;{&amp;#40;1&amp;#41;}$&lt;/code&gt; (i.e., solve the linear approximation function &lt;code&gt;$f'&amp;#40;\theta&amp;#94;{&amp;#40;1&amp;#41;}&amp;#41; = 0$&lt;/code&gt; . That's one iteration. And then keep repeating that with a tangent line to &lt;code&gt;$\theta&amp;#94;{&amp;#40;1&amp;#41;}$&lt;/code&gt; and so forth.  This is Newton's method.&lt;/p&gt;&lt;p&gt;After a little algebra, this gives us an update rule for Newton's method:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$\theta := \theta - \frac{f&amp;#40;\theta&amp;#41;}{f'&amp;#40;\theta&amp;#41;}$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We can apply the same idea to maximizing the log-likelihood. If we have a likelihood function, we want to find the place where its derivative == 0. (Of course, that could also be a minimum. In the case of linear regression and such that shouldn't be a problem, because convex... right?) And we can apply the same update rule to that function ( where &quot;that function&quot; is the derivative of the likelihood function).  So, if &lt;code&gt;$\lambda$&lt;/code&gt; is the likelihood function, the update rule is:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$\theta := \theta - \frac{\lambda'&amp;#40;\theta&amp;#41;}{\lambda''&amp;#40;\theta&amp;#41;}$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In multiple dimensions, this turns into multiplying a matrix of first derivatives by the inverse of a matrix called the Hessian, which is a matrix of second derivatives.  See page 21 of &lt;a href='https://see.stanford.edu/materials/aimlcs229/cs229-notes1.pdf'&gt;lecture notes 1&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Usually this goes faster than gradient descent for small numbers of features, but if there are lots of features, be aware that the Hessian is a n+1/n+1 matrix (remembering that Ng uses n for number of features and m for number of rows), it can be computationally expensive.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;generalized&amp;#95;linear&amp;#95;models&quot;&gt;&lt;/a&gt;Generalized Linear Models&lt;/h3&gt;&lt;p&gt;Some terminology. Bernoulli and Gaussian aren't single distributions but really lasses of distributions, depending on their parameters.  And both classes are in the family of &quot;exponential distributions.&quot;  So are lots of others&amp;mdash;Poisson, gamma, exponential, beta, Dirichlet are examples that he gives in the notes, but says there are also &quot;many more.&quot;&lt;/p&gt;&lt;p&gt;The point, leaving aside the derivations of how the Bernoilli and Gaussian are in the exponential family, is that you can construct a GLM for anything in the exponential family. So if you've got something where what you're trying to predict is well modeled by a Poisson, or a Dirichlet, or whatever, you're good. &lt;/p&gt;&lt;p&gt;Three assumptions of GLM: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;Given inputs x and parameters &lt;code&gt;$\theta$&lt;/code&gt;  the response variable y is distributed in the exponential family with some natural parameter (see lecture notes 1 p. 22) &lt;code&gt;$\eta$&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Given x, the goal is to output (as h(x)) the expected value of the sufficient statistic of y &lt;code&gt;$E&amp;#91;T&amp;#40;y&amp;#41;|x&amp;#93;$&lt;/code&gt;   Typically, &lt;code&gt;$T&amp;#40;y&amp;#41; = y$&lt;/code&gt; (see page 22 of lecture notes 1).&lt;/li&gt;&lt;li&gt;There's a linear relationship between the natural parameter and the inputs: &lt;code&gt;$\eta = \theta&amp;#94;Tx$&lt;/code&gt; (where the elements of &lt;code&gt;$\theta$&lt;/code&gt; just contain constants, not functions of x or something wild like that, I take it, or it needn't be linear...).&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;And judging from what happened at around minute 45, I take it that what you really just do is write the distribution as an exponential family, and then substitute &lt;code&gt;$\theta&amp;#94;Tx$&lt;/code&gt; for &lt;code&gt;$\eta$&lt;/code&gt;  And then what you get is the function for your hypothesis. See pp. 25-6 for examples of OLS and logistic. The reason we choose the sigmoid function for our hypothesis for the logistic is because we decided that the bernoulli distribution is a natural distribution to use to model these binary choices. &lt;/p&gt;&lt;p&gt;So: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;Pick a distribution.&lt;/li&gt;&lt;li&gt;Formulate that distribution as an exponential family distribution.&lt;/li&gt;&lt;li&gt;Make use of assumption 3 above to swap out the eta.&lt;/li&gt;&lt;li&gt;Then you have your hypothesis.&lt;/li&gt;&lt;li&gt;Train by maximum likelihood.  How?  Take the log likelihood (reminder: that works because maximizing the likelihood can be done by maximizing a strictly increasing function of the likelihood) of the function giving the probability of response data given feature data paramaterized by theta, as before; see pg. 29-30 for an example re: softmax (Likelihood reminder: the product, over the training set, of probability of label given feature.). And then maximize it, using gradient or newton.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Where to actually find the likelihood function?  The heart of the idea goes back to pg. 18 of notes 1 in yesterday's material: the likelihood function starts by assuming that the hypothesis is correct, for some theta. That's what &quot;Let us assume that: &lt;code&gt;$P&amp;#40;y=1 | x;\theta&amp;#41; = h&amp;#95;\theta&amp;#40;x&amp;#41;$&lt;/code&gt; and &lt;code&gt;$P&amp;#40;y=0 | x;\theta&amp;#41; = 1 - h&amp;#95;\theta&amp;#40;x&amp;#41;$&lt;/code&gt;  says to us. So then in the later equations on pg. 18 we can substitute a function of the hypotheses (in the case of logit, a simple h and 1-h) for the probability of an individual outcome; the probability of all the outcomes at once is their product by standard probability theory.&lt;/p&gt;&lt;p&gt;Softmax, given at the end of the material today, is a generalization of logistic to multiple classes.  The hypothesis is a vector of probabilities for each class, based on the multinomial distribution.&lt;/p&gt;&lt;p&gt;An insight from the study group, discussing the previous lesson: &lt;/p&gt;&lt;p&gt;Why does the assumption that errors are normally distributed imply that the likelihood function on OLS is this gaussian thing?  Because if you hold x and &lt;code&gt;$\theta$&lt;/code&gt; constant, then the response has to be distributed the same way as the errors are. &lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Fri, 07 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/ng2/
</guid>
<link>
http://paultopia.github.io/posts-output/ng2/
</link>
<title>
Lecture 3 of Andrew Ng's mathier ML course
</title>
<description>
  &lt;h2&gt;&lt;a name=&quot;lecture&amp;#95;3&amp;#95;&amp;ndash;&amp;#95;locally&amp;#95;weighted&amp;#95;regression&quot;&gt;&lt;/a&gt;Lecture 3 &amp;ndash; locally weighted regression&lt;/h2&gt;&lt;p&gt;Nonparametric algorithms reduce &quot;the need to choose features very carefully&quot; (I guess that makes sense if you think of features as mathematical transformations on stuff observed rather than stuff observed in general... a nonparemetric algorithm surely can't avoid the fact that you left something off, though I guess it can help avoid the fact that you threw a bunch of extra stuff in...)&lt;/p&gt;&lt;p&gt;Formal definition of a nonparametric algorithm is an algorithm where the number of parameters grows with m.  Which also means it needs to hold onto the entire training set even after training. As a student said in questions, &quot;it's like you're not even really building a model at all.&quot; You just fit for every training example. (This seems really expensive!!)&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;locally&amp;#95;weighted&amp;#95;regression&amp;#95;(loess/lowss)&quot;&gt;&lt;/a&gt;Locally weighted regression (loess/lowss)&lt;/h3&gt;&lt;p&gt;Concept: consider a value for x, the vector of features, of a single observation. To make a prediction with OLS, we'd find the vector of weights (parameters) &lt;code&gt;$\theta$&lt;/code&gt; s.t. they minimize the cost function, then return &lt;code&gt;$\theta&amp;#94;tx$&lt;/code&gt; as prediction.&lt;/p&gt;&lt;p&gt;For loess, we'd take a region around x, and work on the subset of data around there. So, geometrically, rather than predicting y based a line fitted to the entire dataset, predicts y based a line fitted to a subset of the dataset around x.&lt;/p&gt;&lt;p&gt;formally, in loess we fit &lt;code&gt;$\theta$&lt;/code&gt; to minimize a weighted version of the same loss function we use in OLS, where the weights are chosen such that we give more weight to training examples closer to what we're trying to predict. &lt;/p&gt;&lt;p&gt;i.e., OLS minimizes: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$\sum&amp;#95;i&amp;#40;y&amp;#94;{&amp;#40;i&amp;#41;}-\theta&amp;#94;Tx&amp;#94;{&amp;#40;i&amp;#41;}&amp;#41;&amp;#94;2$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;while loess minimizes:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$\sum&amp;#95;iw&amp;#94;{&amp;#40;i&amp;#41;}&amp;#40;y&amp;#94;{&amp;#40;i&amp;#41;}-\theta&amp;#94;Tx&amp;#94;{&amp;#40;i&amp;#41;}&amp;#41;&amp;#94;2$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;the trick is in the definition of the weight function.  As I understand it it the fit is made at the time of prediction, so x without a subscript in the below is the value of the feature &lt;em&gt;for which you're trying to predict the output&lt;/em&gt; (and that's why you have to keep your training data around even after training, as Ng noted earlier. Do you even train at all in advance? Maybe there's some optimization trick that allows you to pre-train something? Kinda doubting it from the &quot;not even a model&quot; chat above.).  So with that preamble, the weight function is &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$w&amp;#94;{&amp;#40;i&amp;#41;}=e&amp;#94;{&amp;#40;-\frac{&amp;#40;x&amp;#94;{&amp;#40;i&amp;#41;}-x&amp;#41;&amp;#94;2}{2}&amp;#41;}$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Actually, he said there are lots of possible weight functions, but the point is to have something that gets close to zero when &lt;code&gt;$x&amp;#94;{&amp;#40;i&amp;#41;}$&lt;/code&gt; is far from x and close to 1 when they're close together.  Which, obviously, this satisfies.&lt;/p&gt;&lt;p&gt;A more common form of the weight is&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$w&amp;#94;{&amp;#40;i&amp;#41;}=e&amp;#94;{&amp;#40;-\frac{&amp;#40;x&amp;#94;{&amp;#40;i&amp;#41;}-x&amp;#41;&amp;#94;2}{2\tau&amp;#94;2}&amp;#41;}$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;where tau is a &quot;bandwidth parameter&quot; that controls the rate at which the weighting function falls off with distance from x.&lt;/p&gt;&lt;p&gt;Another student question: this is indeed very costly, &quot;every time you make a prediction you need to fit theta to your entire training set again.&quot; However, &quot;turns out there are ways to make this much more efficient.&quot; He referred to &lt;a href='http://www.ri.cmu.edu/pub_files/pub1/moore_andrew_1991_1/moore_andrew_1991_1.pdf'&gt;Andrew Moore's kd-trees&lt;/a&gt; as this method.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;probabilistic&amp;#95;interpretation&amp;#95;of&amp;#95;linear&amp;#95;regression&quot;&gt;&lt;/a&gt;Probabilistic interpretation of linear regression&lt;/h3&gt;&lt;p&gt;Why are we minimizing the sum of squared error as opposed to the absolute value or something? Assumptions that make this work. (Oh boy, are we going to do BLUE again?  Might skim past this.)&lt;/p&gt;&lt;p&gt;First we &quot;endow the least squares model with probabilistic semantics.&quot;&lt;/p&gt;&lt;p&gt;Yeah, this is the same stuff.  Assume y is a function of the model plus error, assume error is IID and distributed normally with mean zero, all the good social science stats stuff I already know. Then we do the standard probability and algebra and get the maximum likelihood estimator, which turns out to be the OLS cost function.  And that was like a whole class in grad school. The central limit theorem came up, as it does. All the good stuff. For his derivation, see pages 11-13 of &lt;a href='https://see.stanford.edu/materials/aimlcs229/cs229-notes1.pdf'&gt;lecture notes 1&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;There is one useful notation note though.  Semicolon indicates not a random variable but as something we're trying to estimate in the world, i.e. this: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$P&amp;#40;y&amp;#94;{&amp;#40;i&amp;#41;}|x&amp;#94;{&amp;#40;i&amp;#41;};\theta&amp;#41;$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;indicates &quot;the probability of &lt;code&gt;$y&amp;#94;{&amp;#40;i&amp;#41;}$&lt;/code&gt; conditioned on &lt;code&gt;$x&amp;#94;{&amp;#40;i&amp;#41;}$&lt;/code&gt;  as parameterized by &lt;code&gt;$\theta$&lt;/code&gt; &quot; while this:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$P&amp;#40;y&amp;#94;{&amp;#40;i&amp;#41;}|x&amp;#94;{&amp;#40;i&amp;#41;},\theta&amp;#41;$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;means &quot;the probability of &lt;code&gt;$y&amp;#94;{&amp;#40;i&amp;#41;}$&lt;/code&gt; conditioned on &lt;code&gt;$x&amp;#94;{&amp;#40;i&amp;#41;}$&lt;/code&gt; and &lt;code&gt;$\theta$&lt;/code&gt; &quot; which is wrong, because theta isn't a random variable, it's a property of the world we're trying to estimate (in frequentist terms).&lt;/p&gt;&lt;p&gt;The conditional probability (the correct one) = the likelihood function, only y gets an arrow (to indicate it's observed?). So maximum likelihood.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;classification&quot;&gt;&lt;/a&gt;Classification&lt;/h3&gt;&lt;p&gt;Started off with standard stuff, instead of choosing a linear function, we choose a nonlinear function.  And for logistic regression, that's the sigmoid function, a.k.a. the logistic function: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$h&amp;#95;\theta&amp;#40;x&amp;#41; = \frac{1}{1 + e&amp;#94;{-\theta&amp;#94;Tx}}$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;One important point is that for logistic gradient descent we're actually ascending, that is, we're trying to maximize not minimize, so we add the gradient rather than subtract it.&lt;/p&gt;&lt;p&gt;Interestingly, it comes out to the same update rule with the sign swapped when the dust settles. It's not the same math because the function that generates the hypothesis is obviously different (the linear function vs the logistic function), but it has the same functional form.  Logistic gradient ascent update rule:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;nohighlight&quot;&gt; $$\theta&amp;#95;j : = \theta&amp;#95;j + \alpha &amp;#40;y&amp;#94;{&amp;#40;i&amp;#41;} - h&amp;#95;{\theta}&amp;#40;x&amp;#94;{&amp;#40;i&amp;#41;}&amp;#41;&amp;#41; \cdot x&amp;#95;j&amp;#94;{&amp;#40;i&amp;#41;}$$ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Why does maximizing this work exactly?  It's just maximum likelihood again.  It turns out that for OLS, maximizing the likelihood function, after the math dust settles, is the same as minimizing the least squares cost function. (See notes pg. 13) But for logistic regression, when we &lt;em&gt;maximize&lt;/em&gt; the log likelihood of the parameters, the gradient ascent that we use to directly maximize the likelihood just simplifies to the same form. &lt;/p&gt;&lt;p&gt;(An explanation of why turned up elsewhere: logistic regression likelihood is concave. page 11 of &lt;a href='https://courses.cs.washington.edu/courses/cse547/16sp/slides/logistic-SGD.pdf'&gt;this&lt;/a&gt;)&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;digression&amp;#95;on&amp;#95;perceptrons&quot;&gt;&lt;/a&gt;digression on perceptrons&lt;/h3&gt;&lt;p&gt;a perceptron is just the same update rule but with this threshold function that maps positive values to 1 and negative values to 0 rather than logistic function's mapping of everything to the space from 0-1. &lt;/p&gt;&lt;p&gt;Hard to interpret perceptrons probabilistically though.&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Fri, 07 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/game-as-tree/
</guid>
<link>
http://paultopia.github.io/posts-output/game-as-tree/
</link>
<title>
Translating Game Theory Backward Induction into a Tree Algorithm
</title>
<description>
&lt;p&gt;I know a lot more about game theory than I do about graphs/trees/etc. (Political scientist, yo.) So here's an attempt at a translation of the idea of backwards induction into tree terms. &lt;/p&gt;&lt;p&gt;First, intuition/background: backwards induction is a method for finding subgame perfect equilibria of a sequential game in extensive form. (For simplicity, let's assume a perfect information game.) The short version is that, starting at the terminal node, you set the last player's choice for that node as the choice that yields the best they can achieve given the history of play leading up to that node. With that information, you now know the values for each choice of the second-to-last node for the second-to-last player, so set their choice to that. And so on, inductively. &lt;/p&gt;&lt;p&gt;This is pretty easily represented in code terms. An extensive form game is just a &lt;a href='https://stackoverflow.com/questions/7423401/whats-the-difference-between-the-data-structure-tree-and-graph'&gt;tree&lt;/a&gt;. So you can represent your extensive form game as a tree of depth n (I don't know if &quot;depth&quot; is a term of art for trees, but I mean that a lone node has depth 1, a parent with children that have no children themselves id depth 2, and so forth), such that the first choice is the root node, then its children are the paths from that decision, so forth.  So then you can just take the nodes at depth n-1 and replace them by the max of their children, and keep doing that until you reach the top node. Obviously, you also need to keep a bit of state somewhere that builds up the path through the tree, and there you go, you have your equilibrium. &lt;/p&gt;&lt;p&gt;The cool thing is that when you get backward induction, the idea generalizes to other kinds of problems. For example, there's a project Euler problem that asks you to find the maximum value path from top to bottom of a pyramid of numbers that maximizes the sum of the numbers in that path.  Something like this: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;    4
   5 9
  7 9 5
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;where the answer would be 22 (4-9-9).  Only, you know, much bigger.&lt;/p&gt;&lt;p&gt;When you realize that this is just a tree with the same kind of maximization problem, backwards induction is the obvious solution. Taking the n-1th row, each element can either terminate in the element to its below-left or its below-right; since you want to find the max, you can just update the elements in the n-1th row by the max of what it can terminate in. Then you can forget about the nth row and treat the n-1th row as the terminal row. Then apply the same procedure to update the n-2th row, and so on.&lt;/p&gt;&lt;p&gt;So, in the toy example above, the first round of updating looks like this: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;    4
  14 18
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;that is, 5 becomes &lt;code&gt;5 + max&amp;#40;7, 9&amp;#41;&lt;/code&gt;, 9 becomes &lt;code&gt;9 + max&amp;#40;9, 5&amp;#41;&lt;/code&gt; and so forth.&lt;/p&gt;&lt;p&gt;In python:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;with open&amp;#40;&amp;quot;pyramid.txt&amp;quot;&amp;#41; as tf:
    pyramid&amp;#95;pre = tf.readlines&amp;#40;&amp;#41;

pyramid = &amp;#91;map &amp;#40;int, x.split&amp;#40;&amp;quot; &amp;quot;&amp;#41;&amp;#41; for x in pyramid&amp;#95;pre&amp;#93;

def update&amp;#95;values&amp;#40;pyramid&amp;#41;:
    lastrow = len&amp;#40;pyramid&amp;#41; - 2
    for x in range&amp;#40;lastrow, -1, -1&amp;#41;:
        row&amp;#95;length = x + 1
        for y in range&amp;#40;row&amp;#95;length&amp;#41;:
            pyramid&amp;#91;x&amp;#93;&amp;#91;y&amp;#93; = pyramid&amp;#91;x&amp;#93;&amp;#91;y&amp;#93; + max&amp;#40;pyramid&amp;#91;x + 1&amp;#93;&amp;#91;y&amp;#93;, pyramid&amp;#91;x + 1&amp;#93;&amp;#91;y + 1&amp;#93;&amp;#41;
    return pyramid&amp;#91;0&amp;#93;&amp;#91;0&amp;#93;

print&amp;#40;update&amp;#95;values&amp;#40;pyramid&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I assume there's a standard tree-traversal algorithm that CS people use for this kind of problem, curious whether it looks like the game theorist's backward induction or there's a better way.  But this way does the job!&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Thu, 06 Jul 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/flexbox-iconbar/
</guid>
<link>
http://paultopia.github.io/posts-output/flexbox-iconbar/
</link>
<title>
A Flexbox Trick for Responsive Icon Screens
</title>
<description>
&lt;p&gt;Here's a trick I just cooked up (well, it's probably widely known by, like, everyone on earth who regularly does css stuff, but I just discovered it for me, so I'll take a tiny bit of credit.).&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Suppose you want to start off your site with an icon screen, like an iPhone or something.  (I'm actually basing the design of my new website, in progress, on the old Palm Pilot home screen.  Though I just moved away from the green, so maybe not anymore.)&lt;/p&gt;&lt;p&gt;Some devices have fairly wide screens, others have narrow but relatively long screens. If you have, say, six icons, it would be nice to be able to lay that out in two rows of 3 icons each on wide screens, and three rows of two icons each on narrow screens (like smartphones).&lt;/p&gt;&lt;p&gt;With flexbox you can do that, by setting up two layers of flex, and switching the direction within the layers.&lt;/p&gt;&lt;p&gt;Here's how.  First, create an outer div, and then break up your icons (or whatever elements) into equally sized inner containers. Like this:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;html&quot;&gt;
&amp;lt;div class=&amp;quot;outercontainer&amp;quot;&amp;gt;

&amp;lt;div class=&amp;quot;innercontainer&amp;quot;&amp;gt;
&amp;lt;img src=&amp;quot;icon1&amp;quot;&amp;gt;
&amp;lt;img src=&amp;quot;icon2&amp;quot;&amp;gt;
&amp;lt;/div&amp;gt;

&amp;lt;div class=&amp;quot;innercontainer&amp;quot;&amp;gt;
&amp;lt;img src=&amp;quot;icon3&amp;quot;&amp;gt;
&amp;lt;img src=&amp;quot;icon4&amp;quot;&amp;gt;
&amp;lt;/div&amp;gt;

&amp;lt;div class=&amp;quot;innercontainer&amp;quot;&amp;gt;
&amp;lt;img src=&amp;quot;icon5&amp;quot;&amp;gt;
&amp;lt;img src=&amp;quot;icon6&amp;quot;&amp;gt;
&amp;lt;/div&amp;gt;


&amp;lt;/div&amp;gt;

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then with your CSS, you'll set a breakpoint for small screens and a breakpoint for bigger screens, and in them, you'll switch the directions of the flex on the outer and the inner containers, as follows:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;css&quot;&gt;
.outercontainer {
    display: flex;
    justify-content: space-around;
    align-items: stretch;
}

.bigsubcontainer {
    display: flex;
    justify-content: space-around;
    align-items: stretch;
}

/&amp;#42; wide screens &amp;#42;/

@media &amp;#40;min-width: 700px&amp;#41; {

    .outercontainer {
        flex-direction: row;
    }

    .bigsubcontainer {
        flex-direction: column;
    }
}

/&amp;#42; narrow screens &amp;#42;/

@media &amp;#40;max-width: 700px&amp;#41; {

    .outercontainer {
        flex-direction: column;
    }

    .innercontainer {
        flex-direction: row;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;How does this magic work?  Well, the wide screen media query says &quot;hey outer flexbox container, treat your children as columns.&quot; Since there are three children to the outer flexbox container, there are three columns.  Then it says &quot;hey inner flexbox container, treat your children as rows.&quot;  Since each inner flexbox container has two children, it means there will be two rows. And vice versa for the narrow-screen media query. &lt;/p&gt;&lt;p&gt;The result: &lt;/p&gt;&lt;p&gt;&lt;img src=&quot;/img/little-flexbox.png&quot; alt=&quot;Little Screen&quot; /&gt;&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;/img/big-flexbox.png&quot; alt=&quot;Big Screen&quot; /&gt;&lt;/p&gt;&lt;p&gt;Complete control over the number of elements that appear in each row, with only a couple lines of code!&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Sat, 17 Jun 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/mustache-latex/
</guid>
<link>
http://paultopia.github.io/posts-output/mustache-latex/
</link>
<title>
How to Make Mustache.js Templates Play Nice with LaTeX
</title>
<description>
&lt;p&gt;I'm trying to achieve the holy grail and have a LaTeX cv that gets automatically updated from JSON, like &lt;a href='https://jsonresume.org/'&gt;Jsonresume&lt;/a&gt;, only with my own custom fields appropriate for someone who does the wild variety of things I do. I'm terrible at LaTeX, but there are plenty of templates floating around, and there's a great new project, &lt;a href='https://latexresu.me/'&gt;Latexresu.me&lt;/a&gt;, that appeared on show HN recently&amp;mdash;it's awesome, try it&amp;mdash;and I just used it to shamelessly steal some stubs to build from.&lt;/p&gt;&lt;p&gt;This is part of an overall website overhaul for me: I'm building an entirely new personal website using &lt;a href='https://vuejs.org'&gt;Vue&lt;/a&gt; that will allow people to do things like generate bibibtex or ris entries for my publications, etc.&amp;mdash;basically all kinds of technological overkill for what most people use a static site for. All client-side rendering, even binary files shoved into the webpack bundle as data URIs, all that ridiculousness. &lt;/p&gt;&lt;p&gt;So, since I'm deep into javascript-land anyway, I decided to template the .tex file using &lt;a href='https://www.npmjs.com/package/mustache'&gt;Mustache.js&lt;/a&gt; and compile it with &lt;a href='https://www.npmjs.com/package/node-latex'&gt;Node-Latex&lt;/a&gt;. &lt;/p&gt;&lt;p&gt;It turns out, however, that Mustache does HTML-escaping on every string passed into it. For example, the string &lt;code&gt;foo/bar&lt;/code&gt; in the JSON data that I'm trying to use to build my cv gets mangled into &lt;code&gt;foo&amp;amp;#x2F;bar&lt;/code&gt; in the template. And this is, alas, totally unacceptable because &lt;code&gt;&amp;amp;&lt;/code&gt; is a &lt;a href='https://tex.stackexchange.com/questions/34580/escape-character-in-latex'&gt;reserved character&lt;/a&gt; in LaTeX.&lt;/p&gt;&lt;p&gt;The Mustache docs aren't terribly helpful on the subject. They give two ways to unescape strings, both of which are very inconvenient here: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;Use a &quot;triple Mustache&quot; &amp;mdash; i.e. &lt;code&gt;{{{foo}}}&lt;/code&gt;.  The problem is that if you're templating LaTeX, this isn't going to do a lot of good, because if you're in your right mind at all, you'll have created a custom delimiter, so as to not be forced to distingish between LaTeX curly brackets and Mustache curly brackets.  And there isn't a documented way to change what characters count as a triple mustache (though maybe you can?).&lt;/li&gt;&lt;li&gt;Add an ampersand before the string you want to unescape&amp;mdash; i.e. &lt;code&gt;{{&amp;amp;foo}}&lt;/code&gt;.  This plays nicely with custom delimiters, but has the inconvenient result of forcing you to manually unescape every single string you put in the template&amp;mdash;since if you're templating LaTeX, rather than HTML, chances are that you won't want to escape &lt;em&gt;anything&lt;/em&gt;.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Fortunately, there's an undocumented solution.  After digging through &lt;a href='https://github.com/janl/mustache.js/issues/244'&gt;some&lt;/a&gt; &lt;a href='https://github.com/janl/mustache.js/issues/307'&gt;issues&lt;/a&gt; with people complaining about this behavior, it turns out that someone kindly decided &lt;a href='https://github.com/janl/mustache.js/blob/master/mustache.js#L622'&gt;expose the function used to escape HTML to users&lt;/a&gt;, so that you can just override it in client code. &lt;/p&gt;&lt;p&gt;Since this isn't really documented anywhere, and since even the issues don't make clear how to use the fix that was eventually proposed and accepted (the proposed fix had user code modifying &lt;code&gt;Mustache.escapeHTML&lt;/code&gt;, but user code actually needs to modify &lt;code&gt;Mustache.escape&lt;/code&gt;), here's a quick example of how to sensibly use Mustache.js with LaTeX.&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;javascript&quot;&gt;const latex = require&amp;#40;'node-latex'&amp;#41;;
const fs = require&amp;#40;'fs'&amp;#41;;
const Mustache = require&amp;#40;'mustache'&amp;#41;;

// First, let's change the delimiter so that we can use &amp;lt;&amp;lt;foo&amp;gt;&amp;gt; instead of {{foo}} in LaTeX documents.

Mustache.tags = &amp;#91; '&amp;lt;&amp;lt;', '&amp;gt;&amp;gt;' &amp;#93;;

// Here's the fix! A simple function to override the escape function provided by Mustache.

Mustache.escape = text =&amp;gt; text;

// The greeting would blow up LaTeX rendering if escaped, but now that we've overridden the escape, it will work just fine.
const data = {greeting: &amp;quot;Hello/World&amp;quot;};

const template = &amp;quot;\\documentclass{article}\ \n \\begin{document} \n &amp;lt;&amp;lt;greeting&amp;gt;&amp;gt; \n \\end{document} &amp;quot;;
const input = Mustache.render&amp;#40;template, data&amp;#41;;
const output = fs.createWriteStream&amp;#40;'hello-tex.pdf'&amp;#41;;

latex&amp;#40;input&amp;#41;.pipe&amp;#40;output&amp;#41;;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That will just get rid of HTML encoding.  But you're not quite done yet, if you want to use LaTeX.  What if the text you want to put into the template itself has LaTeX reserved characters?&lt;/p&gt;&lt;p&gt;Here's a more robust fix.  Instead of &lt;code&gt;Mustache.escape = text =&amp;gt; text;&lt;/code&gt; in the above, you can set the escape function to something that escapes LaTeX reserved characters. I've defined a &lt;code&gt;latexEscaper&lt;/code&gt; below that can be dropped right in.:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;javascript&quot;&gt;var matches = new Map&amp;#40;&amp;#91;&amp;#91;&amp;quot;\\&amp;quot;, &amp;quot;textbackslash&amp;quot;&amp;#93;,
                       &amp;#91;&amp;quot;&amp;#126;&amp;quot;,&amp;quot;textasciitilde&amp;quot;&amp;#93;,
                       &amp;#91;&amp;quot;&amp;#94;&amp;quot;,&amp;quot;textasciicircum&amp;quot;&amp;#93;&amp;#93;&amp;#41;;

var messytext = &amp;quot;I shouldn't be escaped / \n I should be: $ \n and I should be a special LaTeX command: &amp;#94;&amp;quot;

function latexEscaper&amp;#40;text&amp;#41;{
		return text.replace&amp;#40;/&amp;#91;\\&amp;#126;\&amp;#94;%&amp;amp;$#&amp;#95;{}&amp;#93;/g, 
                    match =&amp;gt; &amp;quot;\\&amp;quot; +  &amp;#40;matches.get&amp;#40;match&amp;#41; || match&amp;#41;&amp;#41;;}
		console.log&amp;#40;latexEscaper&amp;#40;messytext&amp;#41;&amp;#41;;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And then your template should produce valid LaTeX, or at least as valid as LaTeX ever is...&lt;/p&gt;&lt;p&gt;Now, if you'll excuse me, I think I go need to do a PR to turn this from undocumented into documented...&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Sun, 11 Jun 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/python-r-textmining/
</guid>
<link>
http://paultopia.github.io/posts-output/python-r-textmining/
</link>
<title>
Python and R Resources for text-mining
</title>
<description>
 &lt;p&gt;This is just a growing collection of useful Python and R packages and resources for text-mining. It's the flavor of ML I'm working on the most, so this is mostly just for my own hassle-avoidance.   &lt;/p&gt;&lt;p&gt;Work in progress.  &lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;python&quot;&gt;&lt;/a&gt;Python&lt;/h1&gt; &lt;h2&gt;&lt;a name=&quot;libraries&quot;&gt;&lt;/a&gt;Libraries&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href='http://www.nltk.org'&gt;NLTK&lt;/a&gt; &amp;mdash; the 1000-pound gorilla here.&lt;/li&gt;&lt;li&gt;&lt;a href='https://radimrehurek.com/gensim/'&gt;Gensim&lt;/a&gt; &amp;mdash; very frequently used topic modeling library, also has word2vec wrapper that seems to get a lot of usage.&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.christianpeccei.com/textmining/'&gt;Textmining&lt;/a&gt; &amp;ndash; a very small library that creates DTMs and stuff.  A nice alternative to wading through tons of NLTK documentation.&lt;/li&gt;&lt;li&gt;&lt;a href='https://spacy.io'&gt;spaCY&lt;/a&gt; &amp;mdash; NLTK alternative, I've not tried it.&lt;/li&gt;&lt;li&gt;&lt;a href='https://textblob.readthedocs.io/en/dev/'&gt;TextBlob&lt;/a&gt; &amp;mdash; not used it, but it looks to do a very significant subset of common text processing tasks with a relatively rational-looking API.&lt;/li&gt;&lt;li&gt;&lt;a href='https://www.crummy.com/software/BeautifulSoup/bs4/doc/'&gt;BeautifulSoup&lt;/a&gt; &amp;mdash; the standard python library for getting your texts out of web pages (agonizingly complicated API, but, then again, that's probably the DOM's fault). Incidentally, you should really be using &lt;a href='http://docs.python-requests.org/en/master/'&gt;requests&lt;/a&gt; to actually send http requests for scraping.&lt;/li&gt;&lt;li&gt;&lt;a href='https://scrapy.org'&gt;Scrapy&lt;/a&gt; &amp;mdash; another important Python webscraping tool, I've actually never used it.&lt;/li&gt;&lt;li&gt;&lt;a href='https://github.com/amueller/word_cloud'&gt;wordcloud&lt;/a&gt; &amp;mdash; word clouds are always fun.  Kinda useless, but fun.&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.clips.ua.ac.be/pattern'&gt;Pattern&lt;/a&gt; &amp;mdash; a library that combines web-scraping with some standard NLP tools.&lt;/li&gt;&lt;li&gt;&lt;a href='https://stanfordnlp.github.io/CoreNLP/other-languages.html#python'&gt;CoreNLP Wrappers&lt;/a&gt; Python wrappers for Stanford Core NLP.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;a name=&quot;publications,&amp;#95;tutorials,&amp;#95;etc.&quot;&gt;&lt;/a&gt;Publications, Tutorials, etc.&lt;/h2&gt;&lt;p&gt;(to be added)  &lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;r&quot;&gt;&lt;/a&gt;R&lt;/h1&gt; &lt;h2&gt;&lt;a name=&quot;libraries&quot;&gt;&lt;/a&gt;Libraries&lt;/h2&gt;&lt;p&gt;&lt;a href='https://cran.r-project.org/web/packages/tm/index.html'&gt;TM&lt;/a&gt; &amp;mdash; The classic package, but I hate it like sin. On the other hand, its agonizingly horrible API is the source of my &lt;a href='https://stackoverflow.com/questions/24771165/r-project-no-applicable-method-for-meta-applied-to-an-object-of-class-charact/29529990#29529990'&gt;most-upvoted Stack Overflow answer&lt;/a&gt;, so, thanks?  This package and strings-as-factors together drove my abandonment of R for Python.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href='https://github.com/kbenoit/quanteda'&gt;Quanteda&lt;/a&gt; &amp;mdash; Ken Benoit's TM alternative.&lt;/li&gt;&lt;li&gt;&lt;a href='https://github.com/juliasilge/tidytext'&gt;tidytext&lt;/a&gt; &amp;mdash; I haven't used this yet, but given the authors (Robinson and Silge), it's probably amazing.&lt;/li&gt;&lt;li&gt;&lt;a href='https://github.com/ThomasK81/ToPan'&gt;ToPan&lt;/a&gt; &amp;mdash; a cool batteries included topic modeling Shiny app specifically designed for topic modeling in ancient languages.&lt;/li&gt;&lt;li&gt;&lt;a href='https://cran.r-project.org/web/packages/lda/index.html'&gt;LDA&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.structuraltopicmodel.com'&gt;Structural Topic Model&lt;/a&gt; &amp;ndash; Molly Roberts, Brandon Stewart and Dustin Tingley package widely used among political scientists.&lt;/li&gt;&lt;li&gt;&lt;a href='ftp://cran.r-project.org/pub/R/web/packages/topicmodels/vignettes/topicmodels.pdf'&gt;Topicmodels&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://cran.r-project.org/web/packages/wordcloud/'&gt;wordcloud&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://github.com/bmschmidt/wordVectors'&gt;WordVectors&lt;/a&gt; &amp;mdash; word2vec implementation.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;a name=&quot;publications,&amp;#95;tutorials,&amp;#95;etc.&quot;&gt;&lt;/a&gt;Publications, Tutorials, etc.&lt;/h2&gt; &lt;ul&gt;&lt;li&gt;&lt;a href='https://github.com/kbenoit/ITAUR'&gt;Introduction to Text Analysis Using R&lt;/a&gt; &amp;mdash; Benoit &lt;/li&gt;&lt;li&gt;&lt;a href='http://tidytextmining.com'&gt;Text Mining with R, A Tidy Approach&lt;/a&gt; &amp;mdash; Julia Silge and David Robinson, open web version of their book.&lt;/li&gt;&lt;li&gt;&lt;a href='https://eight2late.wordpress.com/2015/05/27/a-gentle-introduction-to-text-mining-using-r/'&gt;A gentle introduction to text mining using R&lt;/a&gt; &amp;mdash; Kailash Awati&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.dh.uni-leipzig.de/wo/topic-modelling-of-historical-languages-in-r/'&gt;Topic Modeling of Historical Languages in R&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt; 
</description>
<enclosure>

</enclosure>
<pubDate>
Thu, 08 Jun 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/react-in-reagent/
</guid>
<link>
http://paultopia.github.io/posts-output/react-in-reagent/
</link>
<title>
Use Someone Else's React Component in Reagent
</title>
<description>
&lt;p&gt;&lt;strong&gt;EDIT:&lt;/strong&gt; &lt;/p&gt;&lt;p&gt;I never finished this post, but actually managed to make a different strategy work. Post to be revised later, but example working code in &lt;a href='https://github.com/paultopia/datasheetexperiment'&gt;this repo&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;hr&gt;  &lt;/p&gt;&lt;p&gt;Today's quest: I have a bunch of &lt;a href='https://reagent-project.github.io/'&gt;reagent&lt;/a&gt; projects that involve displaying tabular data. Reagent, for those not in the cool kid club, is a clojurescript wrapper for React. I just learned, thanks to HN, about this awesome-looking new React library (do we call them libraries in react-land?  or just components?) to display a spreadsheet-like interface, &lt;a href='react-datasheet'&gt;https://github.com/nadbm/react-datasheet&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;The problem: I know jack-all about React, or indeed about Javascript beyond the basic semantics of the language.  I have zero investment in the React toolchain, or indeed the Javascript toolchain.  The only reason I use Reagent in CLJS is because I really like the deref-an-atom-to-update-UI model of state change. Not because I particularly want a virtual dom or anything like that. &lt;/p&gt;&lt;p&gt;And the Javascript toolchain is, frankly, nuts. Apparently it doesn't even come with a module system (maybe it does with the 2016 version, which sometimes gets called ES6 and sometimes get called ES2016, or maybe those are different things, who the hell knows? Or maybe there's also ES7, and something called Javascript Next, and what the fuck?  Stop it, Javascript, you're drunk.), so there are, like, &lt;a href='https://github.com/nadbm/react-datasheet'&gt;dozens of module systems&lt;/a&gt; and compilers and transpilers and apparently a package system built on Node that you still use even if you're not running your server on node and oh my god what? &lt;/p&gt;&lt;p&gt;Aside: I don't think it's a coincidence that the languages I like most, Clojure and Python, both have a strong BDFL-figure to keep things relatively sane. As much as people often disagree with their decisions, I take it that if people felt the need to produce dozens of totally different third-party solutions to a basic language feature like a module system, either Rich or Guido would quickly step in, bring the best one into the language, and the culture would quickly coalesce around people damn well using that. It's truly ridiculous that you can have &lt;code&gt;pip install foo&lt;/code&gt; and &lt;code&gt;import foo&lt;/code&gt; in Python, but that the latest version of Javascript apparently has a &lt;a href='http://exploringjs.com/es6/ch_modules.html'&gt;complex module loader API&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Ok, so anyway. I'm gonna try to do this thing. In roughly three steps: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;Get the Javascript bits into my project in a form that Clojurescript might be able to use.&lt;/li&gt;&lt;li&gt;Get Clojurescript to actually see the Javascript bits.&lt;/li&gt;&lt;li&gt;Get the Reagent bits of the Clojurescript bits talking to the React bits of the Javascript bits.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;I first tried the tutorial &lt;a href='http://blob.tomerweller.com/reagent-import-react-components-from-npm'&gt;here&lt;/a&gt;, which just puts everything into a NPM thingie, compiles it with webpack, and then excludes reagent, but I got a classic javascript-compilation-hates-you error in the webpack bundle.js (&quot;Uncaught TypeError: r is not a function&quot;), and I don't even begin to know how to debug that.  So screw it, doing it some other way.  That first fail is &lt;a href='https://github.com/paultopia/reactinreagent/commit/a8edc242652fbcfdb6545d7447133991bd7ca732'&gt;this commit&lt;/a&gt;, for folks following along at home.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;first&amp;#95;hurdle:&amp;#95;getting&amp;#95;the&amp;#95;library/component&quot;&gt;&lt;/a&gt;First Hurdle: Getting the library/component&lt;/h2&gt;&lt;p&gt;The docs for React-Datasheet assume that you have some kind of compilation process, presumably the normal compilation process for React, so all they do is tell you to install it via NPM. Needless to say, I'm not using NPM. &lt;/p&gt;&lt;p&gt;So let's start a new clojurescript project&amp;mdash;no point in breaking an existing project by doing this.  It'll live &lt;a href='here'&gt;https://github.com/paultopia/reactinreagent&lt;/a&gt;, in case you want to follow along.  And then I guess the basic strategy will be to write myself an entry-point in Javascript that just provides the component (class?  apparently &lt;a href='https://reactjsnews.com/composing-components'&gt;there's no difference&lt;/a&gt; between react components and react classes?), and then I can call my own JS from CLJS, and include that JS directly in my project and hopefully not need externs or something...&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Create cljs project using my favorite template: &lt;code&gt;lein new reagent-frontend reactinreagent&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Create a javascript project somewhere in the repo.  I don't want it to be on the classpath and compile a bunch of extra garbage in my clojurescript, so I'll just create a directory called &quot;reactstuff&quot; at the top level and put all my javascript in there. My hope is that after I sort out all the react stuff there'll just be a nice compiled/transpiled/javascript-magiced js file that I can dump into my cljs resources and treat like an external javascript library.&lt;/li&gt;&lt;/ol&gt;&lt;pre&gt;&lt;code&gt;mkdir reactstuff
cd reactstuff
npm install react-datasheet --save
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Not even gonna try to figure out what needs to happen to keep this stuff off github.  Don't care, no struggs.&lt;/p&gt;&lt;p&gt;well, that threw a truly astonishing number of warnings and errors: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;/Users/myuser
├── UNMET PEER DEPENDENCY react@&amp;#126;0.14.8 || &amp;#94;15.0.0
├── react-datasheet@1.2.2
└── UNMET PEER DEPENDENCY react-dom@&amp;#126;0.14.8 || &amp;#94;15.0.0

npm WARN enoent ENOENT: no such file or directory, open '/Users/pauliglot/package.json'
npm WARN react-datasheet@1.2.2 requires a peer of react@&amp;#126;0.14.8 || &amp;#94;15.0.0 but none was installed.
npm WARN react-datasheet@1.2.2 requires a peer of react-dom@&amp;#126;0.14.8 || &amp;#94;15.0.0 but none was installed.
npm WARN myuser No description
npm WARN myuser No repository field.
npm WARN myuser No README data
npm WARN myuser No license field.

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ok, so I guess I need to install lots of other stuff to make this happen?  I suppose installing all the react crap into this other directory won't pollute my clojurescript project, and hopefully it'll all come out right at the other end.  Let's pray.  (But now I definitely need to add this to the .gitignore). Let's see what happens.&lt;br /&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;npm install react --save

npm install react --save
npm WARN saveError ENOENT: no such file or directory, open '/Users/myuser/package.json'
/Users/myuser
├─┬ react@15.4.2
│ ├─┬ fbjs@0.8.12
│ │ ├── core-js@1.2.7
│ │ ├─┬ isomorphic-fetch@2.2.1
│ │ │ ├─┬ node-fetch@1.6.3
│ │ │ │ ├─┬ encoding@0.1.12
│ │ │ │ │ └── iconv-lite@0.4.15
│ │ │ │ └── is-stream@1.1.0
│ │ │ └── whatwg-fetch@2.0.3
│ │ ├─┬ promise@7.1.1
│ │ │ └── asap@2.0.5
│ │ ├── setimmediate@1.0.5
│ │ └── ua-parser-js@0.7.12
│ ├─┬ loose-envify@1.3.1
│ │ └── js-tokens@3.0.1
│ └── object-assign@4.1.1
└── UNMET PEER DEPENDENCY react-dom@&amp;#126;0.14.8 || &amp;#94;15.0.0

npm WARN enoent ENOENT: no such file or directory, open '/Users/myuser/package.json'
npm WARN react-datasheet@1.2.2 requires a peer of react-dom@&amp;#126;0.14.8 || &amp;#94;15.0.0 but none was installed.
npm WARN myuser No description
npm WARN myuser No repository field.
npm WARN myuser No README data
npm WARN myuser No license field.

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ok, so that ain't working.  Apparently I do need, like, an entire fucking react toolchain to use this component.  Let's see what the &lt;a href='https://facebook.github.io/react/docs/installation.html'&gt;react docs&lt;/a&gt; have to say about getting one, huh? &lt;/p&gt;&lt;p&gt;Ok, apparently I need to:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;npm init
npm install --save react react-dom
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;oh god, npm init is some silly walkthrough that asks you a bunch of questions to create a package.json.  save me?  I'm just taking all the defaults. &lt;/p&gt;&lt;p&gt;But ok!  Now it'll let me install the things, with only one warning: &lt;code&gt;npm WARN reactstuff@1.0.0 No repository field.&lt;/code&gt; &amp;mdash; and I'm perfectly happy with this warning, since I don't feel the need for NPM to know where my repo is.&lt;/p&gt;&lt;p&gt;So, next thing, I guess the default for npm.init was to create an entry point at index.js, so I'll do that. &lt;/p&gt;&lt;p&gt;Hmm.  I'm not actually sure where index.js goes in order to get this stuff to all compile. I guess I need to use webpack?  But how do I get webpack and the npm stuff to play together?  Here's &lt;a href='https://scotch.io/tutorials/setup-a-react-environment-using-webpack-and-babel'&gt;a really fucking long tutorial for that&lt;/a&gt;, jesus.&lt;/p&gt;&lt;p&gt;No.  This is a horrifying mess.  I'm not going to set up an entire javascript build system for this.  (forget callback hell, how about dependency and build system hell?)  Instead, I'm going to empty the directory and start again, this time using facebook's lazyperson tool, &lt;a href='https://github.com/facebookincubator/create-react-app'&gt;create-react-app&lt;/a&gt;. &lt;/p&gt;&lt;pre&gt;&lt;code&gt;cd ..
rm -rf reactstuff 
mkdir reactstuff
cd reactstuff 
npm install -g create-react-app
create-react-app godhelpme
cd godhelpme
npm install react-datasheet --save
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ok, so first thing I'm gonna do is try to get it going with pure javascript, with a placeholder file. &lt;/p&gt;&lt;p&gt;http://stackoverflow.com/questions/35489797/using-react-components-in-reagent#35734001&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Wed, 05 Apr 2017 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/backup-to-git/
</guid>
<link>
http://paultopia.github.io/posts-output/backup-to-git/
</link>
<title>
Backup Dropbox, iCloud, etc. to git
</title>
<description>
 &lt;p&gt;According to &lt;a href='http://stackoverflow.com/questions/1960799/using-git-and-dropbox-together-effectively'&gt;the Wisdom of the Internet&lt;/a&gt;, you shouldn't put git repos into Dropbox (at least not without doing too-fancy things like turning Dropbox itself into a git remote, which, no), because everything changes everything else in funny complex ways and things blow up.   &lt;/p&gt;&lt;p&gt;But if you're me, sometimes you store, like writing and such, a bunch of stuff in Dropbox (or in iCloud, where I imagine similar issues arise, or in Google Drive, or in Box, or even in bloody Microsoft's OneDrive monstrosity), and want to keep doing so because of nice things like automatic multiple-device syncronization. &lt;/p&gt;&lt;p&gt;But at the same time, you want version control. And you don't want to rely on Dropbox's opaque versioning system that you have to pay for and where the terms and the UI change all the time. You want GIT, damnit. &lt;/p&gt;&lt;p&gt;Why not just automatically copy all the files from the Dropbox/iCloud/whev folder to your git repo?  I wrote a quick python script to do so. You can get it &lt;a href='https://gist.github.com/paultopia/9b91a9ca00ed489d0d820e76d201dcca'&gt;from this gist&lt;/a&gt;.  Just stick it in a cron job or launchd or whatever.  I think I will have mine run every hour when the computer is on.&lt;/p&gt;&lt;p&gt;Now to figure out launchd on mac. &lt;a href='http://alvinalexander.com/mac-os-x/mac-osx-startup-crontab-launchd-jobs'&gt;Here's a tutorial&lt;/a&gt; some kind person wrote, let's see how this works...&lt;/p&gt;&lt;p&gt;(I suppose this would be more useful with a separate config file and the ability to pass multiple source directories, maybe even multiple target directories, but that's more work, and this is all I need, so, oh hey open source. :-) ...maybe later).&lt;/p&gt;&lt;p&gt;&lt;em&gt;Edit&lt;/em&gt;: figured out launchctl. That tutorial above is pretty good and has more details, but here are the basics. &lt;/p&gt;&lt;p&gt;First &lt;code&gt;cd $HOME/Library/LaunchAgents&lt;/code&gt;&lt;/p&gt;&lt;p&gt;Then create a plist file in funny apple format. Let's say your filename for the plist is &lt;code&gt;com.yourname.yourcommand.plist&lt;/code&gt;. And let's say your version of that python script is located at &lt;code&gt;/Users/yourname/github/yourfile/backup-to-git&lt;/code&gt;. And say you want it to run every hour.  Then this is your plist:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;!DOCTYPE plist PUBLIC &amp;quot;-//Apple//DTD PLIST 1.0//EN&amp;quot; &amp;quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&amp;quot;&amp;gt;
&amp;lt;plist version=&amp;quot;1.0&amp;quot;&amp;gt;
&amp;lt;dict&amp;gt;
  &amp;lt;key&amp;gt;Label&amp;lt;/key&amp;gt;
  &amp;lt;string&amp;gt;com.yourname.yourcommand&amp;lt;/string&amp;gt;
  &amp;lt;key&amp;gt;ProgramArguments&amp;lt;/key&amp;gt;
  &amp;lt;array&amp;gt;
    &amp;lt;string&amp;gt;/Users/yourname/github/yourfile/backup-to-git&amp;lt;/string&amp;gt;
  &amp;lt;/array&amp;gt;
  &amp;lt;key&amp;gt;StartInterval&amp;lt;/key&amp;gt;
  &amp;lt;integer&amp;gt;3600&amp;lt;/integer&amp;gt;
  &amp;lt;key&amp;gt;RunAtLoad&amp;lt;/key&amp;gt;
  &amp;lt;true/&amp;gt;
&amp;lt;/dict&amp;gt;
&amp;lt;/plist&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note that the StartInterval value is the number of seconds between runs. &lt;/p&gt;&lt;p&gt;Then to get it going without reboot, run &lt;code&gt;launchctl load com.yourname.yourcommand.plist&lt;/code&gt; (and replace load with unload to stop it).&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Supposedly this will continue working after reboot too. I have faith.&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Thu, 12 Jan 2017 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/anti-homebrew/
</guid>
<link>
http://paultopia.github.io/posts-output/anti-homebrew/
</link>
<title>
Starting to distrust Homebrew...
</title>
<description>
  &lt;p&gt;Is it just me, or has Homebrew been getting super-bossy recently about how you run your machine?&lt;br /&gt;  &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;round&amp;#95;1:&amp;#95;update&amp;#95;xcode&amp;#95;you&amp;#95;must,&amp;#95;padawan...&quot;&gt;&lt;/a&gt;Round 1: Update XCode you must, padawan...&lt;/h2&gt;&lt;p&gt;The problems started with &lt;a href='https://github.com/Homebrew/brew/issues/1131'&gt;this issue I filed&lt;/a&gt;. The story behind that issue is this: I upgraded my machine to Sierra, and brew immediately started throwing a fatal error. It wouldn't allow any use of brew at all unless one's XCode is updated to at least the latest version.   &lt;/p&gt;&lt;p&gt;Now, that's a problem, for several reasons. First, XCode is a massive, multi-gigabyte, failure-prone download that can take days to actually get if you live, as I do, in the rural Midwest with a corrupt internet service oligopoly. I'm convinced that installation the first time around actually crashed my SSD.  &lt;/p&gt;&lt;p&gt;Second, it turns out, after discussion in that thread, that XCode &lt;em&gt;isn't actually a dependency&lt;/em&gt; for the vast majority of Homebrew packages. So this forced multi-gigabyte constantly breaking download is for a tiny handful of packages. &lt;/p&gt;&lt;p&gt;This forced upgrade only applies if you actually have XCode on your system. So the maintainers of actually decided that their users are to have exactly two choices: have no XCode at all, or have the latest version.  And they made that decision based on a dependency that only applies to a small percentage of their packages (which, of course, aren't disclosed in any place I can find). &lt;/p&gt;&lt;p&gt;Ok, so that was really annoying.  But, ultimately, Homebrew is just a bunch of Ruby scripts. And while I've never written a line of Ruby in my life, it's pretty easy to read, and I do know Python, which is close enough.  So I went digging. &lt;/p&gt;&lt;p&gt;I found the file where this behavior is specified. And with a one-line edit to convince Homebrew into thinking that the current installed version of XCode is the installed version (all described in that issue linked at the top), all was well again. For a while.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;round&amp;#95;2:&amp;#95;update&amp;#95;homebrew&amp;#95;you&amp;#95;must,&amp;#95;young&amp;#95;sith...&quot;&gt;&lt;/a&gt;Round 2: Update Homebrew you must, young Sith...&lt;/h2&gt;&lt;p&gt;Fast forward a few weeks. I did install XCode 8, which surprisingly worked. And I went to upgrade a package. Oops, homebrew now wants XCode 8.1.  And I don't have time to download more endless gigs in order to upgrade a like 5mb package. So I head on over to /usr/local/Homebrew/Library/Homebrew/os/mac/xcode.rb, fire up vim, and edit the script again in order to convince brew that XCode 8 is the latest version.  Then I re-run my command. &lt;/p&gt;&lt;p&gt;&lt;em&gt;!&lt;sup&gt;%$!!&lt;/sup&gt;&lt;sup&gt;$&amp;%&lt;/sup&gt; WTF? It's still throwing an XCode version error?&lt;/em&gt;  Yep, now it turns out that Homebrew auto-updates itself &lt;em&gt;every time you use it,&lt;/em&gt; as the first task, and then the auto-updating overwrites the changes I made to the XCode version file. &lt;/p&gt;&lt;p&gt;&quot;Ok, fine, this is an easy fix,&quot; I think.  &quot;I'll just set xcode.rb to be not writable.&quot; &lt;/p&gt;&lt;p&gt;&lt;em&gt;!&lt;sup&gt;%$!!&lt;/sup&gt;&lt;sup&gt;$&amp;%&lt;/sup&gt; WTF? It's still throwing an XCode version error?!!?&lt;/em&gt;  Go back, check xcode.rb, and discover the write bit has been set again. Brew ever-so-helpfully elevated its own permissions in order to boss me around. &lt;/p&gt;&lt;p&gt;&quot;Ok, a little bit harder of a fix,&quot; I think. &quot;I'll just change the owner too.  Try and change files owned by root, I dare you.&quot; &lt;/p&gt;&lt;p&gt;&lt;em&gt;GARGHHG!!!  STILL THROWING THE XCODE ERROR!&lt;/em&gt; And the ownership has been changed back. (I always thought &lt;a href='https://github.com/Homebrew/brew/blob/master/docs/FAQ.md#why-does-homebrew-say-sudo-is-bad-'&gt;part of the goddamn point of Homebrew was that it didn't need root privs to run it&lt;/a&gt;? And indeed, &lt;a href='https://github.com/Homebrew/brew/pull/1452'&gt;it supposedly can't even be run as root&lt;/a&gt;. But yet it seems to magically help itself to quite privileged behavior when it wants to force update itself without the user's consent.)&lt;/p&gt;&lt;p&gt;This seems &lt;em&gt;really&lt;/em&gt; problematic. Users don't get to choose to use an older version of the tool anymore? And don't get to restrict its behavior at all? This strikes me as a major security problem.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;round&amp;#95;3:&amp;#95;package&amp;#95;management,&amp;#95;except&amp;#95;when&amp;#95;it&amp;#95;doesn't.&quot;&gt;&lt;/a&gt;Round 3: package management, except when it doesn't.&lt;/h2&gt;&lt;p&gt;Fast forward a few more weeks. So today, I decided to try ProjectLibre. It has a Homebrew cask, so let's live dangerously.  First, I decided to look in on my currently installed casks with &lt;code&gt;brew cask list&lt;/code&gt;.  Here's what I get:   &lt;/p&gt;&lt;blockquote&gt;&lt;p&gt; Warning: The default Caskroom location has moved to /usr/local/Caskroom. &lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;Please migrate your Casks to the new location and delete /opt/homebrew-cask/Caskroom, or if you would like to keep your Caskroom at /opt/homebrew-cask/Caskroom, add the following to your HOMEBREW&lt;i&gt;CASK&lt;/i&gt;OPTS: &lt;/p&gt;&lt;p&gt;  &amp;ndash;caskroom=/opt/homebrew-cask/Caskroom &lt;/p&gt;&lt;p&gt;For more details on each of those options, see https://github.com/caskroom/homebrew-cask/issues/21913. beaker                                                       java                                                         xquartz &lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Ok, what's this?  First of all, I don't even remember installing Java via brew, but maybe I did. It would have made sense, given how &lt;a href='http://opensource.stackexchange.com/a/1422'&gt;terrifying&lt;/a&gt; Oracle &lt;a href='http://www.theregister.co.uk/2016/12/16/oracle_targets_java_users_non_compliance'&gt;is being&lt;/a&gt; about Java, and the damn near impossibility even for a &lt;a href='http://paul-gowder.com/'&gt;&lt;em&gt;actual lawyer&lt;/em&gt;&lt;/a&gt; of figuring out from the &lt;a href='http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html'&gt;java download page&lt;/a&gt; which version of what I'm downloading and what contracts I'm agreeing to by doing so.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Looking at &lt;a href='https://github.com/caskroom/homebrew-cask/issues/21913'&gt;the noted github issue&lt;/a&gt;, there is, no explanation of this change. But there is new information: apparently migrating your casks to the new location, as suggested by the warning, isn't so easy as all that. If you installed your packages &lt;em&gt;after&lt;/em&gt; a commit that was apparently merged on May 31, 2016, then you're ok, you can just move the directory the casks are located in.  But if you installed anything before that, it's symlinked, and you have to manually uninstall and reinstall.&lt;/p&gt;&lt;p&gt;So apparently it wants me to delete the entire (200mb-ish) JDK and re-install it because the maintainers decided to change the location where packages were installed (&lt;em&gt;multiple times, recently&lt;/em&gt;, if you count the symlink change) and aren't willing to provide an automated migration solution, or set some option in an environment variable that will probably get deprecated (or just flat-out dropped) in the next version? Which, remember, you can't choose not to use, because now it force auto-updates.   &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;adding&amp;#95;privacy&amp;#95;violations&amp;#95;to&amp;#95;security&amp;#95;violations.&quot;&gt;&lt;/a&gt;Adding privacy violations to security violations.&lt;/h2&gt;&lt;p&gt;Also, Homebrew &lt;a href='https://chr4.org/blog/2016/04/26/homebrew-betrayed-us-all-to-google/'&gt;evidently tracks its users with google analytics&lt;/a&gt; as of April or thereabouts. And, this &lt;a href='https://www.reddit.com/r/programming/comments/4gj664/homebrew_enabled_tracking_with_google_analytics/'&gt;opt-out behavior isn't disclosed to users&lt;/a&gt;, and I only found out about it by poking through a Hacker News thread. (There's some suggestion that maybe it got disclosed eventually, in some update, but I don't remember seeing the disclosure...)&lt;/p&gt;&lt;p&gt;Valeri Karpov has some &lt;a href='http://thecodebarbarian.com/i-dont-want-to-hire-you-if-you-cant-reverse-a-binary-tree'&gt;strong words about Homebrew&lt;/a&gt;, and I confess, I'm starting to feel the same way. Maybe it's time to try to figure out how to migrate to Nix...&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Wed, 28 Dec 2016 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/destructuring/
</guid>
<link>
http://paultopia.github.io/posts-output/destructuring/
</link>
<title>
Clojure basics: destructuring
</title>
<description>
 &lt;p&gt;I think destructuring is one of the harder things for total beginners to handle in Clojure, because the syntax is just really terse. When you get used to it, it makes the code more readable, but at the beginning, it makes the code lots less readable.   &lt;/p&gt;&lt;p&gt;There are some good destructuring tutorials out there (listed at the end), but none with live code execution (and the ability for readers to play around and tweak stuff) via the magic of &lt;a href='https://github.com/viebel/klipse'&gt;klipse&lt;/a&gt;.  So here goes! &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;the&amp;#95;basic&amp;#95;idea&quot;&gt;&lt;/a&gt;The Basic Idea&lt;/h2&gt;&lt;p&gt;Destructuring is a way to concisely create local bindings from complex data structures. Here's an example.  Suppose you have a map, and you want to do something with it. &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def a-triangle {:base 5 :height 10}&amp;#41;
&amp;#40;defn area &amp;#91;triangle&amp;#93;
&amp;#40;let &amp;#91;b &amp;#40;:base triangle&amp;#41; h &amp;#40;:height triangle&amp;#41;&amp;#93;
&amp;#40;&amp;#42; b h 0.5&amp;#41;&amp;#41;&amp;#41;
&amp;#40;area a-triangle&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;But that's a lot of typing. Destructuring lets us do it smaller:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn des1-area &amp;#91;triangle&amp;#93;
&amp;#40;let &amp;#91;{b :base h :height} triangle&amp;#93;
&amp;#40;&amp;#42; b h 0.5&amp;#41;&amp;#41;&amp;#41;
&amp;#40;des1-area a-triangle&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The let assignment there is our first example of destructuring. It says &quot;pull the values at &lt;code&gt;:base&lt;/code&gt; and &lt;code&gt;:height&lt;/code&gt; from the map &lt;code&gt;triangle&lt;/code&gt;, then assign them to the local symbols &lt;code&gt;b&lt;/code&gt; and &lt;code&gt;h&lt;/code&gt;.&quot;&lt;/p&gt;&lt;p&gt;But this is still too much typing.  We don't even need a let binding at all, because we can destructure right in a function definition. &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn des2-area &amp;#91;{b :base h :height}&amp;#93;
&amp;#40;&amp;#42; b h 0.5&amp;#41;&amp;#41;
&amp;#40;des2-area a-triangle&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That's more like it! Note how this second example of destructuring is just like the first, except that you don't need to pass the local name of the map to it, because the function destructures it before it even gets a local binding. &lt;/p&gt;&lt;p&gt;If you just want to use the same names as in the underlying map, the &lt;code&gt;:keys&lt;/code&gt; option allows you to do so:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn des3-area &amp;#91;{:keys &amp;#91;base height&amp;#93;}&amp;#93;
&amp;#40;&amp;#42; base height 0.5&amp;#41;&amp;#41;
&amp;#40;des3-area a-triangle&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;There, the destructuring statement should be read as &quot;take the map that I'm going to pass into this function, and then give me the keys that are listed in the vector, and locally bind their values to the symbol-ized forms of their keys.&quot;&lt;/p&gt;&lt;p&gt;Sadly, the &lt;code&gt;:keys&lt;/code&gt; option doesn't appear to work with string keys. &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def string-triangle {&amp;quot;base&amp;quot; 5 &amp;quot;height&amp;quot; 10}&amp;#41;
&amp;#40;des3-area string-triangle&amp;#41;  ; :-&amp;#40;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;However, slightly more longwinded destructuring does:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn des4-area &amp;#91;{b &amp;quot;base&amp;quot; h &amp;quot;height&amp;quot;}&amp;#93;
&amp;#40;&amp;#42; b h 0.5&amp;#41;&amp;#41;
&amp;#40;des4-area string-triangle&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And there's a happy surprise: &lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn des5-area &amp;#91;{:strs &amp;#91;base height&amp;#93;}&amp;#93;
&amp;#40;&amp;#42; base height 0.5&amp;#41;&amp;#41;
&amp;#40;des5-area string-triangle&amp;#41;
 &lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;&lt;p&gt;That's right: &lt;code&gt;:strs&lt;/code&gt;:strings::&lt;code&gt;:keys&lt;/code&gt;::keywords.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;vectors&amp;#95;(and&amp;#95;other&amp;#95;sequential&amp;#95;data&amp;#95;structures)&amp;#95;too&quot;&gt;&lt;/a&gt;Vectors (and other sequential data structures) too&lt;/h3&gt;&lt;p&gt;Suppose you want to add the first two numbers from a vector of arbitrary size. Here's a simple non-destructurey way. &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn add-first-2 &amp;#91;v&amp;#93;
&amp;#40;+ &amp;#40;first v&amp;#41; &amp;#40;second v&amp;#41;&amp;#41;&amp;#41;
&amp;#40;add-first-2 &amp;#91;1 2 3 4&amp;#93;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With destructuring, you can just take pluck out variables in order from the vector. So our function becomes:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn add-first-2d &amp;#91;&amp;#91;a b&amp;#93;&amp;#93;
&amp;#40;+ a b&amp;#41;&amp;#41;
&amp;#40;add-first-2d &amp;#91;1 2 3 4&amp;#93;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;So what that destructuring form says is &quot;take the sequential data structure you're passing into this function, pluck out the first two elements, and locally bind them the to the symbols a and b&quot;&lt;/p&gt;&lt;p&gt;Suppose you want the first and the third?  Well, the convention is that you throw away an unused value with an underscore, so:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn add-first-and-third &amp;#91;&amp;#91;a &amp;#95; b&amp;#93;&amp;#93;
&amp;#40;+ a b&amp;#41;&amp;#41;
&amp;#40;add-first-and-third &amp;#91;1 2 3 4&amp;#93;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;By the way, I meant it when I said &quot;any sequence&quot;&amp;mdash;this includes strings, anything that can behave sequentially.&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;let &amp;#91;&amp;#91;fst &amp;#95; thrd&amp;#93; &amp;quot;bar&amp;quot;&amp;#93; &amp;#40;str fst thrd&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can even combine destructuring with the variable arguments &lt;code&gt;&amp;amp;&lt;/code&gt; trick to collect an indeterminate number of arguments into a list and then immediately destructure them. Though &lt;a href='https://stuartsierra.com/2015/06/01/clojure-donts-optional-arguments-with-varargs'&gt;Stuart Sierra says this is a bad idea&lt;/a&gt;.&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;defn add-first-and-third-uncollected &amp;#91;&amp;amp; &amp;#91;a &amp;#95; b&amp;#93;&amp;#93;
&amp;#40;+ a b&amp;#41;&amp;#41;
&amp;#40;add-first-and-third-uncollected 1 2 3 4&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note how this works even though the numbers aren't collected into a vector.  Incidentally, you can also use the fancy ampersand &lt;em&gt;within&lt;/em&gt; a destructuring statement to collect the tail of a sequence.&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;let &amp;#91;&amp;#91;v1 v2 &amp;amp; the-rest&amp;#93; &amp;#40;range 10&amp;#41;&amp;#93;
&amp;#91;v1 v2 &amp;#40;apply + the-rest&amp;#41;&amp;#93;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;While we're at it, let's look at nested data structures. First, we'll use the previous technique to make a vector with sequences in them. And, actually, let's learn a new technique in the process: you can also use &lt;code&gt;:as&lt;/code&gt; in any destructuring operation to bind the entire destructured data structure to a name.  So:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def nested &amp;#40;let &amp;#91;&amp;#91;v1 v2 &amp;amp; the-rest :as everything&amp;#93; &amp;#40;range 10&amp;#41;&amp;#93;
  &amp;#91;v1 v2 the-rest everything&amp;#93;&amp;#41;&amp;#41;
nested
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now let's grab... say... the 1 from the first two numbers, nothing from the first sequence and the 2 from the second sequence. &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;let &amp;#91;&amp;#91;&amp;#95; theone &amp;#95; &amp;#91;&amp;#95; &amp;#95; thetwo&amp;#93;&amp;#93; nested&amp;#93; &amp;#40;str theone thetwo&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That's a little obscure-looking, here's a clearer one, fetching the items at the same positions: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def nested2 &amp;#91;:a :b &amp;#91;:c :d&amp;#93; &amp;#91;:e :f :g&amp;#93;&amp;#93;&amp;#41;
&amp;#40;let &amp;#91;&amp;#91;&amp;#95; theone &amp;#95; &amp;#91;&amp;#95; &amp;#95; thetwo&amp;#93;&amp;#93; nested2&amp;#93; &amp;#40;str theone thetwo&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;So what you can see is that the inner vector in the let statement essentially said &quot;let's start destructuring!&quot;  And then from the first four values of the vector that we destructured (&lt;code&gt;:a:&lt;/code&gt; &lt;code&gt;:b&lt;/code&gt; and &lt;code&gt;&amp;#91;:c :d&amp;#93;&lt;/code&gt;) we took only the second&amp;mdash;so we threw out the first nested vector as a discard value. Then, continuing through the vector, we got to the second nested vector. Since we wanted to fetch something out of that, we put another inner vector in to say &quot;let's destructure this vector now.&quot; And then we grabbed the third item in there.&lt;/p&gt;&lt;p&gt;You can also go a little crazy with the nesting and get maps inside vectors, and so on and so on.  Here's something a little ridiculous...&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def ridiculous &amp;#91;&amp;quot;foo&amp;quot; {:bar &amp;quot;baz&amp;quot; :bat &amp;#91;1 2 3&amp;#93;}&amp;#93;&amp;#41;
&amp;#40;let &amp;#91;&amp;#91;&amp;#95; {&amp;#91;&amp;#95; mynum &amp;#95;&amp;#93; :bat}&amp;#93; ridiculous&amp;#93; &amp;#40;str mynum&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;See what I did there?  I took the second item in the vector, which was a map, grabbed the thing attached to &lt;code&gt;:bat&lt;/code&gt;, which was a vector, and then grabbed the second item in it.&lt;/p&gt;&lt;p&gt;There are more fancy destructuring features, such as the :or keyword to supply default bindings in map destructuring, but this is enough for now. Go read the further reading for all of that. &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;comparison:&amp;#95;python&amp;#95;tuple&amp;#95;unpacking&quot;&gt;&lt;/a&gt;Comparison: Python Tuple Unpacking&lt;/h2&gt;&lt;p&gt;For those coming to Clojure from Python, it's interesting to compare destructuring to one of my favorite syntactic features of the latter.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;A classic programming interview-type problem is how to swap the values of two variables without using a third variable. Most solutions involve &lt;a href='http://www.geeksforgeeks.org/swap-two-numbers-without-using-temporary-variable/'&gt;silliness with arithmetic&lt;/a&gt;, but in python it's as simple as: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;a = 0
b = 1
a, b = b, a
print&amp;#40;&amp;quot;a = &amp;quot; + str&amp;#40;a&amp;#41;&amp;#41;
print&amp;#40;&amp;quot;b = &amp;quot; + str&amp;#40;b&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The closest equivalent I can come up with to this in Clojure puts the variables in a vector to be destructured, viz: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def v &amp;#91;0 1&amp;#93;&amp;#41;
&amp;#40;def v &amp;#40;let &amp;#91;&amp;#91;a b&amp;#93; v&amp;#93; &amp;#91;b a&amp;#93;&amp;#41;&amp;#41;
v
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;or as a map, which can do the swapping right in the destructuring statement:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def ab {:a 0 :b 1}&amp;#41;
&amp;#40;def ab &amp;#40;let &amp;#91;{a :b b :a} ab&amp;#93; {:a a :b b}&amp;#41;&amp;#41;
ab
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Though I'm not sure if either technically respects the &quot;no temp variables&quot; rule since they do create temporary bindings in the let statements.  But both versions have the same general form of &quot;unpack the first two variables, swap them without storing either one in a third.&quot;  And there's probably a more elegant way to do it. (Something to try at home: write a macro to do this to two variables on their own.)&lt;/p&gt;&lt;p&gt;But anyway, the python idea works the same.  The trick is that the &lt;a href='https://www.tutorialspoint.com/python/python_tuples.htm'&gt;comma creates a tuple&lt;/a&gt;, and then the &lt;a href='http://stackoverflow.com/a/14836456/4386239'&gt;assignment unpacks that tuple from left to right&lt;/a&gt;. So the left side of the assignment statement reaches in, and assigns a and b to the elements of the tuple on the right side, which you just created with the values in b and a. Though I think some of this stuff got screwed with in Python 3.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;further&amp;#95;reading&quot;&gt;&lt;/a&gt;Further reading&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href='http://clojure.org/guides/destructuring'&gt;Official Clojure guide&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://clojure.org/reference/special_forms#binding-forms'&gt;A more abbreviated official Clojure explanation&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://blog.jayfields.com/2010/07/clojure-destructuring.html'&gt;Jay Fields tutorial&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://gist.github.com/john2x/e1dca953548bfdfb9844'&gt;John Louis Del Rosario tutorial&lt;/a&gt; and &lt;a href='http://www.john2x.com/blog/clojure-destructuring.html'&gt;blog post&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://blog.brunobonacci.com/2014/11/16/clojure-complete-guide-to-destructuring/'&gt;Bruno Bonacci tutorial&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://clojurebridge.github.io/community-docs/docs/clojure/destructuring/'&gt;ClojureBridge destructuring examples&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.braveclojure.com/do-things/#Defining_Functions'&gt;Clojure for the Brave and True on defining functions&lt;/a&gt; (scroll down a bit for destructuring section)&lt;/li&gt;&lt;li&gt;&lt;a href='https://www.laliluna.de/articles/2013/010/29/clojure-destructuring.html'&gt;Sebastian Hennebrueder on destructuring&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Sat, 17 Dec 2016 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/basic-transducers/
</guid>
<link>
http://paultopia.github.io/posts-output/basic-transducers/
</link>
<title>
Transducers for total beginners
</title>
<description>
 &lt;p&gt;&quot;Transducer&quot; has to be the most intimidating name in all Clojure-land. For everyday use, however, they're really simple. (I don't get the truly fancy stuff, like writing one's own transducers, or getting them to hold state.)  &lt;/p&gt;&lt;p&gt;The simple &quot;for beginners&quot; (recommended experience level: you know how to use map and reduce and function composition and the threading macro) flavor of transducers is: like function composition, but with some more fancy. &lt;/p&gt;&lt;p&gt;This blog post is an attempted translation of the basic parts of the &lt;a href='http://clojure.org/reference/transducers'&gt;Clojure documentation page on transducers&lt;/a&gt; into more comprehensible terms that don't require you to be as smart as Rich Hickey to understand.&lt;/p&gt;&lt;p&gt;So one way to think of transducers is just as a different way of doing ordinary function composition, but where you don't have to explicitly call &quot;partial&quot; to do partial application for those sequence functions that support the special one-less-arity-makes-a-transducer powers, and also they go in a different order.&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def transducer-math
  &amp;#40;comp
   &amp;#40;map #&amp;#40;+ 5 %&amp;#41;&amp;#41;
   &amp;#40;map #&amp;#40;/ % 3&amp;#41;&amp;#41;&amp;#41;&amp;#41;

&amp;#40;def composed-math
  &amp;#40;comp
   &amp;#40;partial map #&amp;#40;+ 5 %&amp;#41;&amp;#41;
   &amp;#40;partial map #&amp;#40;/ % 3&amp;#41;&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Compare the two: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;into &amp;#91;&amp;#93; &amp;#40;composed-math &amp;#91;1 2 3&amp;#93;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;into &amp;#91;&amp;#93; transducer-math &amp;#91;1 2 3&amp;#93;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Why are these different?  Because ordinary function composition runs backwards, like nesting, so it applies the division before the addition.  Transducer composition runs forward, the &quot;natural order,&quot; like the arrow threading macro &lt;code&gt;-&amp;gt;&lt;/code&gt; does, so it applies the addition before the division.&lt;/p&gt;&lt;p&gt;&lt;code&gt;transduce&lt;/code&gt; is like &lt;code&gt;reduce&lt;/code&gt;, with a bit of magic under the hood. The docs have stuff I don't even begin to understand in there, but what it seems to amount to is that it applies the transducer to the collection before reducing, i.e., you can replace &lt;code&gt;reduce&lt;/code&gt; with &lt;code&gt;transduce transducer&lt;/code&gt; and it will otherwise work. &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;def xf 
  &amp;#40;comp 
   &amp;#40;filter odd?&amp;#41;
   &amp;#40;filter #&amp;#40;&amp;gt; 5 %&amp;#41;&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;transduce xf + &amp;#40;range 10&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;reduce + &amp;#40;range 10&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;transduce xf conj &amp;#91;&amp;#93; &amp;#40;range 10&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;reduce conj &amp;#91;&amp;#93; &amp;#40;range 10&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;eduction&lt;/code&gt; seems to basically just mean &quot;create a lazy sequence from applying the transducer to the collection&quot; &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;take 2 &amp;#40;eduction xf &amp;#40;range 10&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;However, &lt;code&gt;sequence&lt;/code&gt; does the same thing, so I have to confess to a bit of confusion as to what the differences are.&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;take 2 &amp;#40;sequence xf &amp;#40;range 10&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Other advantages of transducers: you can apply them to core.async channels, so everything that comes in gets transformed. They're also potentially more efficient than ordinary nested calls and such, because they don't create intermediate sequences for all the steps (not even lazy ones).&lt;/p&gt;&lt;p&gt;For future reference, here's the list of the built-in higher-order sequence functions that make transducers when called with one less arity, straight from the docs:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;map&lt;/li&gt;&lt;li&gt;cat&lt;/li&gt;&lt;li&gt;mapcat&lt;/li&gt;&lt;li&gt;filter&lt;/li&gt;&lt;li&gt;remove&lt;/li&gt;&lt;li&gt;take&lt;/li&gt;&lt;li&gt;take-while&lt;/li&gt;&lt;li&gt;take-nth&lt;/li&gt;&lt;li&gt;drop&lt;/li&gt;&lt;li&gt;drop-while&lt;/li&gt;&lt;li&gt;replace&lt;/li&gt;&lt;li&gt;partition-by&lt;/li&gt;&lt;li&gt;partition-all&lt;/li&gt;&lt;li&gt;keep&lt;/li&gt;&lt;li&gt;keep-indexed&lt;/li&gt;&lt;li&gt;map-indexed&lt;/li&gt;&lt;li&gt;distinct&lt;/li&gt;&lt;li&gt;interpose&lt;/li&gt;&lt;li&gt;dedupe&lt;/li&gt;&lt;li&gt;random-sample&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Christophe Grand has also written &lt;a href='https://github.com/cgrand/xforms'&gt;tranducerific support for more core functions&lt;/a&gt;. Right now they seem a little hard to understand (especially x/reduce!!) but reading the code is interesting...&lt;/p&gt;&lt;p&gt;Also, &lt;a href='http://stackoverflow.com/questions/26317325/can-someone-explain-clojure-transducers-to-me-in-simple-terms'&gt;this is a nice SO&lt;/a&gt;.&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Mon, 05 Dec 2016 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/cljs-macro-data/
</guid>
<link>
http://paultopia.github.io/posts-output/cljs-macro-data/
</link>
<title>
Using macros to get data into Clojurescript front-end pages
</title>
<description>
 &lt;p&gt;Suppose you want to construct pure front-end static pages that will be as fast as possible.  Optimum speed at least arguably involves minimizing server round trips.  Ideally, everything should be one round trip, which should fetch all code and data for the entire site (so long as it isn't huge). This minimizes network latency, permits aggressive caching strtegies, the use of services like cloudflare to optimize the stink out of everything, etc. &lt;/p&gt;&lt;p&gt;But that comes at a cost. If everything is bundled up together, that means instead of, say, having your SPA application go fetch some markdown from the server with an AJAX request and render it to the user (network round trip! oh noes!), you get to mix the code and the data. But that's just ugly, and hard to maintain. For example, this is what some of the code from &lt;a href='http://gowder.io'&gt;gowder.io&lt;/a&gt;, which is just a personal static site built with Reagent, looks like: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;#40;defn research-page &amp;#91;&amp;#93;
  &amp;#91;shell &amp;quot;Researcher&amp;quot;
   &amp;#91;:div
    &amp;#91;:p &amp;quot;I'm currently an academic researcher, and in that capacity, since 2012, I've published one book, &amp;quot;
     &amp;#91;:a {:href &amp;quot;http://rulelaw.net&amp;quot;} &amp;quot;The Rule of Law in the Real World&amp;quot;&amp;#93;
     &amp;quot;, and over a dozen articles in constitutional law, political and legal philosophy, critical race theory, classical Athenian law and political theory, and distributive justice. I've also given about 40 scholarly presentations in the last 4 years. For details, see &amp;quot;
     &amp;#91;:a {:href &amp;quot;http://paul-gowder.com&amp;quot;} &amp;quot;my academic website&amp;quot;&amp;#93; &amp;quot;, where you can also download copies of many articles. Other than the book, I'm perhaps proudest of &amp;quot;
     &amp;#91;:a {:href &amp;quot;https://zenodo.org/record/57249&amp;quot;} &amp;quot;an article&amp;quot;&amp;#93;
     &amp;quot; on urban racial segregation, cognitive bias, and ascriptive injuries.&amp;quot;&amp;#93;
    &amp;#91;:p &amp;quot;Currently, I'm working on more quantitative and computational projects, including some experiments with machine-learning predictions of judicial outcomes and with human-computer facilitated empirical data collection.&amp;quot;&amp;#93;
    &amp;#91;:p &amp;quot;I have a Ph.D. in political science from &amp;quot;
     &amp;#91;:a {:href &amp;quot;https://politicalscience.stanford.edu&amp;quot;} &amp;quot;Stanford&amp;quot;&amp;#93;
     &amp;quot; and a law degree from &amp;quot;
     &amp;#91;:a {:href &amp;quot;http://hls.harvard.edu&amp;quot;} &amp;quot;Harvard.&amp;quot;&amp;#93;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;What a bloody mess.  Any time I have to change the content, I have to be careful to make sure I don't accidentally unmatch some braces or mis-nest some tags or something equally stupid. In addition to being likely to introduce errors into the code, this is also likely to introduce errors into the content, since it isn't readily readable, and it gets formatted with indentation and such for code rather than for text. &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;when&amp;#95;do&amp;#95;code&amp;#95;and&amp;#95;content&amp;#95;come&amp;#95;together?&quot;&gt;&lt;/a&gt;When do Code and Content Come Together?&lt;/h2&gt;&lt;p&gt;This demonstrates two strategies for bringing code and content together, which are imperfect because of their timing. Summarizing the above: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;em&gt;Code and content come together at runtime&lt;/em&gt;: this means that the code has to go fetch the content from somewhere. And that means network latency and stuff.&lt;/li&gt;&lt;li&gt;&lt;em&gt;Code and content come together at write time&lt;/em&gt;: this means that the code and content have to be written together, like in the same file. And that's difficult to write and maintain.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;But there is a alternative. &lt;/p&gt;&lt;p&gt;Clojurescript is a lisp!  It has macros!  This means that we can take content, write it in a separate place from the code, and then bring the two together &lt;em&gt;at compile time&lt;/em&gt;. &lt;/p&gt;&lt;p&gt;Here's a trivial demo, which is available in full runnable form &lt;a href='https://github.com/paultopia/jsonmacrodemo'&gt;on Github&lt;/a&gt;. We take &lt;a href='https://reagent-project.github.io/'&gt;Reagent&lt;/a&gt;, &lt;a href='https://github.com/dakrone/cheshire'&gt;Cheshire&lt;/a&gt;, &lt;a href='https://github.com/davidsantiago/hickory'&gt;Hickory&lt;/a&gt; and &lt;a href='https://github.com/yogthos/Selmer'&gt;Selmer&lt;/a&gt;, and run them together as follows: &lt;/p&gt;&lt;p&gt;First, in a macro running on the JVM, we take a JSON of content, parse it with Cheshire, and then pass it to Selmer to turn it into HTML. It should be pretty easy to do something similar with Markdown content, if you're into that. Then we parse that with Hickory into Hiccup data structures.&lt;/p&gt;&lt;p&gt;Then we call that macro from CLJS, and at compile-time, it kindly fetches the data and inserts it into our code, ready to be used by Reagent. &lt;/p&gt;&lt;p&gt;So we have a minimal template.html:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;lt;p&amp;gt;This text comes from a Selmer template! Hello {{name}}!&amp;lt;/p&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And we have a minimal name.json: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;{&amp;quot;name&amp;quot;: &amp;quot;World!&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And then we have a macro.clj:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;#40;ns jsonmacrodemo.macro
  &amp;#40;:require &amp;#91;cheshire.core :refer &amp;#91;parse-string&amp;#93;&amp;#93;
            &amp;#91;selmer.parser :refer &amp;#91;render-file render&amp;#93;&amp;#93;
            &amp;#91;hickory.core :refer &amp;#91;parse-fragment as-hiccup&amp;#93;&amp;#93;&amp;#41;&amp;#41;

&amp;#40;defn get-data &amp;#91;jsonfile&amp;#93;
  &amp;#40;parse-string &amp;#40;slurp jsonfile&amp;#41; true&amp;#41;&amp;#41;

&amp;#40;defmacro from-template &amp;#91;template jsonfile&amp;#93;
  &amp;#40;first &amp;#40;map as-hiccup &amp;#40;parse-fragment &amp;#40;render &amp;#40;slurp template&amp;#41; &amp;#40;get-data jsonfile&amp;#41;&amp;#41;&amp;#41;&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And finally, we have some the Clojurescript that consumes it, core.cljs: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;#40;ns jsonmacrodemo.core
  &amp;#40;:require &amp;#91;reagent.core :as reagent&amp;#93;&amp;#41;
  &amp;#40;:require-macros &amp;#91;jsonmacrodemo.macro :as m&amp;#93;&amp;#41;&amp;#41;

&amp;#40;defn home-page &amp;#91;&amp;#93;
  &amp;#91;:div
   &amp;#40;m/from-template &amp;quot;template.html&amp;quot; &amp;quot;name.json&amp;quot;&amp;#41;&amp;#93;&amp;#41;

&amp;#40;reagent/render &amp;#91;home-page&amp;#93; &amp;#40;.getElementById js/document &amp;quot;app&amp;quot;&amp;#41;&amp;#41;

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Code and content are completely separated at write time, but get compiled together before they ever see a web browser. Best of both worlds.&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Sun, 04 Dec 2016 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/devcards-testing/
</guid>
<link>
http://paultopia.github.io/posts-output/devcards-testing/
</link>
<title>
Devcards for Testing Clojurescript Projects: A Beginner Introduction
</title>
<description>
 &lt;p&gt;Devcards is an amazing library that basically lets you create a separate test build of a Clojurescript project.  &lt;a href='http://rigsomelight.com/devcards/#!/devdemos.testing'&gt;The documentation&lt;/a&gt; is pretty clear, but if you're a relative Clojurescript beginner like me, you'll need a little bit more hand-holding. So here's my mini-walkthrough for getting Devcards integrated into a CLJS project, targeted at people who know the basics. (Recommended background knowledge: can set up a small Clojurescript project, perhaps with help of a lein template, and get it to compile. It will also help to &lt;a href='http://blog.jayfields.com/2010/08/clojuretest-introduction.html'&gt;know how testing works&lt;/a&gt; on JVM Clojure-side with clojure.test.).   &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;why?&quot;&gt;&lt;/a&gt;Why?&lt;/h2&gt; &lt;p&gt;Clojurescript testing is hard. Or, at least, it seems hard. Honestly, I haven't gotten to the point of figuring out how to make it work yet. Unlike JVM Clojure where you can just use clojure.test and set up some deftests and then just run them with lein test, Clojurescript testing requires setting up some browser environment (or, I guess, Node or something?) to run it in.  Most non-Devcards techniques &lt;a href='https://github.com/bensu/doo#setting-up-environments'&gt;seem to require you&lt;/a&gt; to do extreme yak-shavey things like set up Phantom.js.  &lt;/p&gt;&lt;p&gt;By contrast, Devcards just lets you set up &quot;cards,&quot; that only show up in special builds, and that demonstrate their functionality on a convenient little webpage. So then when you want to do unit testing on your Clojurescript app, you just compile the Devcards build, open up the special Devcards webpage, and then look to make sure everything is working as expected. Your test run is opening a webpage. (And if you have Figwheel going, then you get live test reloading on that webpage.) &lt;/p&gt;&lt;p&gt;You can have an ordinary test, which displays on the web much like it displays when running lein test (i.e., you can see what passed and what failed), and you can also use a &quot;card,&quot; which is just a snippet of code that gets executed and displayed, and is useful for &quot;testing&quot; stuff that requires direct visual examination. (For example, I'm working on a browser extension that uses &lt;a href='https://gionkunz.github.io/chartist-js/'&gt;Chartist.js&lt;/a&gt; to display data vis, and I'm just &lt;a href='https://github.com/paultopia/browser-stats/commit/b6936f8466aba7b0c1695139bbd5c4fe6773ee2f'&gt;defining cards in a test namespace&lt;/a&gt; to allow me to eyeball test charts and make sure they look like I expect.)&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;setup&quot;&gt;&lt;/a&gt;Setup&lt;/h2&gt;&lt;p&gt;Of course you're going to want to require Devcards in your Leiningen dependencies (or do whatever it is that the Boot folks do). More importantly, you're also going to want to set up a separate build in your project.clj.  Here's what the builds section of my project.clj looks like (this is based off the awesome &lt;a href='https://github.com/reagent-project/reagent-frontend-template'&gt;reagent frontend template&lt;/a&gt;, which I basically use for everything, and then add devcards on my own. Hmm... maybe there's a PR or a fork in here...)&lt;/p&gt;&lt;pre&gt;&lt;code&gt;:cljsbuild {:builds {:app
                       {:source-paths &amp;#91;&amp;quot;src&amp;quot; &amp;quot;env/dev/cljs&amp;quot;&amp;#93;
                        :compiler
                        {:main &amp;quot;statspop.dev&amp;quot;
                         :output-to &amp;quot;public/js/app.js&amp;quot;
                         :output-dir &amp;quot;public/js/out&amp;quot;
                         :asset-path   &amp;quot;js/out&amp;quot;
                         :source-map true
                         :optimizations :none
                         :pretty-print  true}}
                       :devcards
                       {:source-paths &amp;#91;&amp;quot;src&amp;quot; &amp;quot;env/dev/cljs&amp;quot; &amp;quot;test&amp;quot;&amp;#93;
                        :figwheel
                        {:devcards true}
                        :compiler
                        { :main       &amp;quot;statspop.dev&amp;quot;
                         :asset-path &amp;quot;js/devcards&amp;#95;out&amp;quot;
                         :output-to  &amp;quot;public/js/devcards.js&amp;quot;
                         :output-dir &amp;quot;public/js/devcards&amp;#95;out&amp;quot;
                         :optimizations :none
                         :source-map-timestamp true }}
                       :release
                       {:source-paths &amp;#91;&amp;quot;src&amp;quot; &amp;quot;env/prod/cljs&amp;quot;&amp;#93;
                        :compiler
                        {:output-to &amp;quot;public/js/app.js&amp;quot;
                         :output-dir &amp;quot;public/js/release&amp;quot;
                         :asset-path   &amp;quot;js/out&amp;quot;
                         :optimizations :advanced
                         :pretty-print false}}}}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note the devcards build in the middle.  That's where the action happens. &lt;/p&gt;&lt;ul&gt;&lt;li&gt;First, note that it has &quot;test&quot; as a source path, in addition to the other paths. That's where I've defined the cards.&lt;/li&gt;&lt;li&gt;Second, note that it has a Figwheel option in the map with &lt;code&gt;{:devcards true}&lt;/code&gt;.  You can use Devcards without Figwheel, but why are you building Clojurescript projects without Figwheel? (Also, Devcards and Figwheel were written by the same &lt;a href='http://rigsomelight.com/'&gt;awesome person&lt;/a&gt;, so they're really good at working together.)&lt;/li&gt;&lt;li&gt;Third, note that it compiles to a totally different Javascript file. It goes to devcards.js rather than app.js. The implication here is that you put your devcards on a totally different html page too. So in the statspop project above, I have index.html in the target &quot;public&quot; directory, which contains the ordinary app (and will actually go away for prod, since this is to be a Chrome extension), but I also have cards.html, which, in relevant part, is just:&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code&gt;&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
	&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;css/chartist.min.css&amp;quot;&amp;gt;
	&amp;lt;script src=&amp;quot;js/jstat.min.js&amp;quot; type=&amp;quot;text/javascript&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
	 &amp;lt;script src=&amp;quot;js/chartist.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;
        &amp;lt;script src=&amp;quot;js/devcards.js&amp;quot; type=&amp;quot;text/javascript&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
    &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note how that html just calls the Javascript and CSS libraries I'll be using (this may change, depending on how you set up external dependencies, using CLJSJS etc.), and then calls the devcards script defined in the project.clj.&lt;/p&gt;&lt;p&gt;Unlike normal CLJS libraries, you don't specify a HTML element in your cards page to render the Devcards into. So it doesn't have anything like a &lt;code&gt;&amp;lt;div id=&amp;quot;app&amp;quot;&amp;gt;&lt;/code&gt; that you'd normally use with Reagent or something. Indeed, you don't need to add any code to render it at all.  Just construct the cards, and require the namespaces the cards are in from something that actually gets loaded (or something that gets loaded by something that gets loaded, etc.), and Devcards library code will handle the rendering for you.&lt;/p&gt;&lt;p&gt;That namespace point is important and easy to miss. While you don't have to explicitly render Devcards, you do have to have the namespace a card is defined in somewhere in the dependency tree of your main namespace (&lt;a href='https://github.com/clojure/clojurescript/wiki/Compiler-Options#main'&gt;main namespace mainly used for no-optimization compilation&lt;/a&gt;). So my dependency tree looks something like this: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;statspop.dev  &amp;#40;the main namespace specified in project.clj&amp;#41;
|
 -- requires statspop.core
 |
  ---- requires all the application code namespaces
 -- requires statspop.core-test
 |
  ---- requires all the individual test namespaces &amp;#40;where Devcards cards and tests are defined&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Speaking of rendering, the Devcards docs suggest setting up your main app rendering with a conditional, so that it only renders if the node it aims at appears. E.g., from the core.cljs one of my projects:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;#40;defn mount-root &amp;#91;&amp;#93;
  &amp;#40;when-let &amp;#91;app &amp;#40;.getElementById js/document &amp;quot;app&amp;quot;&amp;#41;&amp;#93;
    &amp;#40;r/render &amp;#91;home-page&amp;#93; app&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The idea there is that the application code (as opposed to the testing code) won't get run if the application page isn't loaded. This seems like a sensible precaution in view of the risk of side-effects, state pollution, etc.&lt;/p&gt;&lt;p&gt;That's about it for setup. &lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;using&amp;#95;devcards.&quot;&gt;&lt;/a&gt;Using devcards.&lt;/h2&gt;&lt;p&gt;I just copypasta-boilerplate import everything I might ever need into every test namespace, e.g., &lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;#40;ns statspop.download-test
  &amp;#40;:require &amp;#91;statspop.download :as d&amp;#93; ; the functionality I want to test
            &amp;#91;cljs.test :as t :refer-macros &amp;#91;is testing&amp;#93;&amp;#93;
            &amp;#91;devcards.core :as dc :refer-macros &amp;#91;defcard deftest defcard-rg&amp;#93;&amp;#93;
            &amp;#91;reagent.core :as r&amp;#93;
            &amp;#91;cljs.test :as t :refer-macros &amp;#91;is testing&amp;#93;&amp;#93;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;After all, this is a dev build, it doesn't need to be light. &lt;/p&gt;&lt;p&gt;Then usage is super simple.  To define an ordinary test, you just do it exactly as you would with JVM clojure.test. Devcards deftest just shadows the cljs.test symbol and emits both tests for devcards and ordinary cljs tests if you also want to do the test runner thing with Phantom.js and the like for some reason. For example, I've rolled my own quick-and-dirty CSV converter rather than bring in a whole library for one function, so that needs a test: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;#40;deftest nested-vectors-to-csv-string
  &amp;#40;is &amp;#40;=
       &amp;#40;d/format-vec-as-csv &amp;#91;&amp;#91;&amp;quot;foo&amp;quot; &amp;quot;bar&amp;quot;&amp;#93; &amp;#91;1 2&amp;#93; &amp;#91;&amp;quot;baz&amp;quot; 3&amp;#93;&amp;#93;&amp;#41;
       &amp;quot;foo,bar\n1,2\nbaz,3&amp;quot;&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;To define a card, you use the defcard macro. This is mostly useful for ui/io/other state-y and side-effect-y-type things where automated testing won't work, you really just need to look and see that the input and output are what they should be.  There's also a defcard-rg macro that is just like defcard, but will take and render Reagent components for you; I tend to use that for all cards just to keep consistency with everything else I'm doing (since I'm aggressively reagent-for-everything). So this bit of code tests the creation of a downloadable csv file based on a Reagent component in my application code: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;#40;defcard-rg download-csv
  &amp;quot;download a csv file named data.csv containing the contents of the csv test above&amp;quot;
  &amp;#91;:div
   &amp;#91;:p
    &amp;#91;d/downloader &amp;#91;&amp;#91;&amp;quot;foo&amp;quot; &amp;quot;bar&amp;quot;&amp;#93; &amp;#91;1 2&amp;#93; &amp;#91;&amp;quot;baz&amp;quot; 3&amp;#93;&amp;#93; :csv&amp;#93;&amp;#93;&amp;#93;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note how they have docstrings and cool stuff like that too.&lt;br /&gt;&lt;/p&gt;&lt;p&gt;That's it!  (Obviously, there are advanced functions, but this is the basic stuff.)  Now you can build your devcards build (e.g. &lt;code&gt;lein figwheel devcards&lt;/code&gt; &amp;mdash;although Figwheel is much nicer wrapped in rlwrap or &lt;a href='https://paultopia.github.io/posts-output/figwheel-emacs/'&gt;used from Emacs&lt;/a&gt;), go to your cards.html or whatever page, and you'll get a lovely menu of namespaces; click on a namespace to open it and you'll see all your tests + all your cards on the page. With the examples above, I can check that my csv string conversion test passes, and I can also try out the csv downloader functionality and make sure the csv that gets downloaded looks like it should. &lt;/p&gt;&lt;p&gt;Sweet, you've got a test system. &lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Sat, 03 Dec 2016 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/figwheel-emacs/
</guid>
<link>
http://paultopia.github.io/posts-output/figwheel-emacs/
</link>
<title>
Figwheel + Spacemacs
</title>
<description>
 &lt;p&gt;I've been trying to figure out how to get Figwheel and Spacemacs to play nicely together for a while.  It turns out it's much easier than it looks (required knowledge level: reasonable comfort with front-end Clojurescript and leiningen, prior use of Figwheel, successful installation of Spacemacs and use of Clojure mode).&lt;/p&gt;&lt;p&gt;Relevant documentation: &lt;a href='https://github.com/syl20bnr/spacemacs/tree/master/layers/%2Blang/clojure'&gt;Using the Clojure layer in Spacemacs&lt;/a&gt;, &lt;a href='https://github.com/bhauman/lein-figwheel/wiki/Using-the-Figwheel-REPL-within-NRepl'&gt;using Figwheel in nREPL&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;That later document gives a process for integrating Figwheel into Emacs that doesn't seem to work with my Spacemacs stuff. But most of what it says to do isn't actually necessary, and I've extracted from it a method that doesn't actually require any special configuration in your .spacemacs, other than having Clojure mode activated.  Here's the entirety of my clojure configuration from my .spacemacs, none of which is necessary to get figwheel going: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;  &amp;#40;spacemacs/toggle-evil-cleverparens-on&amp;#41;
  &amp;#40;add-hook 'clojure-mode-hook #'evil-cleverparens-mode&amp;#41;
  &amp;#40;setq cider-show-error-buffer nil&amp;#41;
  &amp;#40;with-eval-after-load 'clojure-mode
    &amp;#40;dolist &amp;#40;c &amp;#40;string-to-list &amp;quot;:&amp;#95;-?!#&amp;#42;&amp;quot;&amp;#41;&amp;#41;
      &amp;#40;modify-syntax-entry c &amp;quot;w&amp;quot; clojure-mode-syntax-table &amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;So how do we do it?&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Step 1&lt;/strong&gt;: make sure the right stuff is in your project.clj (I have no ideas for boot users).  First, you need all the appropriate configuration for Figwheel. I usually start CLJS projects with the excellent &lt;a href='https://github.com/reagent-project/reagent-frontend-template'&gt;reagent frontend template&lt;/a&gt;, which handles most of that stuff for you. But in case you need something better, here are some of the basics that I have in my project.cljs: &lt;/p&gt;&lt;p&gt;&lt;em&gt;Figwheel in plugins&lt;/em&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;  :plugins &amp;#91;&amp;#91;lein-cljsbuild &amp;quot;1.1.4&amp;quot;&amp;#93;
            &amp;#91;lein-figwheel &amp;quot;0.5.8&amp;quot;&amp;#93;&amp;#93;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;Figwheel settings giving nrepl middleware, ports (might not be needed?), etc.&lt;/em&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;  :figwheel {:http-server-root &amp;quot;public&amp;quot;
             :nrepl-port 7002
             :nrepl-middleware &amp;#91;&amp;quot;cemerick.piggieback/wrap-cljs-repl&amp;quot;&amp;#93;}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;CLJS builds giving source paths, e.g.:&lt;/em&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;  :cljsbuild {:builds {:app
                       {:source-paths &amp;#91;&amp;quot;src&amp;quot; &amp;quot;env/dev/cljs&amp;quot;&amp;#93;  ; needed
                        :compiler
                        {:main &amp;quot;blahblahblah.dev&amp;quot; ; blah blah etc.}}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;repl-options summoning up piggieback&lt;/em&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;  :repl-options {:nrepl-middleware &amp;#91;cemerick.piggieback/wrap-cljs-repl&amp;#93;}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;and a dev profile calling in piggieback and figwheel-sidecar&lt;/em&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;  :profiles {:dev {:dependencies &amp;#91;&amp;#91;figwheel-sidecar &amp;quot;0.5.4-5&amp;quot;&amp;#93;
                                  &amp;#91;org.clojure/tools.nrepl &amp;quot;0.2.12&amp;quot;&amp;#93;
                                  &amp;#91;com.cemerick/piggieback &amp;quot;0.2.2-SNAPSHOT&amp;quot;&amp;#93;&amp;#93;}}&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Not all this stuff may be required (and my process is a little cargo-cultey), but at least the piggieback, sidecar, and source paths elements are required per the figwheel docs. If you work from the reagent frontend template, the only thing you need to add is the :repl-options section in the defproject. &lt;/p&gt;&lt;p&gt;&lt;strong&gt;Step 2&lt;/strong&gt;: then you're actually done!  Now you can activate figwheel from within emacs.  And you don't need to mess around with jacking-in clojurescript separate from clojure or anything silly like that.  Instead, you need only: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;Open a cljs source file from your project.&lt;/li&gt;&lt;li&gt;Start a normal clojure repl with &lt;code&gt;SPC m s i&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Open up the CIDER REPL buffer (if it isn't up already, just use &lt;code&gt;SPC w -&lt;/code&gt; to get a new window, then &lt;code&gt;SPC b b&lt;/code&gt; to get a menu of buffers).  Now you have a cider repl, a CLJ/JVM one rather than a CLJS/JS one.&lt;/li&gt;&lt;li&gt;In the cider repl, call the following three functions in order:&lt;/li&gt;&lt;/ol&gt;&lt;pre&gt;&lt;code&gt;&amp;#40;use 'figwheel-sidecar.repl-api&amp;#41;

&amp;#40;start-figwheel!&amp;#41;

&amp;#40;cljs-repl&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And now you have a Figwheel REPL in the buffer.  You can send stuff to the browser just like you can with Figwheel in the terminal, AND you can use the normal spacemacs/cider key bindings to send stuff to the fancy figwheel repl through emacs. &lt;/p&gt;&lt;p&gt;Even more awesome, you can then quit out of the cljs repl with &lt;code&gt;:cljs/quit&lt;/code&gt;, at which point you'll have a clj repl again, and you can send CLJ/JVM code to that as normal.  BUT: figwheel will still be autobuilding!  So you can edit your cljs code and it'll shoot right back to the browser.  Then, when you want a figwheel repl again, you can go with &lt;code&gt;&amp;#40;cljs-repl&amp;#41;&lt;/code&gt; and it'll be right back.&lt;/p&gt;&lt;p&gt;When you kill cider (with &lt;code&gt;SPC m s q&lt;/code&gt;) it's polite enough to also take out the figwheel autobuild. &lt;/p&gt;&lt;p&gt;Magic. &lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Fri, 02 Dec 2016 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/helloworld/
</guid>
<link>
http://paultopia.github.io/posts-output/helloworld/
</link>
<title>
Cryogen + Github pages + Klipse
</title>
<description>
&lt;p&gt;Hello world, and all that jazz.  I've decided to start a tech blog. &lt;/p&gt;&lt;p&gt;The first challenge: getting it up. Static site generators seem to be fashionable these days, and I'm a big fan of Clojure, so naturally I went with &lt;a href='http://cryogenweb.org/'&gt;Cryogen&lt;/a&gt;, which is a dead simple static site generator where you literally fire up a lein template and then edit a bunch of markdown files and simple &lt;a href='https://github.com/yogthos/Selmer'&gt;Selmer&lt;/a&gt; templates plus a single config edn. And &lt;a href='https://pages.github.com/'&gt;Github Pages&lt;/a&gt; is both free and convenient name recognition for code-oriented things, so that's the obvious choice for a host.&lt;/p&gt;&lt;p&gt;The main alternative I considered was &lt;a href='https://jaspervdj.be/hakyll/'&gt;Hakyll&lt;/a&gt;, mainly because I've been meaning to try to do a Haskell project. But taking one look at the code in the &quot;create compilation rules in a Haskell EDSL&quot; snippet on the front page, and, nopesauce. As much as I'm starting to like Haskell (more later), I still immediately get turned off by the weird &lt;a href='https://twitter.com/PaulGowder/status/783886798350987264'&gt;special character-heavy syntax choices&lt;/a&gt;. So when I saw &lt;code&gt;&amp;gt;&amp;gt;=&lt;/code&gt; and &lt;code&gt;.||.&lt;/code&gt; that was it for me. (Maybe when I finally write my personal course management system.)&lt;/p&gt;&lt;p&gt;So challenge #1 is getting it on github. The official Cryogen docs aren't terribly clear on this point, but github personal/organizational pages appear to want to have the static content at the root of the repo, and Cryogen outputs the content it produces to /resources/public. You can fix this by setting the repo at resources/public rather than in the root directory of the Cryogen project, but then the markdown files, Selmer templates, etc. aren't under version control, and that's obviously a problem.&lt;/p&gt;&lt;p&gt;Fortunately, a couple nice chaps named &lt;a href='http://tangrammer.github.io/posts/02-12-2014-cryogen-and-github.html'&gt;Juan Ruz&lt;/a&gt; and Mayank Jain cooked up &lt;a href='http://firesofmay.com/posts/2015-08-26-setup-cryogen.html'&gt;a solution&lt;/a&gt;. The heart of the fix is to create one repo at the root of the Cryogen project, call it &quot;my blog&quot; or something, and then create a second repo, &lt;em&gt;inside the first one&lt;/em&gt;, with the standard yourname.github.io naming, starting at /resources/public. &lt;/p&gt;&lt;p&gt;To be honest, this seems super-shady to me. The official way to nest repositories in one another in git is to use a &lt;a href='https://git-scm.com/docs/git-submodule'&gt;submodule&lt;/a&gt;, but just try to read the documentation for that, I dare you. So what happens if you actually nest repos like this without using submodules?  Does everything horribly break?  Well, not so far... &lt;/p&gt;&lt;p&gt;The folks who devised this recommend putting /resources/public in the .gitignore of the original repo, presumably as a safety measure to prevent all kinds of weird conflicts from happening. And it seems ok... I haven't horribly blown up anything so far. (Heaven help me if I try to do anything even remotely fancy with branches, or checking out old commits, or something.)&lt;/p&gt;&lt;p&gt;The second challenge is getting Klipse running. For those who don't know, &lt;a href='https://github.com/viebel/klipse'&gt;Klipse&lt;/a&gt; is an amazing embedded clojurescript evaluation environment, basically a modular repl in a page: you can replace code snippets with actual executable code, and even do things like fetch libraries. It is awesomesauce. It also has interpreters for (officially) Javascript, Ruby, and PHP in addition to clojurescript; unofficially it also has Python among others. &lt;/p&gt;&lt;p&gt;After some hassle, integrating Klipse with Cryogen actually turned out to be dead simple. In Cryogen, all the Selmer templates are stored in subdirectories of your themes, so all I did was &lt;a href='https://github.com/paultopia/experimental-cryogen/blob/master/resources/templates/themes/nucleus/html/base.html'&gt;edit base.html&lt;/a&gt; there to add references to the Klipse javascript source.  Viz: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;{% if post.executable %}
{% style &amp;quot;css/codemirror.css&amp;quot; %}
&amp;lt;script&amp;gt;
 window.klipse&amp;#95;settings = {
     selector: '.clojure',
     selector&amp;#95;eval&amp;#95;python&amp;#95;client: '.python'
 };
&amp;lt;/script&amp;gt;
{% script &amp;quot;js/klipse&amp;#95;plugin.js&amp;quot; %}
{% script &amp;quot;js/skulpt.min.js&amp;quot; %}
{% script &amp;quot;js/skulpt-stdlib.js&amp;quot; %}
{% endif %}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A few points to note there: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;The selectors are classes that can be added to a fenced code block in the markdown file just by putting the name of a class directly after the opening symbol, i.e., &lt;code&gt;&amp;#126;&amp;#126;&amp;#126;clojure&lt;/code&gt;&lt;/li&gt;&lt;li&gt;post.executable is a variable that I set at the top of the markdown files. So what the template does is chooses whether or not to include the Klipse stuff depending on whether I've said, in a given post, that there's executable code in it. The rationale here is that all this extra javascript is really heavy, and I don't want people to have to load it if they're just visiting the site to look at a page that doesn't use it.  I'll probably modify this down the road to take a different variable for each language, and then only load the interpretation environment appropriate to that language.&lt;/li&gt;&lt;li&gt;Because Python is still an unofficial part of Klipse, this selector isn't actually documented yet, but it's in there and I'll prove it:&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;print &amp;quot;, &amp;quot;.join&amp;#40;map&amp;#40;lambda x: &amp;quot;Hello &amp;quot; + x, &amp;#91;&amp;quot;my baby&amp;quot;, &amp;quot;my honey&amp;quot;, &amp;quot;my ragtop World!&amp;quot;&amp;#93;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;See?&lt;/p&gt;&lt;ul&gt;&lt;li&gt;I'm locally serving the Klipse javascript rather than using the one provided by the (awesome) maintainer of the plugin because the provided version doesn't support https. However, it turns out there's &lt;a href='https://github.com/viebel/klipse#https'&gt;a workaround&lt;/a&gt;, and I'll probably switch to that, because the maintainer told me that he's pushing out frequent releases, and I want to keep up to date.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Other matters of note: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;Depending on what languages you want to use, you might need a special build of the highlight.js javascript that comes with cryogen. &lt;a href='https://highlightjs.org/download/'&gt;Get it here&lt;/a&gt;.&lt;/li&gt;&lt;li&gt;All this mucking around with multiple repos and such really demands &lt;a href='https://github.com/paultopia/experimental-cryogen/blob/master/deploy'&gt;a build script&lt;/a&gt;.  Mostly derived from Jain's.&lt;/li&gt;&lt;li&gt;Note how you can compile Cryogen with &lt;code&gt;lein run&lt;/code&gt;. This isn't actually in the documentation anywhere, which just recommends compiling with &lt;code&gt;lein ring server&lt;/code&gt; and actually running a whole webserver (plus auto recompile). But this seems annoying and wasteful to me when you can just add a compilation step to the build script.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Now let's have a fizzbuzz.&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;take 100 &amp;#40;map #&amp;#40;cond &amp;#40;= &amp;#40;mod % 15&amp;#41; 0&amp;#41; &amp;quot;fizzbuzz&amp;quot; &amp;#40;= &amp;#40;mod % 3&amp;#41; 0&amp;#41; &amp;quot;fizz&amp;quot; &amp;#40;= &amp;#40;mod % 5&amp;#41; 0&amp;#41; &amp;quot;buzz&amp;quot; :else %&amp;#41; &amp;#40;range 1 101&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;bye.&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Mon, 17 Oct 2016 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/second/
</guid>
<link>
http://paultopia.github.io/posts-output/second/
</link>
<title>
Experimenting
</title>
<description>
&lt;p&gt;This is just a post to experiment with klipse and making it work with cryogen markdown passing. &lt;/p&gt;&lt;p&gt;the following is done with markdown fenced block: &lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;&amp;#40;take 10 &amp;#40;map inc &amp;#40;range&amp;#41;&amp;#41;&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;the following is done with raw html code tags:&lt;/p&gt;&lt;p&gt;&lt;code class=&quot;clojure&quot;&gt; ((comp (partial apply +) (partial map (partial * 3))) [1 2 3]) &lt;/code&gt;&lt;/p&gt;&lt;p&gt;Doing some haskell to see default highlight.js behavior:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;plength :: &amp;#91;a&amp;#93; -&amp;gt; Int
plength &amp;#91;&amp;#93; = 0
plength &amp;#40;x:xs&amp;#41; = 1 + plength xs
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Some python with markdown fenced block:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;for x in range&amp;#40;20&amp;#41;:
    print x
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With raw code tag:&lt;/p&gt;&lt;p&gt;&lt;code class=&quot;python&quot;&gt;print [x.upper() for x in [&quot;foo&quot;, &quot;bar&quot;]] &lt;/code&gt;&lt;/p&gt;&lt;p&gt;(need to minimize loading of plugins by having a tag for each language)&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Sun, 16 Oct 2016 00:00:00 -0500
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/2016-01-07-docs/
</guid>
<link>
http://paultopia.github.io/posts-output/2016-01-07-docs/
</link>
<title>
Quick Start Guide
</title>
<description>
&lt;p&gt;This intro only documents a subset of Cryogen's features. For additional documentation please see the &lt;a href='http://cryogenweb.org'&gt;cryogen site&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;features&quot;&gt;&lt;/a&gt;Features&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;Blog posts and pages with Markdown (default) or AsciiDoc&lt;/li&gt;&lt;li&gt;Tags&lt;/li&gt;&lt;li&gt;Table of contents generation&lt;/li&gt;&lt;li&gt;Plain HTML page templates&lt;/li&gt;&lt;li&gt;Code syntax highlighting&lt;/li&gt;&lt;li&gt;Disqus support&lt;/li&gt;&lt;li&gt;Sitemap generation&lt;/li&gt;&lt;li&gt;RSS feed generation&lt;/li&gt;&lt;li&gt;Sass/SCSS compilation&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;a name=&quot;prerequisites&quot;&gt;&lt;/a&gt;Prerequisites&lt;/h2&gt;&lt;p&gt;You will need &lt;a href='https://github.com/technomancy/leiningen'&gt;Leiningen&lt;/a&gt; 2.5.0 or above installed.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;usage&quot;&gt;&lt;/a&gt;Usage&lt;/h2&gt;&lt;h3&gt;&lt;a name=&quot;creating&amp;#95;a&amp;#95;new&amp;#95;site&quot;&gt;&lt;/a&gt;Creating a New Site&lt;/h3&gt;&lt;p&gt;A new site can be created using the Cryogen template as follows:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;lein new cryogen my-blog
&lt;/code&gt;&lt;/pre&gt;&lt;h3&gt;&lt;a name=&quot;running&amp;#95;the&amp;#95;server&quot;&gt;&lt;/a&gt;Running the Server&lt;/h3&gt;&lt;p&gt;The web server can be started from the &lt;code&gt;my-blog&lt;/code&gt; directory using the &lt;code&gt;lein-ring&lt;/code&gt; plugin:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;lein ring server
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The server will watch for changes in the &lt;code&gt;resources/templates&lt;/code&gt; folder and recompile the content automatically.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;site&amp;#95;configuration&quot;&gt;&lt;/a&gt;Site Configuration&lt;/h3&gt;&lt;p&gt;The site configuration file is found at &lt;code&gt;templates/config.edn&lt;/code&gt;, this file looks as follows:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;clojure&quot;&gt;{:site-title         &amp;quot;My Awesome Blog&amp;quot;
 :author             &amp;quot;Bob Bobbert&amp;quot;
 :description        &amp;quot;This blog is awesome&amp;quot;
 :site-url           &amp;quot;http://blogawesome.com/&amp;quot;
 :post-root          &amp;quot;posts&amp;quot;
 :page-root          &amp;quot;pages&amp;quot;
 :post-root-uri      &amp;quot;posts-output&amp;quot;
 :page-root-uri      &amp;quot;pages-output&amp;quot;
 :tag-root-uri       &amp;quot;tags-output&amp;quot;
 :blog-prefix        &amp;quot;/blog&amp;quot;
 :rss-name           &amp;quot;feed.xml&amp;quot;
 :rss-filters        &amp;#91;&amp;quot;cryogen&amp;quot;&amp;#93;
 :recent-posts       3
 :post-date-format   &amp;quot;yyyy-MM-dd&amp;quot;
 :sass-src           nil
 :sass-dest          nil
 :theme              &amp;quot;blue&amp;quot;
 :resources          &amp;#91;&amp;quot;img&amp;quot;&amp;#93;
 :keep-files         &amp;#91;&amp;quot;.git&amp;quot;&amp;#93;
 :disqus?            false
 :disqus-shortname   &amp;quot;&amp;quot;
 :ignored-files      &amp;#91;#&amp;quot;\.#.&amp;#42;&amp;quot; #&amp;quot;.&amp;#42;\.swp$&amp;quot;&amp;#93;
 :posts-per-page     5
 :blocks-per-preview 2
 :previews?          false
 :clean-urls?        true}

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;For information about each key please see the &lt;a href='http://cryogenweb.org/docs/configuration.html'&gt;&quot;Configuration&quot;&lt;/a&gt; portion of the Cryogen documentation site.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;switching&amp;#95;between&amp;#95;markdown&amp;#95;and&amp;#95;asciidoc&quot;&gt;&lt;/a&gt;Switching between Markdown and AsciiDoc&lt;/h3&gt;&lt;p&gt;Cryogen comes with Markdown support as default. If you want to use AsciiDoc instead, open the &lt;code&gt;project.clj&lt;/code&gt; in your created blog (e.g. &lt;code&gt;my-blog&lt;/code&gt;), and change the line in &lt;code&gt;:dependencies&lt;/code&gt; that says &lt;code&gt;cryogen-markdown&lt;/code&gt; to &lt;code&gt;cryogen-asciidoc&lt;/code&gt;. Instead of looking for files ending in &lt;code&gt;.md&lt;/code&gt; in the &lt;code&gt;resources/templates/md&lt;/code&gt; directory, the compiler will now look for files ending in &lt;code&gt;.asc&lt;/code&gt; in the &lt;code&gt;resources/templates/asc&lt;/code&gt; directory.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;selecting&amp;#95;a&amp;#95;theme&quot;&gt;&lt;/a&gt;Selecting a Theme&lt;/h3&gt;&lt;p&gt;The Cryogen template comes with two themes in the &lt;code&gt;resources/templates/themes&lt;/code&gt; folder. To change your blog's theme, change the value of the &lt;code&gt;:theme&lt;/code&gt; key in &lt;code&gt;config.edn&lt;/code&gt;.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;customizing&amp;#95;layouts&quot;&gt;&lt;/a&gt;Customizing Layouts&lt;/h3&gt;&lt;p&gt;Cryogen uses &lt;a href='https://github.com/yogthos/Selmer'&gt;Selmer&lt;/a&gt; templating engine for layouts. Please refer to its documentation to see the supported tags and filters for the layouts.&lt;/p&gt;&lt;p&gt;The layouts are contained in the &lt;code&gt;resources/templates/themes/{theme}/html&lt;/code&gt; folder of the project. By default, the &lt;code&gt;base.html&lt;/code&gt; layout is used to provide the general layout for the site. This is where you would add static resources such as CSS and JavaScript assets as well as define headers and footers for your site.&lt;/p&gt;&lt;p&gt;Each page layout should have a name that matches the &lt;code&gt;:layout&lt;/code&gt; key in the page metadata and end with &lt;code&gt;.html&lt;/code&gt;. Page layouts extend the base layout and should only contain the content relevant to the page inside the &lt;code&gt;content&lt;/code&gt; block. For example, the &lt;code&gt;tag&lt;/code&gt; layout is located in &lt;code&gt;tag.html&lt;/code&gt; and looks as follows:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;xml&quot;&gt;{% extends &amp;quot;templates/html/layouts/base.html&amp;quot; %}
{% block content %}
&amp;lt;div id=&amp;quot;posts-by-tag&amp;quot;&amp;gt;
    &amp;lt;h2&amp;gt;Posts tagged {{name}}&amp;lt;/h2&amp;gt;
    &amp;lt;ul&amp;gt;
    {% for post in posts %}
        &amp;lt;li&amp;gt;
            &amp;lt;a href=&amp;quot;{{post.uri}}&amp;quot;&amp;gt;{{post.title}}&amp;lt;/a&amp;gt;
        &amp;lt;/li&amp;gt;
    {% endfor %}
    &amp;lt;/ul&amp;gt;
&amp;lt;/div&amp;gt;
{% endblock %}
&lt;/code&gt;&lt;/pre&gt;&lt;h3&gt;&lt;a name=&quot;code&amp;#95;syntax&amp;#95;highlighting&quot;&gt;&lt;/a&gt;Code Syntax Highlighting&lt;/h3&gt;&lt;p&gt;Cryogen uses &lt;a href='https://highlightjs.org/'&gt;Highlight.js&lt;/a&gt; for code syntax highlighting. You can add more languages by replacing &lt;code&gt;templates/js/highlight.pack.js&lt;/code&gt; with a customized package from &lt;a href='https://highlightjs.org/download/'&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;The &lt;code&gt; initHighlightingOnLoad&lt;/code&gt; function is called in &lt;code&gt;{theme}/html/base.html&lt;/code&gt;.&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;xml&quot;&gt;&amp;lt;script&amp;gt;hljs.initHighlightingOnLoad&amp;#40;&amp;#41;;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;a name=&quot;deploying&amp;#95;your&amp;#95;site&quot;&gt;&lt;/a&gt;Deploying Your Site&lt;/h2&gt;&lt;p&gt;The generated static content will be found under the &lt;code&gt;resources/public&lt;/code&gt; folder. Simply copy the content to a static folder for a server such as Nginx or Apache and your site is now ready for service.&lt;/p&gt;&lt;p&gt;A sample Nginx configuration that's placed in &lt;code&gt;/etc/nginx/sites-available/default&lt;/code&gt; can be seen below:&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;javascript&quot;&gt;server {
  listen 80 default&amp;#95;server;
  listen &amp;#91;::&amp;#93;:80 default&amp;#95;server ipv6only=on;
  server&amp;#95;name localhost &amp;lt;yoursite.com&amp;gt; &amp;lt;www.yoursite.com&amp;gt;;

  access&amp;#95;log  /var/log/blog&amp;#95;access.log;
  error&amp;#95;log   /var/log/blog&amp;#95;error.log;

  location / {
    alias       /var/blog/;
    error&amp;#95;page  404 = /404.html;
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Simply set &lt;code&gt;yoursite.com&lt;/code&gt; to the domain of your site in the above configuration and ensure the static content is available at &lt;code&gt;/var/blog/&lt;/code&gt;. Finally, place your custom error page in the &lt;code&gt;/var/blog/404.html&lt;/code&gt; file.&lt;/p&gt;&lt;p&gt;More information on deployment can be found &lt;a href='http://cryogenweb.org/docs/deploying-to-github-pages.html'&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;some&amp;#95;sites&amp;#95;made&amp;#95;with&amp;#95;cryogen&quot;&gt;&lt;/a&gt;Some Sites Made With Cryogen&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href='http://carmenla.me/blog/index.html'&gt;Creator's blog&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://cryogenweb.org'&gt;Cryogen Documentation Site&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://yogthos.net/'&gt;Yogthos' blog&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.clojure.tn'&gt;Clojure :in Tunisia&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://dl1ely.github.io'&gt;dl1ely.github.io&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://jonase.github.io/nil-recur'&gt;nil/recur&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://tangrammer.github.io/'&gt;on the clojure move&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://blog.jethrokuan.com/'&gt;cognizance&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.agynamix.de'&gt;AGYNAMIX Site &amp; Blog&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://eresident.me'&gt;e-Resident Me&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.chadstovern.com'&gt;Chad Stovern's blog&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='https://greative.jp/'&gt;Greative&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Thu, 07 Jan 2016 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/2014-11-04-second-post/
</guid>
<link>
http://paultopia.github.io/posts-output/2014-11-04-second-post/
</link>
<title>
Yet Another Post
</title>
<description>
&lt;h3&gt;&lt;a name=&quot;this&amp;#95;post&amp;#95;so&amp;#95;fetch&quot;&gt;&lt;/a&gt;This Post So Fetch&lt;/h3&gt;&lt;p&gt;some more stuff happened&lt;/p&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Tue, 04 Nov 2014 00:00:00 -0600
</pubDate>
</item>
<item>
<guid>
http://paultopia.github.io/posts-output/2014-03-10-first-post/
</guid>
<link>
http://paultopia.github.io/posts-output/2014-03-10-first-post/
</link>
<title>
A Post
</title>
<description>
&lt;h3&gt;&lt;a name=&quot;this&amp;#95;post&amp;#95;not&amp;#95;fetch&amp;#95;enough&quot;&gt;&lt;/a&gt;This Post Not Fetch Enough&lt;/h3&gt;&lt;p&gt;some stuff happened&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;and a quote appeared &lt;/p&gt;&lt;/blockquote&gt;
</description>
<enclosure>

</enclosure>
<pubDate>
Mon, 10 Mar 2014 00:00:00 -0500
</pubDate>
</item>
</channel>
</rss>
